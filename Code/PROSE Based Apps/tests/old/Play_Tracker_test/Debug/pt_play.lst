Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:   1


PC     Object              I  Line    Source 
                           A     1    ; Play Protracker Module V1.00 (sample data can
                           A     2    
                           A     3    ;----------------------------------------------
                           A     4    ; Set these two values to suit user program
                           A     5    ;----------------------------------------------
                           A     6    
       00000001            A     7    ADL_mode		equ 1				; 0 if user
       00010000            A     8    load_location	equ 10000h			; anywhere 
                           A     9    
                           B     0    				include	'PROSE_header.asm'
                           B     1    ;--- EZ80 Internal CPU Ports ------------------
                           B     2    
       0000009A            B     3    PB_DR			equ 09ah
       0000009B            B     4    PB_DDR			equ 09bh
       0000009C            B     5    PB_ALT1			equ 09ch
       0000009D            B     6    PB_ALT2			equ 09dh
                           B     7    
       0000009E            B     8    PC_DR			equ 09eh
       0000009F            B     9    PC_DDR			equ 09fh
       000000A0            B    10    PC_ALT1			equ 0a0h
       000000A1            B    11    PC_ALT2			equ 0a1h
                           B    12    
       000000A2            B    13    PD_DR			equ 0a2h
       000000A3            B    14    PD_DDR			equ 0a3h
       000000A4            B    15    PD_ALT1			equ 0a4h
       000000A5            B    16    PD_ALT2			equ 0a5h
                           B    17    
       000000C0            B    18    UART0_RBR		equ 0c0h
       000000C0            B    19    UART0_THR		equ 0c0h
       000000C0            B    20    UART0_BRG_L		equ 0c0h
       000000C1            B    21    UART0_BRG_H		equ 0c1h
       000000C1            B    22    UART0_IER		equ 0c1h
       000000C2            B    23    UART0_FCTL		equ 0c2h
       000000C3            B    24    UART0_LCTL		equ 0c3h
       000000C4            B    25    UART0_MCTL		equ 0c4h
       000000C5            B    26    UART0_LSR		equ 0c5h
                           B    27    
       000000A8            B    28    CS0_LBR			equ 0a8h			;eZ80 wait 
       000000A9            B    29    CS0_UBR			equ 0a9h
       000000AA            B    30    CS0_CTL			equ 0aah			
       000000AB            B    31    CS1_LBR			equ 0abh			;eZ80 wait 
       000000AC            B    32    CS1_UBR			equ 0ach
       000000AD            B    33    CS1_CTL			equ 0adh
       000000AE            B    34    CS2_LBR			equ 0aeh			;eZ80 wait 
       000000AF            B    35    CS2_UBR			equ 0afh
       000000B0            B    36    CS2_CTL			equ 0b0h
       000000B1            B    37    CS3_LBR			equ 0b1h			;eZ80 wait 
       000000B2            B    38    CS3_UBR			equ 0b2h
       000000B3            B    39    CS3_CTL			equ 0b3h
                           B    40    
       00000080            B    41    TMR0_CTL		equ 080h			;timer 0 eq
       00000081            B    42    TMR0_DR_L		equ 081h
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:   2


PC     Object              I  Line    Source ..\..\includes\PROSE_header.asm
       00000081            B    43    TMR0_RR_L		equ 081h
       00000082            B    44    TMR0_DR_H		equ 082h
       00000082            B    45    TMR0_RR_H		equ 082h
       00000092            B    46    TMR_ISS			equ 092h
                           B    47    
       000000ED            B    48    RTC_CTRL		equ 0edh			;RTC equate
       000000EC            B    49    RTC_ACTRL		equ 0ech
       000000E0            B    50    RTC_SEC			equ 0e0h
       000000E1            B    51    RTC_MIN			equ 0e1h
       000000E2            B    52    RTC_HRS			equ 0e2h
       000000E3            B    53    RTC_DOW			equ 0e3h
       000000E4            B    54    RTC_DOM			equ 0e4h
       000000E5            B    55    RTC_MON			equ 0e5h
       000000E6            B    56    RTC_YR			equ 0e6h
       000000E7            B    57    RTC_CEN			equ 0e7h
                           B    58    
                           B    59    ;-- EZ80P Hardware equates --------------------
                           B    60    
       00000000            B    61    port_pic_data  			equ 000h
       00000001            B    62    port_pic_ctrl			equ 001h
       00000001            B    63    port_hw_flags			equ 001h
       00000002            B    64    port_sdc_ctrl			equ 002h	; this is a
       00000002            B    65    port_keyboard_data		equ 002h
       00000003            B    66    port_sdc_data		 	equ 003h	
       00000004            B    67    port_memory_paging		equ 004h
       00000005            B    68    port_irq_ctrl			equ 005h
       00000006            B    69    port_nmi_ack			equ 006h
       00000007            B    70    port_ps2_ctrl			equ 007h
       00000008            B    71    port_selector			equ 008h
       00000006            B    72    port_mouse_data			equ 006h
       00000009            B    73    port_clear_flags		equ 009h
                           B    74    
       00000040            B    75    port_video_mode			equ 040h
                           B    76    
                           B    77    
       00000000            B    78    sdc_power				equ 0		;(port_sd_c
       00000001            B    79    sdc_cs					equ 1		;(port_sd_c
       00000002            B    80    sdc_speed				equ 2 		;(port_sd_c
                           B    81    
       00000004            B    82    sdc_serializer_busy		equ 4 		;(port_hw_f
       00000005            B    83    vrt						equ 5		;(port_hw_f
                           B    84    
                           B    85    
                           B    86    ;-- Memory locations --------------------------
                           B    87    
       00800000            B    88    hw_vram_a			equ 0800000h
       00C00000            B    89    hw_vram_b			equ 0c00000h
       00F00000            B    90    hw_palette			equ 0f00000h
       00F80000            B    91    hw_audio_registers 	equ 0f80000h
                           B    92    
                           B    93    ;----------------------------------------------
                           B    94    
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:   3


PC     Object              I  Line    Source ..\..\includes\PROSE_header.asm
                           B    95    
       00000A00            B    96    os_start 	equ 0a00h
                           B    97    
       00000A14            B    98    prose_return equ os_start+14h
       00000A20            B    99    prose_kernal equ os_start+20h
                           B   100    
                           B   101    ;----------------------------------------------
                           B   102    ; Kernal Jump Table values for mode PROSE
                           B   103    ;----------------------------------------------
                           B   104    		
       00000000            B   105    kr_mount_volumes				equ 00h	
       00000001            B   106    kr_get_device_info				equ 01h	
       00000002            B   107    kr_check_volume_format			equ 02h	
       00000003            B   108    kr_change_volume				equ 03h	
       00000004            B   109    kr_get_volume_info				equ 04h	
       00000005            B   110    kr_format_device				equ 05h	
       00000006            B   111    kr_make_dir						equ 06h
                           B   112    
       00000007            B   113    kr_change_dir					equ 07h	
       00000008            B   114    kr_parent_dir					equ 08h	
       00000009            B   115    kr_root_dir						equ 09h
       0000000A            B   116    kr_delete_dir					equ 0ah
       0000000B            B   117    kr_find_file					equ 0bh
       0000000C            B   118    kr_set_file_pointer				equ 0ch
       0000000D            B   119    kr_set_load_length				equ 0dh
       0000000E            B   120    kr_read_file					equ 0eh
                           B   121    
       0000000F            B   122    kr_erase_file					equ 0fh
       00000010            B   123    kr_rename_file					equ 10h
       00000011            B   124    kr_create_file					equ 11h
       00000012            B   125    kr_write_file					equ 12h
       00000013            B   126    kr_get_total_sectors			equ 13h
       00000014            B   127    kr_dir_list_first_entry			equ 14h
       00000015            B   128    kr_dir_list_get_entry			equ 15h
       00000016            B   129    kr_dir_list_next_entry			equ 16h
                           B   130    
       00000017            B   131    kr_read_sector					equ 17h
       00000018            B   132    kr_write_sector					equ 18h
       00000019            B   133    kr_file_sector_list				equ 19h
       0000001A            B   134    kr_get_dir_cluster				equ 1ah
       0000001B            B   135    kr_set_dir_cluster				equ 1bh
       0000001C            B   136    kr_get_dir_name					equ 1ch
       0000001D            B   137    kr_wait_key						equ 1dh
       0000001E            B   138    kr_get_key						equ 1eh
                           B   139    
       0000001F            B   140    kr_get_key_mod_flags			equ 1fh
       00000020            B   141    kr_serial_receive_header		equ 20h
       00000021            B   142    kr_serial_receive_file			equ 21h
       00000022            B   143    kr_serial_send_file				equ 22h
       00000023            B   144    kr_serial_tx_byte				equ 23h
       00000024            B   145    kr_serial_rx_byte				equ 24h
                           B   146    
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:   4


PC     Object              I  Line    Source ..\..\includes\PROSE_header.asm
       00000025            B   147    kr_print_string					equ 25h
       00000026            B   148    kr_clear_screen					equ 26h
       00000027            B   149    kr_wait_vrt						equ 27h
       00000028            B   150    kr_set_cursor_position			equ 28h
       00000029            B   151    kr_plot_char					equ 29h
       0000002A            B   152    kr_set_pen						equ 2ah
       0000002B            B   153    kr_background_colours			equ 2bh
       0000002C            B   154    kr_draw_cursor					equ 2ch
       0000002D            B   155    kr_get_pen						equ 2dh
       0000002E            B   156    kr_scroll_up					equ 2eh
       0000002F            B   157    kr_os_display					equ 2fh
       00000030            B   158    kr_get_display_size				equ 30h
       00000031            B   159    kr_get_charmap_addr_xy			equ 31h
       00000032            B   160    kr_get_cursor_position			equ 32h
                           B   161    
       00000033            B   162    kr_set_envar					equ 33h
       00000034            B   163    kr_get_envar					equ 34h
       00000035            B   164    kr_delete_envar					equ 35h
                           B   165    
       00000036            B   166    kr_enable_mouse					equ 36h
       00000037            B   167    kr_get_mouse_position			equ 37h
       00000038            B   168    kr_get_mouse_disp				equ 38h
                           B   169    
       00000039            B   170    kr_time_delay					equ 39h
       0000003A            B   171    kr_compare_strings				equ 3ah
       0000003B            B   172    kr_hex_byte_to_ascii			equ 3bh
       0000003C            B   173    kr_ascii_to_hex_word			equ 3ch
       0000003D            B   174    kr_get_string					equ 3dh
                           B   175    
       0000003E            B   176    kr_get_version					equ 3eh
       0000003F            B   177    kr_dont_store_registers			equ 3fh
       00000040            B   178    kr_os_video_settings			equ 40h
       00000041            B   179    kr_read_rtc						equ 41h
       00000042            B   180    kr_write_rtc					equ 42h
                           B   181    
                           B   182    ;----------------------------------------------
                           B   183    ; Standard PROSE executable header
                           B   184    ;----------------------------------------------
                           B   185    
                           B   186    
                           B   187    	IF ADL_mode = 0
                           B   188    		org load_location&0ffffh	; if Z80 mo
                           B   189    	ELSE
010000                     B   190    		org load_location			; otherwise
                           B   191    	ENDIF
                           B   192    	
                           B   193    		.assume ADL = 1				; All PROSE
                           B   194    
010000 18 0E               B   195    		jr skip_header				; $0 - Jump
010002 50524F              B   196    		db 'PRO'					; $2 - ASCI
010005 000001              B   197    mb_loc	dw24 load_location			; $5 - Desi
010008 000000              B   198    		dw24 0						; $8 - If >
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:   5


PC     Object              I  Line    Source ..\..\includes\PROSE_header.asm
01000B 0000                B   199    		dw 0						; $B - If >
01000D 0000                B   200    		dw 0						; $D - If >
01000F 01                  B   201    		db ADL_mode					; $F - Z80 
                           B   202    
010010                     B   203    skip_header
                           B   204    	
                           B   205    	IF ADL_mode = 0 
                           B   206    		
                           B   207    mbase_offset equ load_location & 0ff0000h
                           B   208    
                           B   209    		ld a,load_location/65536	; Additiona
                           B   210    		ld MB,a						; Set MBASE
                           B   211    		jp.sis go_z80_mode			; switches 
                           B   212    
                           B   213    go_z80_mode
                           B   214    
                           B   215    		.assume ADL = 0
                           B   216    
                           B   217    	ENDIF
                           B   218    	
                           B   219    ;----------------------------------------------
                           B   220    	
                           A    11    
                           A    12    ;----------------------------------------------
                           A    13    ; ADL-mode user program follows..
                           A    14    ;----------------------------------------------
                           A    15    
010010 2B                  A    16    			dec hl
010011 23                  A    17    find_args	inc hl							; g
010012 7E                  A    18    			ld a,(hl)
010013 B7                  A    19    			or a
010014 CA B8 00 01         A    20    			jr z,no_args
010018 FE20                A    21    			cp ' '
01001A 28 F5               A    22    			jr z,find_args
                           A    23    			
01001C 21 5B 01 01         A    24    			ld hl,test_fn
                           A    25    			
010020 3E0B                A    26    			ld a,kr_find_file				; l
010022 5BCD200A 00         A    27    			call.lil prose_kernal
010027 C2 C2 00 01         A    28    			jr nz,load_error
01002B ED53 58 01 01       A    29    			ld (pt_mod_length),de			; n
                           A    30    			
010030 21 F1 00 01         A    31    			ld hl,loading_txt					010034 CD E1 00 01         A    32    			call print_string
                           A    33    
010038 21 14 1A 01         A    34    			ld hl,music_module
01003C 3E0E                A    35    			ld a,kr_read_file
01003E 5BCD200A 00         A    36    			call.lil prose_kernal
010043 20 7D               A    37    			jr nz,load_error
                           A    38    			
010045 AF                  A    39    			xor a
010046 32 36 11 01         A    40    			ld (relocated_samples),a
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:   6


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\pt_play.asm
01004A CD 66 01 01         A    41    			call init_tracker				; i
                           A    42    			
01004E 21 14 1A 01         A    43    			ld hl,music_module			
010052 ED4B 58 01 01       A    44    			ld bc,(pt_mod_length)
010057 09                  A    45    			add hl,bc						; h
010058 AF                  A    46    			xor a
010059 ED4B 33 11 01       A    47    			ld bc,(sample_base)
01005E ED42                A    48    			sbc hl,bc						; s
010060 E5                  A    49    			push hl
010061 C1                  A    50    			pop bc							; b
010062 2A 33 11 01         A    51    			ld hl,(sample_base)
010066 110000C0            A    52    			ld de,hw_vram_b
01006A EDB0                A    53    			ldir							; c
                           A    54    			
01006C 3E01                A    55    			ld a,1							; i
01006E 32 36 11 01         A    56    			ld (relocated_samples),a
010072 21000000            A    57    			ld hl,0							; o
010076 22 33 11 01         A    58    			ld (sample_base),hl
01007A CD 66 01 01         A    59    			call init_tracker
                           A    60    					
01007E 21 0E 01 01         A    61    			ld hl,playing_txt					010082 CD E1 00 01         A    62    			call print_string
                           A    63    						
                           A    64    ;----------------------------------------------
                           A    65    
010086 118F0200            A    66    			ld de,655							01008A 7B                  A    67    			ld a,e							
01008B ED3981              A    68    			out0 (TMR0_RR_L),a					01008E 7A                  A    69    			ld a,d
01008F ED3982              A    70    			out0 (TMR0_RR_H),a					010092 3E13                A    71    			ld a,00010011b						010094 ED3980              A    72    			out0 (TMR0_CTL),a					                           A    73    
010097 ED3880              A    74    wait_50hz	in0 a,(TMR0_CTL)					01009A CB7F                A    75    			bit 7,a
01009C C4 CC 00 01         A    76    			call nz,do_tracker_update			                           A    77    		
0100A0 3E1E                A    78    			ld a,kr_get_key						0100A2 5BCD200A 00         A    79    			call.lil prose_kernal
0100A7 FE76                A    80    			cp 076h
0100A9 20 EC               A    81    			jr nz,wait_50hz
                           A    82    
0100AB 3E00                A    83    endit		ld a,0
0100AD 5B320300 F8         A    84    			ld.lil (hw_audio_registers+3),a		0100B2 AF                  A    85    			xor a
0100B3 5BC3140A 00         A    86    			jp.lil prose_return					                           A    87    
                           A    88    ;----------------------------------------------
                           A    89    
0100B8 21 2C 01 01         A    90    no_args		ld hl,no_args_txt
0100BC CD E1 00 01         A    91    			call print_string
0100C0 18 E9               A    92    			jr endit
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:   7


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\pt_play.asm
                           A    93    
0100C2 21 48 01 01         A    94    load_error	ld hl,fnf_txt
0100C6 CD E1 00 01         A    95    			call print_string
0100CA 18 DF               A    96    			jr endit
                           A    97    
                           A    98    ;----------------------------------------------
                           A    99    
                           A   100    
0100CC                     A   101    do_tracker_update
                           A   102    
                           A   103    ; call this routine every 50 Hz
                           A   104    
0100CC 3E08                A   105    			ld a,08h							0100CE 320100F0            A   106    			ld (hw_palette+1),a					                           A   107    			
0100D2 CD E9 01 01         A   108    			call play_tracker					                           A   109    			
0100D6 3E00                A   110    			ld a,00h							0100D8 320100F0            A   111    			ld (hw_palette+1),a					                           A   112    			
0100DC CD 36 12 01         A   113    			call update_audio_hardware			0100E0 C9                  A   114    			ret
                           A   115    			
                           A   116    ;----------------------------------------------
                           A   117    
0100E1                     A   118    print_string
                           A   119    
0100E1 3E25                A   120    			ld a,kr_print_string			 
0100E3 5BCD200A 00         A   121    			call.lil prose_kernal			 
0100E8 C9                  A   122    			ret
                           A   123    
                           A   124    
0100E9 3E1D                A   125    waitkey		ld a,kr_wait_key
0100EB 5BCD200A 00         A   126    			call.lil prose_kernal
0100F0 C9                  A   127    			ret
                           A   128    
                           A   129    
                           A   130    ;----------------------------------------------
                           A   131    		
0100F1 4C6F6164 696E6720   A   132    loading_txt		db 'Loading Protracker module..
0100F9 50726F74 7261636B 
010101 6572206D 6F64756C 
010109 652E2E20 00 
01010E 506C6179 696E6721   A   133    playing_txt		db 'Playing! Press ESC to quit.
010116 20507265 73732045 
01011E 53432074 6F207175 
010126 69742E2E 0B00 
                           A   134    
01012C 55736167 65205054   A   135    no_args_txt		db 'Usage PTPLAY [module name]'
010134 504C4159 205B6D6F 
01013C 64756C65 206E616D 
010144 655D0B00 
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:   8


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\pt_play.asm
                           A   136    
010148 46696C65 206E6F74   A   137    fnf_txt			db 'File not found',11,0
010150 20666F75 6E640B00 
                           A   138    
010158 000000              A   139    pt_mod_length	dw24 0
                           A   140    
01015B 74337465 73742E6D   A   141    test_fn			db 't3test.mod',0
010163 6F6400 
                           A   142    
                           A   143    ;----------------------------------------------
                           A   144    		
                           B     0    			include "ADL_mode_Protracker_Player
                           B     1    ;----------------------------------------------
                           B     2    ; ADL mode eZ80 Protracker Music Player - V1.01
                           B     3    ; http://www.retroleum.co.uk
                           B     4    ;
                           B     5    ; SYNTAX ZDSII STANDARD.. STILL NOT OPTIMIZED A
                           B     6    ;
                           B     7    ; Revisions:
                           B     8    ; ----------
                           B     9    ;
                           B    10    ; V1.01 Arpeggio fix 
                           B    11    ; V1.00 First version of ADL-mode player
                           B    12    ; 
                           B    13    ; Known issues:
                           B    14    ; -------------
                           B    15    ; $EF - invert loop is not implemented (rarely 
                           B    16    ;
                           B    17    ;----------------------------------------------
                           B    18    ;
                           B    19    ; ADL mode eZ80 Code to play standard 31 instru
                           B    20    ;
                           B    21    ; The code has been designed so that is hardwar
                           B    22    ; does not write to any hardware registers. It 
                           B    23    ; below) for the Amiga hardware registers which
                           B    24    ; to drive whatever is the output hardware.
                           B    25    ;
                           B    26    ; Equates (must be defined in external code)
                           B    27    ; -------
                           B    28    ; "music_module" = location of protracker modul
                           B    29    ; The music module must be located at a word ad
                           B    30    ;
                           B    31    ; Routines:
                           B    32    ; ---------
                           B    33    ; call "init_tracker" to initialize/reset tune
                           B    34    ; call "play_tracker" every 50th of a second to
                           B    35    ; call your conversion routine after this.)
                           B    36    ;
                           B    37    ; Variables:
                           B    38    ; ----------
                           B    39    ; "relocated_samples" (byte) - if set to 1, the
                           B    40    ; by the "init_tracker" routine and will remain
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:   9


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
                           B    41    ; the sample data to be seperated from the modu
                           B    42    ; audio RAM.
                           B    43    ;
                           B    44    ; Replacing the Amiga hardware registers is a b
                           B    45    ; These begin at "channel_data". There are 38 b
                           B    46    ; within each block are:
                           B    47    ;
                           B    48    ; "sample_location" (24 bit address)	
                           B    49    ; "sample_length" (24 bit value in bytes, NOT W
                           B    50    ;
                           B    51    ; "sample_loop_location" (24 bit address)		                           B    52    ; "sample_loop_length" (24 bit value in bytes, 
                           B    53    ;
                           B    54    ; "period_lo" (forms a 16 bit word with period_
                           B    55    ; "period_hi" (see above)
                           B    56    ;
                           B    57    ; "volume" (8 bit - values: 0 to 64, same as Am
                           B    58    ;
                           B    59    ; "control_bits" (8 bit)
                           B    60    ; When bit 0 of each channel's control_bits var
                           B    61    ; routine should trigger a sample (ie: reload s
                           B    62    ; The conversion routine should clear bit 0 of 
                           B    63    ;
                           B    64    ; "filter_on_off" (BYTE) reads ONE if player ha
                           B    65    ; zero if not. (Whether or not this is of any u
                           B    66    
                           B    67    ;==============================================
                           B    68    ; Start of hardware-agnostic specific eZ80 Prot
                           B    69    ;==============================================
                           B    70    
                           B    71    .assume ADL = 1
                           B    72    
010166                     B    73    init_tracker
                           B    74    
010166 3E06                B    75    				ld a,6							010168 32 97 11 01         B    76    				ld (songspeed),a
01016C AF                  B    77    				xor a							01016D 32 94 11 01         B    78    				ld (ticker),a
010171 32 95 11 01         B    79    				ld (songpos),a
010175 32 96 11 01         B    80    				ld (patindex),a
010179 32 98 11 01         B    81    				ld (arpeggio_counter),a
01017D 32 99 11 01         B    82    				ld (pattloop_pos),a
010181 32 9A 11 01         B    83    				ld (pattloop_count),a
010185 32 9B 11 01         B    84    				ld (pattdelay_count),a	
010189 32 9C 11 01         B    85    				ld (pattdelay_flag),a	
01018D 21 9E 11 01         B    86    				ld hl,channel_data
010191 06 98               B    87    				ld b,vars_per_channel*4
010193 77                  B    88    clchdlp			ld (hl),a
010194 23                  B    89    				inc hl
010195 10 FC               B    90    				djnz clchdlp
                           B    91    
010197 2A 33 11 01         B    92    				ld hl,(sample_base)
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  10


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
01019B 3A 36 11 01         B    93    				ld a,(relocated_samples)
01019F B7                  B    94    				or a
0101A0 20 21               B    95    				jr nz,use_reloc_sb
                           B    96    				
0101A2 21 CC 1D 01         B    97    				ld hl,music_module+952			0101A6 0680                B    98    				ld b,128						0101A8 0E00                B    99    				ld c,0
0101AA 7E                  B   100    ptfhplp			ld a,(hl)	
0101AB B9                  B   101    				cp c
0101AC 38 01               B   102    				jr c,patlower
0101AE 4F                  B   103    				ld c,a
0101AF 23                  B   104    patlower		inc hl
0101B0 10 F8               B   105    				djnz ptfhplp
0101B2 0C                  B   106    				inc c
0101B3 21000000            B   107    				ld hl,0
0101B7 61                  B   108    				ld h,c
0101B8 29                  B   109    				add hl,hl
0101B9 29                  B   110    				add hl,hl						0101BA 01 50 1E 01         B   111    				ld bc,music_module+1084			0101BE 09                  B   112    				add hl,bc						0101BF 22 33 11 01         B   113    				ld (sample_base),hl
                           B   114    
0101C3 DD21 37 11 01       B   115    use_reloc_sb	ld ix,sample_location_list		0101C8 FD21 3E 1A 01       B   116    				ld iy,music_module+42
0101CD 061F                B   117    				ld b,31
0101CF DD2F00              B   118    bsstlp			ld (ix),hl						0101D2 11000000            B   119    				ld de,0							0101D6 FD5600              B   120    				ld d,(iy)
0101D9 FD5E01              B   121    				ld e,(iy+1)
0101DC EB                  B   122    				ex de,hl
0101DD 29                  B   123    				add hl,hl						0101DE EB                  B   124    				ex de,hl
0101DF 19                  B   125    				add hl,de				
0101E0 ED3203              B   126    				lea ix,ix+3		
0101E3 ED331E              B   127    				lea iy,iy+30					0101E6 10 E7               B   128    				djnz bsstlp
0101E8 C9                  B   129    				ret
                           B   130    
                           B   131    ;----------------------------------------------
                           B   132    
0101E9                     B   133    play_tracker
                           B   134    
0101E9 3A 94 11 01         B   135    				ld a,(ticker)
0101ED B7                  B   136    				or a			
0101EE C2 A7 03 01         B   137    				jp nz,not_new_line
                           B   138    
0101F2 3A 95 11 01         B   139    				ld a,(songpos)					0101F6 01000000            B   140    				ld bc,0
0101FA 4F                  B   141    				ld c,a
0101FB 21 CC 1D 01         B   142    				ld hl,music_module+952			0101FF 09                  B   143    				add hl,bc						010200 46                  B   144    				ld b,(hl)			
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  11


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
010201 0E00                B   145    				ld c,0
010203 CB20                B   146    				sla b
010205 CB20                B   147    				sla b							                           B   148    				
010207 3A 96 11 01         B   149    				ld a,(patindex)					01020B 21001000            B   150    				ld hl,1000h						01020F 6F                  B   151    				ld l,a
010210 ED6C                B   152    				mlt hl							010212 09                  B   153    				add hl,bc						010213 EB                  B   154    				ex de,hl						                           B   155    				
010214 FD21 9E 11 01       B   156    				ld iy,channel_data	
010219 DD21 50 1E 01       B   157    				ld ix,music_module+1084			01021E DD19                B   158    				add ix,de						010220 0604                B   159    				ld b,4							010222 C5                  B   160    chan_loop		push bc
010223 DD7E00              B   161    				ld a,(ix)						010226 DDB601              B   162    				or (ix+1)
010229 DDB602              B   163    				or (ix+2)
01022C DDB603              B   164    				or (ix+3)
01022F 20 06               B   165    				jr nz,parse_dat
010231 FD36 04 FF          B   166    				ld (iy+fx_number),0ffh			010235 18 04               B   167    				jr skipchan	
010237 CD 48 02 01         B   168    parse_dat		call new_note_data	
01023B ED33 26             B   169    skipchan		lea iy,iy+vars_per_channel		01023E ED3204              B   170    				lea ix,ix+4						010241 C1                  B   171    				pop bc
010242 10 DE               B   172    				djnz chan_loop
010244 C3 B9 03 01         B   173    				jp tick_advance
                           B   174    
                           B   175    
                           B   176    ;----- New note routines ----------------------
                           B   177    
010248                     B   178    new_note_data
                           B   179    				
010248 FD36 12 00          B   180    				ld (iy+instrument_waiting),0
01024C DD7E00              B   181    				ld a,(ix)						01024F E6F0                B   182    				and 0f0h
010251 DD4602              B   183    				ld b,(ix+2)
010254 CB38                B   184    				srl b
010256 CB38                B   185    				srl b
010258 CB38                B   186    				srl b
01025A CB38                B   187    				srl b
01025C B0                  B   188    				or b			
01025D 28 55               B   189    				jr z,no_new_instrument			                           B   190    
01025F FD77 12             B   191    				ld (iy+instrument_waiting),a
010262 3D                  B   192    				dec a
010263 21 37 11 01         B   193    				ld hl,sample_location_list		010267 01030000            B   194    				ld bc,3
01026B 47                  B   195    				ld b,a
01026C ED4C                B   196    				mlt bc
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  12


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
01026E 09                  B   197    				add hl,bc						01026F ED07                B   198    				ld bc,(hl)
010271 FD0F 17             B   199    				ld (iy+sample_location),bc		                           B   200    			
010274 011E0000            B   201    				ld bc,30						010278 47                  B   202    				ld b,a
010279 ED4C                B   203    				mlt bc
01027B 21 3E 1A 01         B   204    				ld hl,music_module+42	
01027F 09                  B   205    				add hl,bc						010280 11000000            B   206    				ld de,0
010284 56                  B   207    				ld d,(hl)
010285 23                  B   208    				inc hl
010286 5E                  B   209    				ld e,(hl)
010287 23                  B   210    				inc hl
010288 EB                  B   211    				ex de,hl
010289 29                  B   212    				add hl,hl
01028A EB                  B   213    				ex de,hl
01028B FD1F 1A             B   214    				ld (iy+sample_length),de		                           B   215    								
01028E 7E                  B   216    				ld a,(hl)			
01028F E60F                B   217    				and 0fh
010291 FD77 14             B   218    				ld (iy+finetune),a				010294 23                  B   219    				inc hl
010295 7E                  B   220    				ld a,(hl)
010296 FD77 13             B   221    				ld (iy+volume_waiting),a		010299 23                  B   222    				inc hl
01029A 46                  B   223    				ld b,(hl)						01029B 23                  B   224    				inc hl
01029C 4E                  B   225    				ld c,(hl)						01029D 23                  B   226    				inc hl
01029E E5                  B   227    				push hl
01029F FD27 17             B   228    				ld hl,(iy+sample_location)
0102A2 09                  B   229    				add hl,bc						0102A3 09                  B   230    				add hl,bc						0102A4 FD2F 1D             B   231    				ld (iy+sample_loop_location),hl
0102A7 E1                  B   232    				pop hl	
0102A8 11000000            B   233    				ld de,0
0102AC 56                  B   234    				ld d,(hl)						0102AD 23                  B   235    				inc hl
0102AE 5E                  B   236    				ld e,(hl)						0102AF EB                  B   237    				ex de,hl
0102B0 29                  B   238    				add hl,hl
0102B1 FD2F 20             B   239    				ld (iy+sample_loop_length),hl	                           B   240    								
                           B   241    				
                           B   242    				
0102B4                     B   243    no_new_instrument	
                           B   244    
0102B4 DD7E00              B   245    				ld a,(ix)						0102B7 E60F                B   246    				and 0fh
0102B9 47                  B   247    				ld b,a
0102BA DD4E01              B   248    				ld c,(ix+1)						Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  13


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
                           B   249    					
0102BD DD7E03              B   250    				ld a,(ix+3)						0102C0 FD77 05             B   251    				ld (iy+fx_args),a				0102C3 DD7E02              B   252    				ld a,(ix+2)						0102C6 E60F                B   253    				and 0fh							0102C8 FD77 04             B   254    				ld (iy+fx_number),a
                           B   255    
0102CB FE03                B   256    				cp 3							0102CD CA 5B 03 01         B   257    				jp z,set_portadest				0102D1 FE05                B   258    				cp 5 			
0102D3 CA 5B 03 01         B   259    				jr z,set_portadest
                           B   260    
0102D7 FE0E                B   261    				cp 0eh							0102D9 20 11               B   262    				jr nz,no_ftoveride
0102DB FD7E 05             B   263    				ld a,(iy+fx_args)
0102DE E6F0                B   264    				and 0f0h
0102E0 FE50                B   265    				cp 050h
0102E2 20 08               B   266    				jr nz,no_ftoveride
0102E4 FD7E 05             B   267    				ld a,(iy+fx_args)
0102E7 E60F                B   268    				and 0fh
0102E9 FD77 14             B   269    				ld (iy+finetune),a				                           B   270    
0102EC                     B   271    no_ftoveride
                           B   272    
0102EC FDCB 0F 9E          B   273    				res 3,(iy+control_bits)			0102F0 78                  B   274    				ld a,b							0102F1 B1                  B   275    				or c							0102F2 28 16               B   276    				jr z,nonewp1
                           B   277    
0102F4 FDCB 0F DE          B   278    				set 3,(iy+control_bits)			0102F8 C5                  B   279    				push bc
0102F9 FD71 15             B   280    				ld (iy+arp_base_period_lo),c	0102FC FD70 16             B   281    				ld (iy+arp_base_period_hi),b	0102FF CD 84 03 01         B   282    				call finetune_bc_period
010303 FD71 06             B   283    				ld (iy+period_for_fx_lo),c		010306 FD70 07             B   284    				ld (iy+period_for_fx_hi),b
010309 C1                  B   285    				pop bc
                           B   286    				
01030A FD7E 04             B   287    nonewp1			ld a,(iy+fx_number)
01030D FE0E                B   288    				cp 0eh							01030F 20 0B               B   289    				jr nz,not_ed		 
010311 FD7E 05             B   290    				ld a,(iy+fx_args)
010314 E6F0                B   291    				and 0f0h
010316 FED0                B   292    				cp 0d0h
010318 CA 4A 04 01         B   293    				jp z,check_more_fx
                           B   294    				
01031C 78                  B   295    not_ed			ld a,b							01031D B1                  B   296    				or c			
01031E 28 1A               B   297    				jr z,nonewp2
010320 FD4E 06             B   298    				ld c,(iy+period_for_fx_lo)		010323 FD46 07             B   299    				ld b,(iy+period_for_fx_hi)
010326 FD71 01             B   300    				ld (iy+period_lo),c
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  14


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
010329 FD70 02             B   301    				ld (iy+period_hi),b
01032C FDCB 0F C6          B   302    				set 0,(iy+control_bits)			010330 FD7E 12             B   303    				ld a,(iy+instrument_waiting)	010333 B7                  B   304    				or a
010334 CA 4A 04 01         B   305    				jp z,check_more_fx
010338 18 11               B   306    				jr do_vol						                           B   307    				
01033A FD7E 12             B   308    nonewp2			ld a,(iy+instrument_waiting)	01033D B7                  B   309    				or a							01033E CA 4A 04 01         B   310    				jp z,check_more_fx
010342 FDBE 00             B   311    				cp (iy+instrument)			
010345 28 04               B   312    				jr z,do_vol
010347 FDCB 0F C6          B   313    				set 0,(iy+control_bits)
                           B   314    
01034B FD77 00             B   315    do_vol			ld (iy+instrument),a
01034E FD7E 13             B   316    				ld a,(iy+volume_waiting)		010351 FD77 03             B   317    				ld (iy+volume),a	
010354 FD77 08             B   318    				ld (iy+volume_for_fx),a			010357 C3 4A 04 01         B   319    				jp check_more_fx
                           B   320    				
                           B   321    
01035B                     B   322    set_portadest
                           B   323    
01035B 78                  B   324    				ld a,b							01035C B1                  B   325    				or c			
01035D 28 0A               B   326    				jr z,spd_same			
01035F CD 84 03 01         B   327    				call finetune_bc_period
010363 FD71 10             B   328    				ld (iy+portamento_dest_lo),c	010366 FD70 11             B   329    				ld (iy+portamento_dest_hi),b
                           B   330    				
010369 FD7E 12             B   331    spd_same		ld a,(iy+instrument_waiting)	01036C B7                  B   332    				or a			
01036D C8                  B   333    				ret z
01036E FDBE 00             B   334    				cp (iy+instrument)				010371 28 07               B   335    				jr z,skiptrig
010373 FDCB 0F C6          B   336    				set 0,(iy+control_bits)			010377 FD77 00             B   337    				ld (iy+instrument),a
01037A FD7E 13             B   338    skiptrig		ld a,(iy+volume_waiting)
01037D FD77 03             B   339    				ld (iy+volume),a	
010380 FD77 08             B   340    				ld (iy+volume_for_fx),a	
010383 C9                  B   341    				ret
                           B   342    				
                           B   343    
                           B   344    
010384                     B   345    finetune_bc_period
                           B   346    
010384 FD7E 14             B   347    				ld a,(iy+finetune)				010387 B7                  B   348    				or a
010388 C8                  B   349    				ret z
                           B   350    
010389 21 93 0C 01         B   351    				ld hl,period_table_p0			01038D 11480000            B   352    				ld de,72
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  15


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
010391 57                  B   353    				ld d,a
010392 ED5C                B   354    				mlt de
010394 19                  B   355    				add hl,de
010395 EB                  B   356    				ex de,hl						                           B   357    				
010396 21 32 09 01         B   358    				ld hl,period_lookup_table-113
01039A 09                  B   359    				add hl,bc
01039B 7E                  B   360    				ld a,(hl)						01039C 21000000            B   361    				ld hl,0
0103A0 6F                  B   362    				ld l,a
0103A1 29                  B   363    				add hl,hl						                           B   364    
0103A2 19                  B   365    				add hl,de						0103A3 4E                  B   366    				ld c,(hl)
0103A4 23                  B   367    				inc hl
0103A5 46                  B   368    				ld b,(hl)						0103A6 C9                  B   369    				ret
                           B   370    				
                           B   371    				
                           B   372    ;-------- "FX during line" routines -----------
                           B   373    
                           B   374    
0103A7                     B   375    not_new_line
                           B   376    
0103A7 FD21 9E 11 01       B   377    				ld iy,channel_data				0103AC 0604                B   378    				ld b,4							0103AE C5                  B   379    chanfxlp		push bc							0103AF CD 0B 04 01         B   380    				call check_fx		
0103B3 ED33 26             B   381    				lea iy,iy+vars_per_channel
0103B6 C1                  B   382    				pop bc
0103B7 10 F5               B   383    				djnz chanfxlp
                           B   384    				
0103B9                     B   385    tick_advance
                           B   386    
0103B9 21 98 11 01         B   387    				ld hl,arpeggio_counter			0103BD 34                  B   388    				inc (hl)
0103BE 7E                  B   389    				ld a,(hl)
0103BF FE03                B   390    				cp 3
0103C1 20 02               B   391    				jr nz,arp_ok
0103C3 3600                B   392    				ld (hl),0
0103C5 21 94 11 01         B   393    arp_ok			ld hl,ticker					0103C9 34                  B   394    				inc (hl)
0103CA 3A 97 11 01         B   395    				ld a,(songspeed)	
0103CE BE                  B   396    				cp (hl)							0103CF 20 39               B   397    				jr nz,nspwrap
0103D1 AF                  B   398    				xor a
0103D2 77                  B   399    				ld (hl),a						0103D3 32 98 11 01         B   400    				ld (arpeggio_counter),a			0103D7 21 9B 11 01         B   401    				ld hl,pattdelay_count			0103DB B6                  B   402    				or (hl)
0103DC 28 05               B   403    				jr z,nopatdel
0103DE 35                  B   404    				dec (hl)						Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  16


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
0103DF C3 0A 04 01         B   405    				jp nspwrap
0103E3 AF                  B   406    nopatdel		xor a
0103E4 32 9C 11 01         B   407    				ld (pattdelay_flag),a
0103E8 21 96 11 01         B   408    				ld hl,patindex
0103EC 34                  B   409    				inc (hl)						0103ED 7E                  B   410    				ld a,(hl)
0103EE FE40                B   411    				cp 64							0103F0 20 18               B   412    				jr nz,nspwrap
0103F2 AF                  B   413    				xor a
0103F3 77                  B   414    				ld (hl),a
0103F4 32 99 11 01         B   415    				ld (pattloop_pos),a				0103F8 32 9A 11 01         B   416    				ld (pattloop_count),a			0103FC 21 95 11 01         B   417    				ld hl,songpos		
010400 34                  B   418    				inc (hl)						010401 3A CA 1D 01         B   419    				ld a,(music_module+950)
010405 BE                  B   420    				cp (hl)							010406 20 02               B   421    				jr nz,nspwrap
010408 3600                B   422    				ld (hl),0
01040A C9                  B   423    nspwrap			ret
                           B   424    
                           B   425    
                           B   426    ;----------------------------------------------
                           B   427    				
01040B FD7E 04             B   428    check_fx		ld a,(iy+fx_number)	
01040E B7                  B   429    				or a							01040F CA 72 04 01         B   430    				jp z,fx_arpeggio				010413 FE01                B   431    				cp 1
010415 CA C4 04 01         B   432    				jp z,fx_portamento_up
010419 FE02                B   433    				cp 2
01041B CA EE 04 01         B   434    				jp z,fx_portamento_down
01041F FE03                B   435    				cp 3
010421 CA 18 05 01         B   436    				jp z,fx_tone_portamento
010425 FE04                B   437    				cp 4
010427 CA F2 05 01         B   438    				jp z,fx_vibrato
01042B FE05                B   439    				cp 5
01042D CA 8E 06 01         B   440    				jp z,fx_tone_portamento_volslid
010431 FE06                B   441    				cp 6
010433 CA 96 06 01         B   442    				jp z,fx_vibrato_volslide
010437 FE07                B   443    				cp 7
010439 CA 9E 06 01         B   444    				jp z,fx_tremolo
01043D FE0A                B   445    				cp 0ah
01043F CA 6B 07 01         B   446    				jp z,fx_volslide
010443 FE0E                B   447    				cp 0eh
010445 CA DA 07 01         B   448    				jp z,fx_extended_fx
010449 C9                  B   449    				ret
                           B   450    
                           B   451    
01044A                     B   452    check_more_fx
                           B   453    
01044A FD7E 04             B   454    				ld a,(iy+fx_number)				01044D FE09                B   455    				cp 9
01044F CA 3D 07 01         B   456    				jp z,fx_sample_offset
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  17


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
010453 FE0B                B   457    				cp 0bh			
010455 CA 90 07 01         B   458    				jp z,fx_position_jump
010459 FE0D                B   459    				cp 0dh
01045B CA AE 07 01         B   460    				jp z,fx_pattern_break
01045F FE0E                B   461    				cp 0eh
010461 CA DA 07 01         B   462    				jp z,fx_extended_fx
010465 FE0F                B   463    				cp 0fh
010467 CA 9B 09 01         B   464    				jp z,fx_set_speed
01046B FE0C                B   465    				cp 0ch
01046D CA 9E 07 01         B   466    				jp z,fx_set_volume
010471 C9                  B   467    				ret
                           B   468    					
                           B   469    
                           B   470    ;------- FX $00 -------------------------------
                           B   471    
010472 FD7E 05             B   472    fx_arpeggio		ld a,(iy+fx_args)				010475 B7                  B   473    				or a
010476 C8                  B   474    				ret z
010477 01000000            B   475    				ld bc,0
01047B FD4E 15             B   476    				ld c,(iy+arp_base_period_lo)	01047E FD46 16             B   477    				ld b,(iy+arp_base_period_hi)
010481 3A 98 11 01         B   478    				ld a,(arpeggio_counter)	
010485 11000000            B   479    				ld de,0
010489 B7                  B   480    				or a	
01048A 28 17               B   481    				jr z,doarp		
01048C FE02                B   482    				cp 2
01048E 28 0D               B   483    				jr z,arptwo
010490 FD5E 05             B   484    arpone			ld e,(iy+fx_args)
010493 CB3B                B   485    				srl e
010495 CB3B                B   486    				srl e
010497 CB3B                B   487    				srl e
010499 CB3B                B   488    				srl e							01049B 18 06               B   489    				jr doarp
01049D FD7E 05             B   490    arptwo			ld a,(iy+fx_args)
0104A0 E60F                B   491    				and 15
0104A2 5F                  B   492    				ld e,a							                           B   493    
0104A3 21 32 09 01         B   494    doarp			ld hl,period_lookup_table-113
0104A7 09                  B   495    				add hl,bc
0104A8 7E                  B   496    				ld a,(hl)						0104A9 83                  B   497    				add a,e							0104AA CB27                B   498    				sla a							0104AC 21000000            B   499    				ld hl,0
0104B0 6F                  B   500    				ld l,a
0104B1 11 93 0C 01         B   501    				ld de,period_table_p0
0104B5 19                  B   502    				add hl,de
0104B6 4E                  B   503    				ld c,(hl)
0104B7 23                  B   504    				inc hl
0104B8 46                  B   505    				ld b,(hl)
0104B9 CD 84 03 01         B   506    				call finetune_bc_period
0104BD FD71 01             B   507    				ld (iy+period_lo),c
0104C0 FD70 02             B   508    				ld (iy+period_hi),b
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  18


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
0104C3 C9                  B   509    				ret
                           B   510    
                           B   511    
                           B   512    ;-------- FX $01 ------------------------------
                           B   513    
0104C4                     B   514    fx_portamento_up
                           B   515    
0104C4 0600                B   516    				ld b,0							0104C6 FD4E 05             B   517    				ld c,(iy+fx_args)				0104C9 FD6E 06             B   518    				ld l,(iy+period_for_fx_lo)
0104CC FD66 07             B   519    				ld h,(iy+period_for_fx_hi)
0104CF AF                  B   520    				xor a
0104D0 40ED42              B   521    				sbc.sis hl,bc
0104D3 38 08               B   522    				jr c,portumin
0104D5 B4                  B   523    				or h
0104D6 20 09               B   524    				jr nz,portugnp
0104D8 7D                  B   525    				ld a,l
0104D9 FE71                B   526    				cp 113
0104DB 30 04               B   527    				jr nc,portugnp
0104DD 21710000            B   528    portumin		ld hl,113
0104E1 FD75 06             B   529    portugnp		ld (iy+period_for_fx_lo),l
0104E4 FD74 07             B   530    				ld (iy+period_for_fx_hi),h
0104E7 FD75 01             B   531    				ld (iy+period_lo),l
0104EA FD74 02             B   532    				ld (iy+period_hi),h
0104ED C9                  B   533    				ret
                           B   534    
                           B   535    				
                           B   536    ;--------- FX $02 -----------------------------
                           B   537    
0104EE                     B   538    fx_portamento_down			
                           B   539    
0104EE 0600                B   540    				ld b,0							0104F0 FD4E 05             B   541    				ld c,(iy+fx_args)				0104F3 FD6E 06             B   542    				ld l,(iy+period_for_fx_lo)
0104F6 FD66 07             B   543    				ld h,(iy+period_for_fx_hi)
0104F9 4009                B   544    				add.sis hl,bc
0104FB 7C                  B   545    				ld a,h
0104FC FE03                B   546    				cp 3
0104FE 38 0B               B   547    				jr c,portdgnp
010500 20 05               B   548    				jr nz,portdmax
010502 7D                  B   549    				ld a,l
010503 FE8B                B   550    				cp 139
010505 38 04               B   551    				jr c,portdgnp
010507 21580300            B   552    portdmax		ld hl,856
01050B FD75 06             B   553    portdgnp		ld (iy+period_for_fx_lo),l
01050E FD74 07             B   554    				ld (iy+period_for_fx_hi),h
010511 FD75 01             B   555    				ld (iy+period_lo),l
010514 FD74 02             B   556    				ld (iy+period_hi),h
010517 C9                  B   557    				ret
                           B   558    
                           B   559    
                           B   560    ;--------- FX $03 -----------------------------
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  19


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
                           B   561    
010518                     B   562    fx_tone_portamento
                           B   563    
010518 FD4E 09             B   564    				ld c,(iy+portamento_rate)		01051B FD7E 05             B   565    				ld a,(iy+fx_args)
01051E B7                  B   566    				or a
01051F 28 0B               B   567    				jr z,uexistpr
010521 4F                  B   568    				ld c,a
010522 FD7E 04             B   569    				ld a,(iy+fx_number)
010525 FE03                B   570    				cp 3							010527 20 03               B   571    				jr nz,uexistpr
010529 FD71 09             B   572    				ld (iy+portamento_rate),c	
01052C FD5E 10             B   573    uexistpr		ld e,(iy+portamento_dest_lo)	01052F FD56 11             B   574    				ld d,(iy+portamento_dest_hi)
010532 FD6E 06             B   575    				ld l,(iy+period_for_fx_lo)		010535 FD66 07             B   576    				ld h,(iy+period_for_fx_hi)
010538 AF                  B   577    				xor a
010539 40ED52              B   578    				sbc.sis hl,de					01053C C8                  B   579    				ret z							01053D 38 1E               B   580    				jr c,tp_peru					                           B   581    
01053F FD6E 06             B   582    tp_perd			ld l,(iy+period_for_fx_lo)		010542 FD66 07             B   583    				ld h,(iy+period_for_fx_hi)
010545 0600                B   584    				ld b,0
010547 AF                  B   585    				xor a
010548 40ED42              B   586    				sbc.sis hl,bc					01054B 30 04               B   587    				jr nc,tp_dnw					01054D 21000000            B   588    				ld hl,0
010551 4D                  B   589    tp_dnw			ld c,l							010552 44                  B   590    				ld b,h
010553 AF                  B   591    				xor a
010554 40ED52              B   592    				sbc.sis hl,de					010557 30 1A               B   593    				jr nc,chk_gliss
010559 4B                  B   594    				ld c,e
01055A 42                  B   595    				ld b,d
01055B 18 1C               B   596    				jr tp_end						                           B   597    
01055D FD6E 06             B   598    tp_peru			ld l,(iy+period_for_fx_lo)		010560 FD66 07             B   599    				ld h,(iy+period_for_fx_hi)
010563 0600                B   600    				ld b,0
010565 4009                B   601    				add.sis hl,bc
010567 4D                  B   602    				ld c,l							010568 44                  B   603    				ld b,h
010569 AF                  B   604    				xor a
01056A 40ED52              B   605    				sbc.sis hl,de		
01056D 38 04               B   606    				jr c,chk_gliss
01056F 4B                  B   607    				ld c,e							010570 42                  B   608    				ld b,d
010571 18 06               B   609    				jr tp_end	
                           B   610    
010573 FDCB 0F 4E          B   611    chk_gliss		bit 1,(iy+control_bits)			010577 20 0D               B   612    				jr nz,do_gliss		
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  20


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
                           B   613    				
010579 FD71 06             B   614    tp_end			ld (iy+period_for_fx_lo),c
01057C FD70 07             B   615    				ld (iy+period_for_fx_hi),b
01057F FD71 01             B   616    				ld (iy+period_lo),c	
010582 FD70 02             B   617    				ld (iy+period_hi),b
010585 C9                  B   618    				ret	
                           B   619    				
010586 FD71 06             B   620    do_gliss		ld (iy+period_for_fx_lo),c		010589 FD70 07             B   621    				ld (iy+period_for_fx_hi),b
01058C 11480000            B   622    				ld de,72
010590 FD56 14             B   623    				ld d,(iy+finetune)	
010593 ED5C                B   624    				mlt de
010595 21 93 0C 01         B   625    				ld hl,period_table_p0	
010599 19                  B   626    				add hl,de						01059A EB                  B   627    				ex de,hl						                           B   628    
01059B DDE5                B   629    				push ix
01059D D5                  B   630    				push de
01059E DDE1                B   631    				pop ix
0105A0 AF                  B   632    				xor a
0105A1 11000000            B   633    				ld de,0							0105A5 DD6E16              B   634    				ld l,(ix+22)					0105A8 DD6617              B   635    				ld h,(ix+23)
0105AB 40ED42              B   636    				sbc.sis hl,bc
0105AE 28 2F               B   637    				jr z,tp_glend
0105B0 38 15               B   638    				jr c,gltest
0105B2 11180000            B   639    				ld de,24
0105B6 DD6E2E              B   640    				ld l,(ix+46)
0105B9 DD662F              B   641    				ld h,(ix+47)
0105BC 40ED42              B   642    				sbc.sis hl,bc
0105BF 28 1E               B   643    				jr z,tp_glend
0105C1 38 04               B   644    				jr c,gltest
0105C3 11300000            B   645    				ld de,48
                           B   646    
0105C7 DD19                B   647    gltest			add ix,de
0105C9 50                  B   648    				ld d,b
0105CA 59                  B   649    				ld e,c
0105CB AF                  B   650    				xor a
0105CC 060C                B   651    				ld b,12
0105CE DD6E00              B   652    glissfper		ld l,(ix)						0105D1 DD6601              B   653    				ld h,(ix+1)
0105D4 40ED52              B   654    				sbc.sis hl,de
0105D7 30 0F               B   655    				jr nc,nggliss
0105D9 DD4E00              B   656    				ld c,(ix)
0105DC DD4601              B   657    				ld b,(ix+1)
0105DF FD71 01             B   658    tp_glend		ld (iy+period_lo),c	
0105E2 FD70 02             B   659    				ld (iy+period_hi),b
0105E5 DDE1                B   660    				pop ix
0105E7 C9                  B   661    				ret
                           B   662    
0105E8 DD23                B   663    nggliss			inc ix
0105EA DD23                B   664    				inc ix
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  21


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
0105EC 10 E0               B   665    				djnz glissfper
0105EE 42                  B   666    				ld b,d
0105EF 4B                  B   667    				ld c,e
0105F0 18 ED               B   668    				jr tp_glend
                           B   669    
                           B   670    
                           B   671    ;--------- FX $04 -----------------------------
                           B   672    
0105F2 FD46 0A             B   673    fx_vibrato		ld b,(iy+vibrato_args)			0105F5 FD7E 04             B   674    				ld a,(iy+fx_number)
0105F8 FE04                B   675    				cp 4
0105FA 20 1C               B   676    				jr nz,vibrsame					0105FC FD7E 05             B   677    				ld a,(iy+fx_args)
0105FF B7                  B   678    				or a
010600 28 16               B   679    				jr z,vibrsame					010602 4F                  B   680    				ld c,a
010603 E60F                B   681    				and 15
010605 28 06               B   682    				jr z,vibdsame					010607 57                  B   683    				ld d,a
010608 78                  B   684    				ld a,b
010609 E6F0                B   685    				and 0f0h
01060B B2                  B   686    				or d
01060C 47                  B   687    				ld b,a							01060D 79                  B   688    vibdsame		ld a,c
01060E E6F0                B   689    				and 0f0h
010610 28 06               B   690    				jr z,vibrsame					010612 4F                  B   691    				ld c,a
010613 78                  B   692    				ld a,b
010614 E60F                B   693    				and 0fh
010616 B1                  B   694    				or c							010617 47                  B   695    				ld b,a			
010618 FD70 0A             B   696    vibrsame		ld (iy+vibrato_args),b			                           B   697    				
01061B FD4E 0B             B   698    				ld c,(iy+vibrato_pos)
01061E CB39                B   699    				srl c
010620 CB39                B   700    				srl c
010622 79                  B   701    				ld a,c
010623 E61F                B   702    				and 1fh
010625 4F                  B   703    				ld c,a							010626 FD7E 0E             B   704    				ld a,(iy+wave_type)	
010629 E60F                B   705    				and 0fh
01062B B7                  B   706    				or a							01062C 28 1D               B   707    				jr z,vib_sine					01062E CB21                B   708    				sla c		
010630 CB21                B   709    				sla c
010632 CB21                B   710    				sla c							010634 FE01                B   711    				cp 1
010636 28 04               B   712    				jr z,vib_ramp					010638 1EFF                B   713    				ld e,255			
01063A 18 1A               B   714    				jr vib_gotd						                           B   715    
01063C FDCB 0B 7E          B   716    vib_ramp		bit 7,(iy+vibrato_pos)			Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  22


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
010640 28 06               B   717    				jr z,vibr2
010642 3EFF                B   718    				ld a,255
010644 91                  B   719    				sub c
010645 5F                  B   720    				ld e,a
010646 18 0E               B   721    				jr vib_gotd
010648 59                  B   722    vibr2			ld e,c
010649 18 0B               B   723    				jr vib_gotd
                           B   724    
01064B 21 13 11 01         B   725    vib_sine		ld hl,vibrato_table				01064F 11000000            B   726    				ld de,0
010653 59                  B   727    				ld e,c
010654 19                  B   728    				add hl,de
010655 5E                  B   729    				ld e,(hl)			
                           B   730    
010656 FD7E 0A             B   731    vib_gotd		ld a,(iy+vibrato_args)	
010659 E60F                B   732    				and 0fh			
01065B 57                  B   733    				ld d,a							01065C ED5C                B   734    				mlt de							01065E CB23                B   735    				sla e							010660 CB12                B   736    				rl d
010662 5A                  B   737    				ld e,d
010663 1600                B   738    				ld d,0
                           B   739    								
010665 FD6E 06             B   740    				ld l,(iy+period_for_fx_lo)		010668 FD66 07             B   741    				ld h,(iy+period_for_fx_hi)
01066B FDCB 0B 7E          B   742    				bit 7,(iy+vibrato_pos)
01066F 20 03               B   743    				jr nz,vib_sub	
010671 19                  B   744    				add hl,de						010672 18 03               B   745    				jr vib_pdone
010674 AF                  B   746    vib_sub			xor a
010675 ED52                B   747    				sbc hl,de						010677 FD75 01             B   748    vib_pdone		ld (iy+period_lo),l
01067A FD74 02             B   749    				ld (iy+period_hi),h
                           B   750    
01067D FD46 0B             B   751    				ld b,(iy+vibrato_pos)			010680 FD7E 0A             B   752    				ld a,(iy+vibrato_args)
010683 CB3F                B   753    				srl a
010685 CB3F                B   754    				srl a
010687 E63C                B   755    				and 3ch							010689 80                  B   756    				add a,b
01068A FD77 0B             B   757    				ld (iy+vibrato_pos),a			01068D C9                  B   758    				ret
                           B   759    
                           B   760    
                           B   761    ;-------- FX $05 ------------------------------
                           B   762    				
01068E                     B   763    fx_tone_portamento_volslide
                           B   764    
01068E CD 18 05 01         B   765    				call fx_tone_portamento
010692 C3 6B 07 01         B   766    				jp fx_volslide
                           B   767    
                           B   768    			
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  23


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
                           B   769    ;-------- FX $06 ------------------------------
                           B   770    				
010696                     B   771    fx_vibrato_volslide	
                           B   772    				
010696 CD F2 05 01         B   773    				call fx_vibrato
01069A C3 6B 07 01         B   774    				jp fx_volslide
                           B   775    				
                           B   776    				
                           B   777    ;-------- FX $07 ------------------------------
                           B   778    
01069E FD46 0C             B   779    fx_tremolo		ld b,(iy+tremolo_args)			0106A1 FD7E 05             B   780    				ld a,(iy+fx_args)
0106A4 B7                  B   781    				or a
0106A5 28 16               B   782    				jr z,trersame					0106A7 4F                  B   783    				ld c,a
0106A8 E60F                B   784    				and 15
0106AA 28 06               B   785    				jr z,tredsame					0106AC 57                  B   786    				ld d,a
0106AD 78                  B   787    				ld a,b
0106AE E6F0                B   788    				and 0f0h
0106B0 B2                  B   789    				or d
0106B1 47                  B   790    				ld b,a							0106B2 79                  B   791    tredsame		ld a,c
0106B3 E6F0                B   792    				and 0f0h
0106B5 28 06               B   793    				jr z,trersame					0106B7 4F                  B   794    				ld c,a
0106B8 78                  B   795    				ld a,b
0106B9 E60F                B   796    				and 0fh
0106BB B1                  B   797    				or c							0106BC 47                  B   798    				ld b,a			
0106BD FD70 0C             B   799    trersame		ld (iy+tremolo_args),b			                           B   800    				
0106C0 FD4E 0D             B   801    				ld c,(iy+tremolo_pos)
0106C3 CB39                B   802    				srl c
0106C5 CB39                B   803    				srl c
0106C7 79                  B   804    				ld a,c
0106C8 E61F                B   805    				and 1fh
0106CA 4F                  B   806    				ld c,a							0106CB FD7E 0E             B   807    				ld a,(iy+wave_type)				0106CE CB3F                B   808    				srl a
0106D0 CB3F                B   809    				srl a
0106D2 CB3F                B   810    				srl a
0106D4 CB3F                B   811    				srl a
0106D6 E60F                B   812    				and 0fh							0106D8 28 1D               B   813    				jr z,tre_sine					0106DA CB21                B   814    				sla c		
0106DC CB21                B   815    				sla c
0106DE CB21                B   816    				sla c							0106E0 FE01                B   817    				cp 1
0106E2 28 04               B   818    				jr z,tre_ramp					0106E4 1EFF                B   819    				ld e,255			
0106E6 18 1A               B   820    				jr tre_gotd						Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  24


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
                           B   821    
0106E8 FDCB 0D 7E          B   822    tre_ramp		bit 7,(iy+tremolo_pos)			0106EC 28 06               B   823    				jr z,trer2
0106EE 3EFF                B   824    				ld a,255
0106F0 91                  B   825    				sub c
0106F1 5F                  B   826    				ld e,a
0106F2 18 0E               B   827    				jr tre_gotd
0106F4 59                  B   828    trer2			ld e,c
0106F5 18 0B               B   829    				jr tre_gotd
                           B   830    
0106F7 21 13 11 01         B   831    tre_sine		ld hl,vibrato_table				0106FB 11000000            B   832    				ld de,0
0106FF 59                  B   833    				ld e,c
010700 19                  B   834    				add hl,de
010701 5E                  B   835    				ld e,(hl)
                           B   836    		
010702 FD7E 0C             B   837    tre_gotd		ld a,(iy+tremolo_args)	
010705 E60F                B   838    				and 0fh			
010707 57                  B   839    				ld d,a							010708 ED5C                B   840    				mlt de							01070A CB23                B   841    				sla e							01070C CB12                B   842    				rl d
01070E CB23                B   843    				sla e
010710 CB12                B   844    				rl d
010712 5A                  B   845    				ld e,d
                           B   846    				
010713 FD7E 08             B   847    tshftl			ld a,(iy+volume_for_fx)			010716 FDCB 0D 7E          B   848    				bit 7,(iy+tremolo_pos)
01071A 20 09               B   849    				jr nz,tre_sub	
01071C 83                  B   850    				add a,e							01071D FE40                B   851    				cp 64
01071F 38 08               B   852    				jr c,tre_done
010721 3E40                B   853    				ld a,64
010723 18 04               B   854    				jr tre_done
010725 93                  B   855    tre_sub			sub e							010726 30 01               B   856    				jr nc,tre_done
010728 AF                  B   857    				xor a
010729 FD77 03             B   858    tre_done		ld (iy+volume),a
                           B   859    				
01072C FD46 0D             B   860    				ld b,(iy+tremolo_pos)			01072F FD7E 0C             B   861    				ld a,(iy+tremolo_args)
010732 CB3F                B   862    				srl a
010734 CB3F                B   863    				srl a
010736 E63C                B   864    				and 3ch							010738 80                  B   865    				add a,b
010739 FD77 0D             B   866    				ld (iy+tremolo_pos),a			01073C C9                  B   867    				ret
                           B   868    
                           B   869    ;-------- FX $09 ------------------------------
                           B   870    
01073D                     B   871    fx_sample_offset
                           B   872    
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  25


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
01073D FD7E 05             B   873    				ld a,(iy+fx_args)		
010740 B7                  B   874    				or a
010741 28 08               B   875    				jr z,usexoffs					010743 01000000            B   876    				ld bc,0
010747 47                  B   877    				ld b,a
010748 FD0F 23             B   878    				ld (iy+sample_offset),bc		                           B   879    							
01074B FD07 23             B   880    usexoffs		ld bc,(iy+sample_offset)		01074E FD27 1A             B   881    				ld hl,(iy+sample_length)
010751 AF                  B   882    				xor a
010752 ED42                B   883    				sbc hl,bc
010754 28 0D               B   884    				jr z,soffbad
010756 38 0B               B   885    				jr c,soffbad
010758 FD2F 1A             B   886    				ld (iy+sample_length),hl		01075B FD27 17             B   887    				ld hl,(iy+sample_location)
01075E 09                  B   888    				add hl,bc
01075F FD2F 17             B   889    				ld (iy+sample_location),hl		010762 C9                  B   890    				ret
                           B   891    
010763 21020000            B   892    soffbad			ld hl,2
010767 FD2F 1A             B   893    				ld (iy+sample_length),hl		01076A C9                  B   894    				ret
                           B   895    				
                           B   896    
                           B   897    ;-------- FX $0A ------------------------------
                           B   898    
                           B   899    
01076B FD7E 05             B   900    fx_volslide		ld a,(iy+fx_args)				01076E 47                  B   901    				ld b,a
01076F E60F                B   902    				and 15			
010771 28 0B               B   903    				jr z,volup
010773 FD7E 03             B   904    				ld a,(iy+volume)
010776 90                  B   905    				sub b
010777 30 01               B   906    				jr nc,voldok
010779 AF                  B   907    				xor a
01077A FD77 03             B   908    voldok			ld (iy+volume),a
01077D C9                  B   909    				ret
                           B   910    
01077E 78                  B   911    volup			ld a,b							01077F 0F                  B   912    				rrca
010780 0F                  B   913    				rrca
010781 0F                  B   914    				rrca
010782 0F                  B   915    				rrca
010783 FD86 03             B   916    				add a,(iy+volume)
010786 FE40                B   917    				cp 64
010788 38 02               B   918    				jr c,voluok
01078A 3E40                B   919    				ld a,64
01078C FD77 03             B   920    voluok			ld (iy+volume),a
01078F C9                  B   921    				ret
                           B   922    
                           B   923    
                           B   924    ;-------- FX $0B ------------------------------
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  26


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
                           B   925    
010790                     B   926    fx_position_jump
                           B   927    
010790 FD7E 05             B   928    				ld a,(iy+fx_args)
010793 32 95 11 01         B   929    				ld (songpos),a
010797 3EFF                B   930    				ld a,255
010799 32 96 11 01         B   931    				ld (patindex),a
01079D C9                  B   932    				ret
                           B   933    
                           B   934    
                           B   935    ;-------- FX $0C ------------------------------
                           B   936    
01079E                     B   937    fx_set_volume
                           B   938    				
01079E FD7E 05             B   939    				ld a,(iy+fx_args)
0107A1 FE40                B   940    				cp 40h
0107A3 38 02               B   941    				jr c,vsetok
0107A5 3E40                B   942    				ld a,40h
0107A7 FD77 03             B   943    vsetok			ld (iy+volume),a
0107AA FD77 13             B   944    				ld (iy+volume_waiting),a
0107AD C9                  B   945    				ret
                           B   946    
                           B   947    
                           B   948    ;-------- FX $0D ------------------------------
                           B   949    
0107AE                     B   950    fx_pattern_break
                           B   951    				
0107AE FD7E 05             B   952    				ld a,(iy+fx_args)
0107B1 47                  B   953    				ld b,a
0107B2 CB3F                B   954    				srl a
0107B4 CB3F                B   955    				srl a
0107B6 CB3F                B   956    				srl a
0107B8 CB3F                B   957    				srl a
0107BA 4F                  B   958    				ld c,a
0107BB 81                  B   959    				add a,c
0107BC 81                  B   960    				add a,c
0107BD 81                  B   961    				add a,c
0107BE 81                  B   962    				add a,c
0107BF CB27                B   963    				sla a
0107C1 4F                  B   964    				ld c,a
0107C2 78                  B   965    				ld a,b
0107C3 E60F                B   966    				and 0fh
0107C5 81                  B   967    				add a,c
0107C6 3D                  B   968    				dec a
0107C7 32 96 11 01         B   969    				ld (patindex),a
0107CB 21 95 11 01         B   970    				ld hl,songpos
0107CF 34                  B   971    				inc (hl)
0107D0 3A CA 1D 01         B   972    				ld a,(music_module+950)
0107D4 BE                  B   973    				cp (hl)							0107D5 20 02               B   974    				jr nz,nspw_pb
0107D7 3600                B   975    				ld (hl),0
0107D9 C9                  B   976    nspw_pb			ret
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  27


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
                           B   977    
                           B   978    				
                           B   979    ;-------- FX $0E ------------------------------
                           B   980    
                           B   981    
0107DA                     B   982    fx_extended_fx
                           B   983    
0107DA FD7E 05             B   984    				ld a,(iy+fx_args)
0107DD 47                  B   985    				ld b,a
0107DE E6F0                B   986    				and 0f0h
0107E0 FE00                B   987    				cp 0h
0107E2 28 4B               B   988    				jr z,e0_filter
0107E4 FE10                B   989    				cp 10h
0107E6 28 4F               B   990    				jr z,e1_fineport_up
0107E8 FE20                B   991    				cp 20h
0107EA 28 78               B   992    				jr z,e2_fineport_down
0107EC FE30                B   993    				cp 30h
0107EE CA 90 08 01         B   994    				jp z,e3_glissando_control
0107F2 FE40                B   995    				cp 40h
0107F4 CA 9D 08 01         B   996    				jp z,e4_vibrato_control
0107F8 FE50                B   997    				cp 50h
0107FA CA AB 08 01         B   998    				jp z,e5_finetune_control
0107FE FE60                B   999    				cp 60h
010800 CA B2 08 01         B  1000    				jp z,e6_pattern_loop
010804 FE70                B  1001    				cp 70h
010806 CA DE 08 01         B  1002    				jp z,e7_tremolo_control
01080A FE90                B  1003    				cp 90h
01080C CA F4 08 01         B  1004    				jp z,e9_retrigger_note
010810 FEA0                B  1005    				cp 0a0h
010812 CA 0B 09 01         B  1006    				jp z,ea_finevol_up
010816 FEB0                B  1007    				cp 0b0h
010818 CA 21 09 01         B  1008    				jp z,eb_finevol_down
01081C FEC0                B  1009    				cp 0c0h
01081E CA 36 09 01         B  1010    				jp z,ec_cutnote
010822 FED0                B  1011    				cp 0d0h
010824 CA 45 09 01         B  1012    				jp z,ed_delayedtrig
010828 FEE0                B  1013    				cp 0e0h
01082A CA 87 09 01         B  1014    				jp z,ee_pattdelay
01082E C9                  B  1015    				ret
                           B  1016    
01082F                     B  1017    e0_filter
                           B  1018    
01082F 78                  B  1019    				ld a,b							010830 E601                B  1020    				and 01h			
010832 32 9D 11 01         B  1021    				ld (filter_on_off),a
010836 C9                  B  1022    				ret
                           B  1023    				
                           B  1024    
010837                     B  1025    e1_fineport_up
                           B  1026    
010837 3A 94 11 01         B  1027    				ld a,(ticker)
01083B B7                  B  1028    				or a
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  28


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
01083C C0                  B  1029    				ret nz
01083D 0600                B  1030    				ld b,0							01083F FD7E 05             B  1031    				ld a,(iy+fx_args)		
010842 E60F                B  1032    				and 0fh
010844 4F                  B  1033    				ld c,a
010845 FD6E 01             B  1034    				ld l,(iy+period_lo)
010848 FD66 02             B  1035    				ld h,(iy+period_hi)
01084B AF                  B  1036    				xor a
01084C 40ED42              B  1037    				sbc.sis hl,bc
01084F 38 08               B  1038    				jr c,fportumin
010851 B4                  B  1039    				or h
010852 20 09               B  1040    				jr nz,fportugnp
010854 7D                  B  1041    				ld a,l
010855 FE71                B  1042    				cp 113
010857 30 04               B  1043    				jr nc,fportugnp
010859 21710000            B  1044    fportumin		ld hl,113						01085D FD75 01             B  1045    fportugnp		ld (iy+period_lo),l
010860 FD74 02             B  1046    				ld (iy+period_hi),h
010863 C9                  B  1047    				ret
                           B  1048    
                           B  1049    
010864                     B  1050    e2_fineport_down
                           B  1051    				
010864 3A 94 11 01         B  1052    				ld a,(ticker)
010868 B7                  B  1053    				or a
010869 C0                  B  1054    				ret nz
01086A 0600                B  1055    				ld b,0							01086C FD7E 05             B  1056    				ld a,(iy+fx_args)		
01086F E60F                B  1057    				and 0fh
010871 4F                  B  1058    				ld c,a
010872 FD6E 01             B  1059    				ld l,(iy+period_lo)
010875 FD66 02             B  1060    				ld h,(iy+period_hi)
010878 09                  B  1061    				add hl,bc
010879 7C                  B  1062    				ld a,h
01087A FE03                B  1063    				cp 3
01087C 38 0B               B  1064    				jr c,fportdgnp
01087E 20 05               B  1065    				jr nz,fportdmax
010880 7D                  B  1066    				ld a,l
010881 FE58                B  1067    				cp 88
010883 38 04               B  1068    				jr c,fportdgnp
010885 21580300            B  1069    fportdmax		ld hl,856						010889 FD75 01             B  1070    fportdgnp		ld (iy+period_lo),l
01088C FD74 02             B  1071    				ld (iy+period_hi),h
01088F C9                  B  1072    				ret
                           B  1073    
                           B  1074    
010890                     B  1075    e3_glissando_control
                           B  1076    
010890 FDCB 0F 8E          B  1077    				res 1,(iy+control_bits)
010894 78                  B  1078    				ld a,b
010895 E601                B  1079    				and 01h
010897 C8                  B  1080    				ret z
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  29


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
010898 FDCB 0F CE          B  1081    				set 1,(iy+control_bits)
01089C C9                  B  1082    				ret
                           B  1083    
                           B  1084    
01089D                     B  1085    e4_vibrato_control
                           B  1086    				
01089D 78                  B  1087    				ld a,b
01089E E607                B  1088    				and 07h
0108A0 47                  B  1089    				ld b,a
0108A1 FD7E 0E             B  1090    				ld a,(iy+wave_type)
0108A4 E6F0                B  1091    				and 0f0h
0108A6 B0                  B  1092    				or b
0108A7 FD77 0E             B  1093    				ld (iy+wave_type),a
0108AA C9                  B  1094    				ret
                           B  1095    
                           B  1096    
0108AB                     B  1097    e5_finetune_control
                           B  1098    				
0108AB 78                  B  1099    				ld a,b							0108AC E60F                B  1100    				and 0fh			
0108AE FD77 14             B  1101    				ld (iy+finetune),a
0108B1 C9                  B  1102    				ret
                           B  1103    
                           B  1104    
0108B2                     B  1105    e6_pattern_loop
                           B  1106    
0108B2 3A 94 11 01         B  1107    				ld a,(ticker)
0108B6 B7                  B  1108    				or a
0108B7 C0                  B  1109    				ret nz
0108B8 78                  B  1110    				ld a,b
0108B9 E60F                B  1111    				and 0fh
0108BB 28 18               B  1112    				jr z,setplp
0108BD 21 9A 11 01         B  1113    				ld hl,pattloop_count
0108C1 34                  B  1114    				inc (hl)
0108C2 BE                  B  1115    				cp (hl)
0108C3 38 0A               B  1116    				jr c,plp_end
0108C5 3A 99 11 01         B  1117    				ld a,(pattloop_pos)				0108C9 3D                  B  1118    				dec a							0108CA 32 96 11 01         B  1119    				ld (patindex),a
0108CE C9                  B  1120    				ret
0108CF AF                  B  1121    plp_end			xor a			
0108D0 32 9A 11 01         B  1122    				ld (pattloop_count),a			0108D4 C9                  B  1123    				ret
0108D5 3A 96 11 01         B  1124    setplp			ld a,(patindex)					0108D9 32 99 11 01         B  1125    				ld (pattloop_pos),a
0108DD C9                  B  1126    				ret
                           B  1127    				
                           B  1128    
0108DE                     B  1129    e7_tremolo_control
                           B  1130    				
0108DE 78                  B  1131    				ld a,b
0108DF E607                B  1132    				and 07h
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  30


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
0108E1 47                  B  1133    				ld b,a
0108E2 CB20                B  1134    				sla b
0108E4 CB20                B  1135    				sla b
0108E6 CB20                B  1136    				sla b
0108E8 CB20                B  1137    				sla b
0108EA FD7E 0E             B  1138    				ld a,(iy+wave_type)
0108ED E60F                B  1139    				and 0fh
0108EF B0                  B  1140    				or b
0108F0 FD77 0E             B  1141    				ld (iy+wave_type),a
0108F3 C9                  B  1142    				ret
                           B  1143    				
                           B  1144    
0108F4                     B  1145    e9_retrigger_note
                           B  1146    
0108F4 78                  B  1147    				ld a,b
0108F5 E60F                B  1148    				and 0fh
0108F7 C8                  B  1149    				ret z
0108F8 47                  B  1150    				ld b,a
0108F9 3A 94 11 01         B  1151    				ld a,(ticker)
0108FD B7                  B  1152    				or a
0108FE 28 06               B  1153    				jr z,retrigit
010900 90                  B  1154    rtloop			sub b
010901 28 03               B  1155    				jr z,retrigit
010903 30 FB               B  1156    				jr nc,rtloop
010905 C9                  B  1157    				ret
010906 FDCB 0F C6          B  1158    retrigit		set 0,(iy+control_bits)
01090A C9                  B  1159    				ret
                           B  1160    				
                           B  1161    
                           B  1162    
01090B                     B  1163    ea_finevol_up
                           B  1164    
01090B 3A 94 11 01         B  1165    				ld a,(ticker)
01090F B7                  B  1166    				or a
010910 C0                  B  1167    				ret nz
010911 78                  B  1168    				ld a,b
010912 E60F                B  1169    				and 0fh
010914 FD86 03             B  1170    				add a,(iy+volume)
010917 FE40                B  1171    				cp 64
010919 38 02               B  1172    				jr c,eavolok
01091B 3E40                B  1173    				ld a,64
01091D FD77 03             B  1174    eavolok			ld (iy+volume),a
010920 C9                  B  1175    				ret
                           B  1176    				
                           B  1177    
010921                     B  1178    eb_finevol_down
                           B  1179    					
010921 3A 94 11 01         B  1180    				ld a,(ticker)
010925 B7                  B  1181    				or a
010926 C0                  B  1182    				ret nz
010927 78                  B  1183    				ld a,b
010928 E60F                B  1184    				and 0fh
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  31


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
01092A 47                  B  1185    				ld b,a
01092B FD7E 03             B  1186    				ld a,(iy+volume)
01092E 90                  B  1187    				sub b
01092F 30 01               B  1188    				jr nc,ebvolok
010931 AF                  B  1189    				xor a
010932 FD77 03             B  1190    ebvolok			ld (iy+volume),a
010935 C9                  B  1191    				ret
                           B  1192    
                           B  1193    
010936                     B  1194    ec_cutnote
                           B  1195    
010936 78                  B  1196    				ld a,b
010937 E60F                B  1197    				and 0fh
010939 47                  B  1198    				ld b,a
01093A 3A 94 11 01         B  1199    				ld a,(ticker)
01093E B8                  B  1200    				cp b
01093F C0                  B  1201    				ret nz
010940 AF                  B  1202    				xor a
010941 FD77 03             B  1203    				ld (iy+volume),a
010944 C9                  B  1204    				ret
                           B  1205    				
                           B  1206    
                           B  1207    
                           B  1208    				
010945                     B  1209    ed_delayedtrig	
                           B  1210    				
010945 78                  B  1211    				ld a,b
010946 E60F                B  1212    				and 0fh
010948 47                  B  1213    				ld b,a
010949 3A 94 11 01         B  1214    				ld a,(ticker)
01094D B8                  B  1215    				cp b
01094E C0                  B  1216    				ret nz
                           B  1217    				
01094F FDCB 0F 5E          B  1218    				bit 3,(iy+control_bits)			010953 28 17               B  1219    				jr z,ed_nonewp2
010955 FD4E 06             B  1220    				ld c,(iy+period_for_fx_lo)		010958 FD46 07             B  1221    				ld b,(iy+period_for_fx_hi)
01095B FD71 01             B  1222    				ld (iy+period_lo),c
01095E FD70 02             B  1223    				ld (iy+period_hi),b
010961 FDCB 0F C6          B  1224    				set 0,(iy+control_bits)			010965 FD7E 12             B  1225    				ld a,(iy+instrument_waiting)	010968 B7                  B  1226    				or a
010969 C8                  B  1227    				ret z
01096A 18 0E               B  1228    				jr ed_do_vol					                           B  1229    				
01096C                     B  1230    ed_nonewp2
                           B  1231    
01096C FD7E 12             B  1232    				ld a,(iy+instrument_waiting)	01096F B7                  B  1233    				or a							010970 C8                  B  1234    				ret z
010971 FDBE 00             B  1235    				cp (iy+instrument)			
010974 28 04               B  1236    				jr z,ed_do_vol
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  32


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
010976 FDCB 0F C6          B  1237    				set 0,(iy+control_bits)
                           B  1238    
01097A FD77 00             B  1239    ed_do_vol		ld (iy+instrument),a
01097D FD7E 13             B  1240    				ld a,(iy+volume_waiting)		010980 FD77 03             B  1241    				ld (iy+volume),a	
010983 FD77 08             B  1242    				ld (iy+volume_for_fx),a			010986 C9                  B  1243    				ret
                           B  1244    
                           B  1245    
                           B  1246    
                           B  1247    				
                           B  1248    				
010987                     B  1249    ee_pattdelay
                           B  1250    
010987 3A 9C 11 01         B  1251    				ld a,(pattdelay_flag)			01098B B7                  B  1252    				or a
01098C C0                  B  1253    				ret nz
01098D 78                  B  1254    				ld a,b
01098E E60F                B  1255    				and 0fh
010990 32 9B 11 01         B  1256    				ld (pattdelay_count),a
010994 3E01                B  1257    				ld a,1
010996 32 9C 11 01         B  1258    				ld (pattdelay_flag),a
01099A C9                  B  1259    				ret
                           B  1260    				
                           B  1261    
                           B  1262    
                           B  1263    ;-------- FX $0F ------------------------------
                           B  1264    
01099B                     B  1265    fx_set_speed
01099B FD7E 05             B  1266    				ld a,(iy+fx_args)
01099E 32 97 11 01         B  1267    				ld (songspeed),a
0109A2 C9                  B  1268    				ret
                           B  1269    
                           B  1270    
                           B  1271    ;---- Amiga Period List -----------------------
                           B  1272    
0109A3                     B  1273    period_lookup_table	
                           B  1274    
0109A3 23000000 00000022   B  1275    					DB 35,0,0,0,0,0,0,34,0,0,0,
0109AB 00000000 00002100 
0109B3 00000000 00002000   B  1276    					DB 0,0,0,0,0,0,32,0,0,0,0,0
0109BB 00000000 00001F00 
0109C3 00000000 00001E00   B  1277    					DB 0,0,0,0,0,0,30,0,0,0,0,0
0109CB 00000000 0000001D 
0109D3 00000000 00000000   B  1278    					DB 0,0,0,0,0,0,0,0,0,28,0,0
0109DB 001C0000 00000000 
0109E3 0000001B 00000000   B  1279    					DB 0,0,0,27,0,0,0,0,0,0,0,0
0109EB 00000000 001A0000 
0109F3 00000000 00000000   B  1280    					DB 0,0,0,0,0,0,0,0,0,25,0,0
0109FB 00190000 00000000 
010A03 00000000 00180000   B  1281    					DB 0,0,0,0,0,24,0,0,0,0,0,0
010A0B 00000000 00000000 
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  33


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
010A13 00170000 00000000   B  1282    					DB 0,23,0,0,0,0,0,0,0,0,0,0
010A1B 00000000 00000016 
010A23 00000000 00000000   B  1283    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010A2B 00000000 00150000 
010A33 00000000 00000000   B  1284    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010A3B 00000000 14000000 
010A43 00000000 00000000   B  1285    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010A4B 00000000 13000000 
010A53 00000000 00000000   B  1286    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010A5B 00000000 00120000 
010A63 00000000 00000000   B  1287    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010A6B 00000000 00000011 
010A73 00000000 00000000   B  1288    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010A7B 00000000 00000000 
010A83 00001000 00000000   B  1289    					DB 0,0,16,0,0,0,0,0,0,0,0,0
010A8B 00000000 00000000 
010A93 00000000 0000000F   B  1290    					DB 0,0,0,0,0,0,0,15,0,0,0,0
010A9B 00000000 00000000 
010AA3 00000000 00000000   B  1291    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010AAB 00000000 0E000000 
010AB3 00000000 00000000   B  1292    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010ABB 00000000 00000000 
010AC3 0000000D 00000000   B  1293    					DB 0,0,0,13,0,0,0,0,0,0,0,0
010ACB 00000000 00000000 
010AD3 00000000 00000000   B  1294    					DB 0,0,0,0,0,0,0,0,0,0,0,12
010ADB 0000000C 00000000 
010AE3 00000000 00000000   B  1295    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010AEB 00000000 00000000 
010AF3 00000000 0B000000   B  1296    					DB 0,0,0,0,11,0,0,0,0,0,0,0
010AFB 00000000 00000000 
010B03 00000000 00000000   B  1297    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010B0B 00000000 0000000A 
010B13 00000000 00000000   B  1298    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010B1B 00000000 00000000 
010B23 00000000 00000000   B  1299    					DB 0,0,0,0,0,0,0,0,0,0,0,9,
010B2B 00000009 00000000 
010B33 00000000 00000000   B  1300    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010B3B 00000000 00000000 
010B43 00000000 00000000   B  1301    					DB 0,0,0,0,0,0,0,0,0,8,0,0,
010B4B 00080000 00000000 
010B53 00000000 00000000   B  1302    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010B5B 00000000 00000000 
010B63 00000000 00000000   B  1303    					DB 0,0,0,0,0,0,0,0,0,7,0,0,
010B6B 00070000 00000000 
010B73 00000000 00000000   B  1304    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010B7B 00000000 00000000 
010B83 00000000 00000000   B  1305    					DB 0,0,0,0,0,0,0,0,0,0,0,6,
010B8B 00000006 00000000 
010B93 00000000 00000000   B  1306    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010B9B 00000000 00000000 
010BA3 00000000 00000000   B  1307    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010BAB 00000000 00000005 
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  34


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
010BB3 00000000 00000000   B  1308    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010BBB 00000000 00000000 
010BC3 00000000 00000000   B  1309    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010BCB 00000000 00000000 
010BD3 00000000 00040000   B  1310    					DB 0,0,0,0,0,4,0,0,0,0,0,0,
010BDB 00000000 00000000 
010BE3 00000000 00000000   B  1311    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010BEB 00000000 00000000 
010BF3 00000000 00000000   B  1312    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010BFB 00000000 00000003 
010C03 00000000 00000000   B  1313    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010C0B 00000000 00000000 
010C13 00000000 00000000   B  1314    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010C1B 00000000 00000000 
010C23 00000000 00000000   B  1315    					DB 0,0,0,0,0,0,0,0,0,2,0,0,
010C2B 00020000 00000000 
010C33 00000000 00000000   B  1316    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010C3B 00000000 00000000 
010C43 00000000 00000000   B  1317    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010C4B 00000000 00000000 
010C53 00000000 00000001   B  1318    					DB 0,0,0,0,0,0,0,1,0,0,0,0,
010C5B 00000000 00000000 
010C63 00000000 00000000   B  1319    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010C6B 00000000 00000000 
010C73 00000000 00000000   B  1320    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010C7B 00000000 00000000 
010C83 00000000 00000000   B  1321    					DB 0,0,0,0,0,0,0,0,0,0,0,0,
010C8B 00000000 00000000 
                           B  1322    
                           B  1323    
010C93 58032803 FA02D002   B  1324    period_table_p0	dw 856,808,762,720,678,640,604,
010C9B A6028002 5C023A02 
010CA3 1A02FC01 E001C501 
010CAB AC019401 7D016801   B  1325    				dw 428,404,381,360,339,320,302,
010CB3 53014001 2E011D01 
010CBB 0D01FE00 F000E200 
010CC3 D600CA00 BE00B400   B  1326    				dw 214,202,190,180,170,160,151,
010CCB AA00A000 97008F00 
010CD3 87007F00 78007100 
                           B  1327    
010CDB 52032203 F502CB02   B  1328    period_table_p1	dw 850,802,757,715,674,637,601,
010CE3 A2027D02 59023702 
010CEB 1702F901 DD01C201 
010CF3 A9019101 7B016501   B  1329    				dw 425,401,379,357,337,318,300,
010CFB 51013E01 2C011C01 
010D03 0C01FD00 EF00E100 
010D0B D500C900 BD00B300   B  1330    				dw 213,201,189,179,169,159,150,
010D13 A9009F00 96008E00 
010D1B 86007E00 77007100 
                           B  1331    
010D23 4C031C03 F002C502   B  1332    period_table_p2	dw 844,796,752,709,670,632,597,
010D2B 9E027802 55023302 
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  35


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
010D33 1402F601 DA01BF01 
010D3B A6018E01 78016301   B  1333    				dw 422,398,376,355,335,316,298,
010D43 4F013C01 2A011A01 
010D4B 0A01FB00 ED00E000 
010D53 D300C700 BC00B100   B  1334    				dw 211,199,188,177,167,158,149,
010D5B A7009E00 95008D00 
010D63 85007D00 76007000 
                           B  1335    
010D6B 46031703 EA02C002   B  1336    period_table_p3	dw 838,791,746,704,665,628,592,
010D73 99027402 50022F02 
010D7B 1002F201 D601BC01 
010D83 A3018B01 75016001   B  1337    				dw 419,395,373,352,332,314,296,
010D8B 4C013A01 28011801 
010D93 0801F900 EB00DE00 
010D9B D100C600 BB00B000   B  1338    				dw 209,198,187,176,166,157,148,
010DA3 A6009D00 94008C00 
010DAB 84007D00 76006F00 
                           B  1339    
010DB3 40031103 E502BB02   B  1340    period_table_p4	dw 832,785,741,699,660,623,588,
010DBB 94026F02 4C022B02 
010DC3 0C02EF01 D301B901 
010DCB A0018801 72015E01   B  1341    				dw 416,392,370,350,330,312,294,
010DD3 4A013801 26011601 
010DDB 0601F700 E900DC00 
010DE3 D000C400 B900AF00   B  1342    				dw 208,196,185,175,165,156,147,
010DEB A5009C00 93008B00 
010DF3 83007C00 75006E00 
                           B  1343    
010DFB 3A030B03 E002B602   B  1344    period_table_p5	dw 826,779,736,694,655,619,584,
010E03 8F026B02 48022702 
010E0B 0802EB01 CF01B501 
010E13 9D018601 70015B01   B  1345    				dw 413,390,368,347,328,309,292,
010E1B 48013501 24011401 
010E23 0401F500 E800DB00 
010E2B CE00C300 B800AE00   B  1346    				dw 206,195,184,174,164,155,146,
010E33 A4009B00 92008A00 
010E3B 82007B00 74006D00 
                           B  1347    
010E43 34030603 DA02B102   B  1348    period_table_p6	dw 820,774,730,689,651,614,580,
010E4B 8B026602 44022302 
010E53 0402E701 CC01B201 
010E5B 9A018301 6D015901   B  1349    				dw 410,387,365,345,325,307,290,
010E63 45013301 22011201 
010E6B 0201F400 E600D900 
010E73 CD00C100 B700AC00   B  1350    				dw 205,193,183,172,163,154,145,
010E7B A3009A00 91008900 
010E83 81007A00 73006D00 
                           B  1351    
010E8B 2E030003 D502AC02   B  1352    period_table_p7	dw 814,768,725,684,646,610,575,
010E93 86026202 3F021F02 
010E9B 0102E401 C901AF01 
010EA3 97018001 6B015601   B  1353    				dw 407,384,363,342,323,305,288,
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  36


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
010EAB 43013101 20011001 
010EB3 0001F200 E400D800 
010EBB CC00C000 B500AB00   B  1354    				dw 204,192,181,171,161,152,144,
010EC3 A1009800 90008800 
010ECB 80007900 72006C00 
                           B  1355    
010ED3 8B035803 2803FA02   B  1356    period_table_m8	dw 907,856,808,762,720,678,640,
010EDB D002A602 80025C02 
010EE3 3A021A02 FC01E001 
010EEB C501AC01 94017D01   B  1357    				dw 453,428,404,381,360,339,320,
010EF3 68015301 40012E01 
010EFB 1D010D01 FE00F000 
010F03 E200D600 CA00BE00   B  1358    				dw 226,214,202,190,180,170,160,
010F0B B400AA00 A0009700 
010F13 8F008700 7F007800 
                           B  1359    
010F1B 84035203 2203F502   B  1360    period_table_m7	dw 900,850,802,757,715,675,636,
010F23 CB02A302 7C025902 
010F2B 37021702 F901DD01 
010F33 C201A901 91017B01   B  1361    				dw 450,425,401,379,357,337,318,
010F3B 65015101 3E012C01 
010F43 1C010C01 FD00EE00 
010F4B E100D400 C800BD00   B  1362    				dw 225,212,200,189,179,169,159,
010F53 B300A900 9F009600 
010F5B 8E008600 7E007700 
                           B  1363    
010F63 7E034C03 1C03F002   B  1364    period_table_m6	dw 894,844,796,752,709,670,632,
010F6B C5029E02 78025502 
010F73 33021402 F601DA01 
010F7B BF01A601 8E017801   B  1365    				dw 447,422,398,376,355,335,316,
010F83 63014F01 3C012A01 
010F8B 1A010A01 FB00ED00 
010F93 DF00D300 C700BC00   B  1366    				dw 223,211,199,188,177,167,158,
010F9B B100A700 9E009500 
010FA3 8D008500 7D007600 
                           B  1367    
010FAB 77034603 1703EA02   B  1368    period_table_m5	dw 887,838,791,746,704,665,628,
010FB3 C0029902 74025002 
010FBB 2F021002 F201D601 
010FC3 BC01A301 8B017501   B  1369    				dw 444,419,395,373,352,332,314,
010FCB 60014C01 3A012801 
010FD3 18010801 F900EB00 
010FDB DE00D100 C600BB00   B  1370    				dw 222,209,198,187,176,166,157,
010FE3 B000A600 9D009400 
010FEB 8C008400 7D007600 
                           B  1371    
010FF3 71034003 1103E502   B  1372    period_table_m4	dw 881,832,785,741,699,660,623,
010FFB BB029402 6F024C02 
011003 2B020C02 EE01D301 
01100B B901A001 88017201   B  1373    				dw 441,416,392,370,350,330,312,
011013 5E014A01 38012601 
01101B 16010601 F700E900 
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  37


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
011023 DC00D000 C400B900   B  1374    				dw 220,208,196,185,175,165,156,
01102B AF00A500 9C009300 
011033 8B008300 7B007500 
                           B  1375    
01103B 6B033A03 0B03E002   B  1376    period_table_m3	dw 875,826,779,736,694,655,619,
011043 B6028F02 6B024802 
01104B 27020802 EB01CF01 
011053 B5019D01 86017001   B  1377    				dw 437,413,390,368,347,328,309,
01105B 5B014801 35012401 
011063 14010401 F500E800 
01106B DB00CE00 C300B800   B  1378    				dw 219,206,195,184,174,164,155,
011073 AE00A400 9B009200 
01107B 8A008200 7B007400 
                           B  1379    
011083 64033403 0603DA02   B  1380    period_table_m2	dw 868,820,774,730,689,651,614,
01108B B1028B02 66024402 
011093 23020402 E701CC01 
01109B B2019A01 83016D01   B  1381    				dw 434,410,387,365,345,325,307,
0110A3 59014501 33012201 
0110AB 12010201 F400E600 
0110B3 D900CD00 C100B700   B  1382    				dw 217,205,193,183,172,163,154,
0110BB AC00A300 9A009100 
0110C3 89008100 7A007300 
                           B  1383    
0110CB 5E032E03 0003D502   B  1384    period_table_m1	dw 862,814,768,725,684,646,610,
0110D3 AC028602 62023F02 
0110DB 1F020102 E401C901 
0110E3 AF019701 80016B01   B  1385    				dw 431,407,384,363,342,323,305,
0110EB 56014301 31012001 
0110F3 10010001 F200E400 
0110FB D800CB00 C000B500   B  1386    				dw 216,203,192,181,171,161,152,
011103 AB00A100 98009000 
01110B 88008000 79007200 
                           B  1387    
                           B  1388    ;----- Vibrato / Tremolo sine wave ------------
                           B  1389    
011113 0018314A 61788DA1   B  1390    vibrato_table		db 000,024,049,074,097,120,
01111B B4C5D4E0 EBF4FAFD   B  1391    					db 180,197,212,224,235,244,
011123 FFFDFAF4 EBE0D4C5   B  1392    					db 255,253,250,244,235,224,
01112B B4A18D78 614A3118   B  1393    					db 180,161,141,120,097,074,
                           B  1394    
                           B  1395    ;----------------------------------------------
                           B  1396    
011133 000000              B  1397    sample_base				dw24 0			; "init
011136 00                  B  1398    relocated_samples		db 0			; if se
                           B  1399    
011137 00 00 00 00 00 00   B  1400    sample_location_list	blkb 31*3,0		; 24bit
01113D 00 00 00 00 00 00 
011143 00 00 00 00 00 00 
011149 00 00 00 00 00 00 
01114F 00 00 00 00 00 00 
011155 00 00 00 00 00 00 
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  38


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
01115B 00 00 00 00 00 00 
011161 00 00 00 00 00 00 
011167 00 00 00 00 00 00 
01116D 00 00 00 00 00 00 
011173 00 00 00 00 00 00 
011179 00 00 00 00 00 00 
01117F 00 00 00 00 00 00 
011185 00 00 00 00 00 00 
01118B 00 00 00 00 00 00 
011191 00 00 00 
                           B  1401    
                           B  1402    ;----------------------------------------------
                           B  1403    
011194 00                  B  1404    ticker				db 0
011195 00                  B  1405    songpos				db 0
011196 00                  B  1406    patindex			db 0
011197 00                  B  1407    songspeed			db 0
011198 00                  B  1408    arpeggio_counter	db 0
011199 00                  B  1409    pattloop_pos		db 0
01119A 00                  B  1410    pattloop_count		db 0
01119B 00                  B  1411    pattdelay_count		db 0
01119C 00                  B  1412    pattdelay_flag		db 0
01119D 00                  B  1413    filter_on_off		db 0
                           B  1414    
                           B  1415    ;----------------------------------------------
                           B  1416    
       00000026            B  1417    vars_per_channel		equ 38
                           B  1418    
01119E 00 00 00 00 00 00   B  1419    channel_data			blkb vars_per_channel*4
0111A4 00 00 00 00 00 00 
0111AA 00 00 00 00 00 00 
0111B0 00 00 00 00 00 00 
0111B6 00 00 00 00 00 00 
0111BC 00 00 00 00 00 00 
0111C2 00 00 00 00 00 00 
0111C8 00 00 00 00 00 00 
0111CE 00 00 00 00 00 00 
0111D4 00 00 00 00 00 00 
0111DA 00 00 00 00 00 00 
0111E0 00 00 00 00 00 00 
0111E6 00 00 00 00 00 00 
0111EC 00 00 00 00 00 00 
0111F2 00 00 00 00 00 00 
0111F8 00 00 00 00 00 00 
0111FE 00 00 00 00 00 00 
011204 00 00 00 00 00 00 
01120A 00 00 00 00 00 00 
011210 00 00 00 00 00 00 
011216 00 00 00 00 00 00 
01121C 00 00 00 00 00 00 
011222 00 00 00 00 00 00 
011228 00 00 00 00 00 00 
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  39


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_Player_v101.asm
01122E 00 00 00 00 00 00 
011234 00 00 
                           B  1420    	
       00000000            B  1421    instrument				equ 0
       00000001            B  1422    period_lo				equ 1
       00000002            B  1423    period_hi				equ 2
       00000003            B  1424    volume					equ 3
       00000004            B  1425    fx_number				equ 4
       00000005            B  1426    fx_args					equ 5
       00000006            B  1427    period_for_fx_lo		equ 6
       00000007            B  1428    period_for_fx_hi		equ 7
       00000008            B  1429    volume_for_fx			equ 8
       00000009            B  1430    portamento_rate			equ 9
       0000000A            B  1431    vibrato_args			equ 10
       0000000B            B  1432    vibrato_pos				equ 11
       0000000C            B  1433    tremolo_args			equ 12
       0000000D            B  1434    tremolo_pos				equ 13
       0000000E            B  1435    wave_type 				equ 14		;bits 7:4 =
       0000000F            B  1436    control_bits			equ 15		;bit 0 = no
       00000010            B  1437    portamento_dest_lo		equ 16		;bit 2 = ch
       00000011            B  1438    portamento_dest_hi		equ 17
       00000012            B  1439    instrument_waiting		equ 18
       00000013            B  1440    volume_waiting			equ 19
       00000014            B  1441    finetune				equ 20
       00000015            B  1442    arp_base_period_lo  	equ 21
       00000016            B  1443    arp_base_period_hi		equ 22
                           B  1444    
       00000017            B  1445    sample_location			equ 23		;23,24,25	       0000001A            B  1446    sample_length			equ 26		;26,27,28	       0000001D            B  1447    sample_loop_location	equ 29		;29,30,31	       00000020            B  1448    sample_loop_length		equ 32		;32,33,34	       00000023            B  1449    sample_offset			equ 35		;35,36,37	                           B  1450    
                           B  1451    
                           B  1452    ;==============================================
                           B  1453    ; End of non-hardware specific eZ80 Protracker 
                           B  1454    ;==============================================
                           B  1455    
                           A   146    	
                           B     0    			include "ADL_mode_Protracker_to_EZ8
                           B     1    ;----------------------------------------------
                           B     2    ; Convert Amiga hardware values from eZ80 Protr
                           B     3    ; and writes to hardware registers
                           B     4    ;----------------------------------------------
                           B     5    ;
                           B     6    ; V1.00 - ADL mode
                           B     7    ;
                           B     8    ; Writes 4 tracker channels to left channels, a
                           B     9    ;----------------------------------------------
                           B    10    
                           B    11    .assume ADL = 1
                           B    12    
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  40


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_to_EZ80P_audio.asm
       0001119F            B    13    firstchan_period	equ channel_data+period_lo
       000111A1            B    14    firstchan_volume	equ channel_data+volume
       000111B5            B    15    firstchan_location	equ channel_data+sample_loc
       000111B8            B    16    firstchan_length	equ channel_data+sample_len
       000111AD            B    17    firstchan_control	equ channel_data+control_bi
       000111BB            B    18    firstchan_loop_loc	equ channel_data+sample_loo
       000111BE            B    19    firstchan_loop_len	equ channel_data+sample_loo
                           B    20    
       000111C5            B    21    secondchan_period	equ channel_data+vars_per_c
       000111C7            B    22    secondchan_volume	equ channel_data+vars_per_c
       000111DB            B    23    secondchan_location	equ channel_data+vars_per_c
       000111DE            B    24    secondchan_length	equ channel_data+vars_per_c
       000111D3            B    25    secondchan_control	equ channel_data+vars_per_c
       000111E1            B    26    secondchan_loop_loc	equ channel_data+vars_per_c
       000111E4            B    27    secondchan_loop_len	equ channel_data+vars_per_c
                           B    28    
       000111EB            B    29    thirdchan_period	equ channel_data+(vars_per_
       000111ED            B    30    thirdchan_volume	equ channel_data+(vars_per_
       00011201            B    31    thirdchan_location	equ channel_data+(vars_per_
       00011204            B    32    thirdchan_length	equ channel_data+(vars_per_
       000111F9            B    33    thirdchan_control	equ channel_data+(vars_per_
       00011207            B    34    thirdchan_loop_loc	equ channel_data+(vars_per_
       0001120A            B    35    thirdchan_loop_len	equ channel_data+(vars_per_
                           B    36    
       00011211            B    37    fourthchan_period	equ channel_data+(vars_per_
       00011213            B    38    fourthchan_volume	equ channel_data+(vars_per_
       00011227            B    39    fourthchan_location	equ channel_data+(vars_per_
       0001122A            B    40    fourthchan_length	equ channel_data+(vars_per_
       0001121F            B    41    fourthchan_control	equ channel_data+(vars_per_
       0001122D            B    42    fourthchan_loop_loc	equ channel_data+(vars_per_
       00011230            B    43    fourthchan_loop_len	equ channel_data+(vars_per_
                           B    44    
                           B    45    ;----------------------------------------------
                           B    46    ; EZ80P specific code
                           B    47    ;----------------------------------------------
                           B    48    
011236                     B    49    update_audio_hardware
                           B    50    
011236 3E01                B    51    				ld a,1
011238 320300F8            B    52    				ld (hw_audio_registers+3),a		01123C 0E01                B    53    				ld c,port_hw_flags
01123E ED7440              B    54    wait_audreg		tstio 40h						011241 28 FB               B    55    				jr z,wait_audreg
                           B    56    				
011243 3EFF                B    57    				ld a,0ffh						011245 320000F0            B    58    				ld (hw_palette),a				                           B    59    				
                           B    60    ;----------------------------------------------
                           B    61    ; Write Period Constants - must be done in max 
                           B    62    ;----------------------------------------------
                           B    63    								
011249 DD218000 F8         B    64    				ld ix,hw_audio_registers+80h	Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  41


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_to_EZ80P_audio.asm
01124E FD210000 F8         B    65    				ld iy,hw_audio_registers+00h
011253 11 A6 12 01         B    66    				ld de,period_conv_table-200		                           B    67    
011257 ED4B 9F 11 01       B    68    				ld bc,(firstchan_period)
01125C 21000000            B    69    				ld hl,0
011260 69                  B    70    				ld l,c
011261 60                  B    71    				ld h,b
011262 29                  B    72    				add hl,hl
011263 19                  B    73    				add hl,de
011264 4E                  B    74    				ld c,(hl)
011265 23                  B    75    				inc hl
011266 46                  B    76    				ld b,(hl)
011267 DD0F08              B    77    				ld (ix+08h),bc					                           B    78    ;				ld (iy+08h),bc
                           B    79    				
01126A ED4B C5 11 01       B    80    				ld bc,(secondchan_period)
01126F 21000000            B    81    				ld hl,0
011273 69                  B    82    				ld l,c
011274 60                  B    83    				ld h,b	  	
011275 29                  B    84    				add hl,hl
011276 19                  B    85    				add hl,de
011277 4E                  B    86    				ld c,(hl)
011278 23                  B    87    				inc hl
011279 46                  B    88    				ld b,(hl)
01127A DD0F28              B    89    				ld (ix+28h),bc					                           B    90    ;				ld (iy+28h),bc					                           B    91    	
01127D ED4B EB 11 01       B    92    				ld bc,(thirdchan_period)
011282 21000000            B    93    				ld hl,0
011286 69                  B    94    				ld l,c
011287 60                  B    95    				ld h,b  	
011288 29                  B    96    				add hl,hl
011289 19                  B    97    				add hl,de
01128A 4E                  B    98    				ld c,(hl)
01128B 23                  B    99    				inc hl
01128C 46                  B   100    				ld b,(hl)
01128D DD0F48              B   101    				ld (ix+48h),bc					                           B   102    ;				ld (iy+48h),bc	
                           B   103    
011290 ED4B 11 12 01       B   104    				ld bc,(fourthchan_period)
011295 21000000            B   105    				ld hl,0
011299 69                  B   106    				ld l,c
01129A 60                  B   107    				ld h,b  	
01129B 29                  B   108    				add hl,hl
01129C 19                  B   109    				add hl,de
01129D 4E                  B   110    				ld c,(hl)
01129E 23                  B   111    				inc hl
01129F 46                  B   112    				ld b,(hl)
0112A0 DD0F68              B   113    				ld (ix+68h),bc					                           B   114    ;				ld (iy+68h),bc
                           B   115    				
                           B   116    ;----------------------------------------------
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  42


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_to_EZ80P_audio.asm
                           B   117    ; Write Volume
                           B   118    ;----------------------------------------------
                           B   119    
                           B   120    
0112A3 3A A1 11 01         B   121    				ld a,(firstchan_volume)			0112A7 5F                  B   122    				ld e,a
0112A8 11000000            B   123    	ld de,0
0112AC DD1F0C              B   124    				ld (ix+0ch),de					                           B   125    ;				ld (iy+0ch),de
                           B   126    				
0112AF 3A C7 11 01         B   127    				ld a,(secondchan_volume)
0112B3 5F                  B   128    				ld e,a
0112B4 11000000            B   129    	ld de,0
0112B8 DD1F2C              B   130    				ld (ix+2ch),de					                           B   131    ;				ld (iy+2ch),de
                           B   132    
0112BB 3A ED 11 01         B   133    				ld a,(thirdchan_volume)
0112BF 5F                  B   134    				ld e,a
0112C0 11000000            B   135    	ld de,0
0112C4 DD1F4C              B   136    				ld (ix+4ch),de					                           B   137    ;				ld (iy+4ch),de
                           B   138    				
0112C7 3A 13 12 01         B   139    				ld a,(fourthchan_volume)
0112CB 5F                  B   140    				ld e,a
                           B   141    ;	ld de,0
0112CC DD1F6C              B   142    				ld (ix+6ch),de					                           B   143    ;				ld (iy+6ch),de
                           B   144    				
                           B   145    ;----------------------------------------------
                           B   146    ; Write Loc and Len of triggered channels
                           B   147    ;----------------------------------------------
                           B   148    
0112CF 21 AD 11 01         B   149    				ld hl,firstchan_control			0112D3 CB46                B   150    				bit 0,(hl)						0112D5 28 1E               B   151    				jr z,no_rt_ch0					0112D7 CB86                B   152    				res 0,(hl)
0112D9 2A B5 11 01         B   153    				ld hl,(firstchan_location)
0112DD DD2F00              B   154    				ld (ix+00h),hl					                           B   155    ;				ld (iy+00h),hl
0112E0 2A BB 11 01         B   156    				ld hl,(firstchan_loop_loc)
0112E4 DD2F10              B   157    				ld (ix+10h),hl					                           B   158    ;				ld (iy+10h),hl	
0112E7 2A B8 11 01         B   159    				ld hl,(firstchan_length)
0112EB DD2F04              B   160    				ld (ix+04h),hl					                           B   161    ;				ld (iy+04h),hl
0112EE 2A BE 11 01         B   162    				ld hl,(firstchan_loop_len)
0112F2 DD2F14              B   163    				ld (ix+14h),hl					                           B   164    ;				ld (iy+14h),hl
                           B   165    
0112F5                     B   166    no_rt_ch0
0112F5 21 D3 11 01         B   167    				ld hl,secondchan_control
0112F9 CB46                B   168    				bit 0,(hl)
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  43


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_to_EZ80P_audio.asm
0112FB 28 1E               B   169    				jr z,no_rt_ch1
0112FD CB86                B   170    				res 0,(hl)
0112FF 2A DB 11 01         B   171    				ld hl,(secondchan_location)
011303 DD2F20              B   172    				ld (ix+20h),hl					                           B   173    ;				ld (iy+20h),hl
011306 2A E1 11 01         B   174    				ld hl,(secondchan_loop_loc)
01130A DD2F30              B   175    				ld (ix+30h),hl					                           B   176    ;				ld (iy+30h),hl
01130D 2A DE 11 01         B   177    				ld hl,(secondchan_length)
011311 DD2F24              B   178    				ld (ix+24h),hl					                           B   179    ;				ld (iy+24h),hl	
011314 2A E4 11 01         B   180    				ld hl,(secondchan_loop_len)		011318 DD2F34              B   181    				ld (ix+34h),hl					                           B   182    ;				ld (iy+34h),hl	
                           B   183    
01131B                     B   184    no_rt_ch1
                           B   185    								
01131B 21 F9 11 01         B   186    				ld hl,thirdchan_control
01131F CB46                B   187    				bit 0,(hl)
011321 28 1E               B   188    				jr z,no_rt_ch2
011323 CB86                B   189    				res 0,(hl)
011325 2A 01 12 01         B   190    				ld hl,(thirdchan_location)
011329 DD2F40              B   191    				ld (ix+40h),hl		
                           B   192    ;				ld (iy+40h),hl
01132C 2A 07 12 01         B   193    				ld hl,(thirdchan_loop_loc)
011330 DD2F50              B   194    				ld (ix+50h),hl		
                           B   195    ;				ld (iy+50h),hl					011333 2A 04 12 01         B   196    				ld hl,(thirdchan_length)
011337 DD2F44              B   197    				ld (ix+44h),hl	
                           B   198    ;				ld (iy+44h),hl	
01133A 2A 0A 12 01         B   199    				ld hl,(thirdchan_loop_len)
01133E DD2F54              B   200    				ld (ix+54h),hl		
                           B   201    ;				ld (iy+54h),hl	
                           B   202    
                           B   203    
011341 21 1F 12 01         B   204    no_rt_ch2		ld hl,fourthchan_control
011345 CB46                B   205    				bit 0,(hl)
011347 28 1E               B   206    				jr z,no_rt_ch3
011349 CB86                B   207    				res 0,(hl)
01134B 2A 27 12 01         B   208    				ld hl,(fourthchan_location)
01134F DD2F60              B   209    				ld (ix+60h),hl		
                           B   210    ;				ld (iy+60h),hl	
011352 2A 2D 12 01         B   211    				ld hl,(fourthchan_loop_loc)
011356 DD2F70              B   212    				ld (ix+70h),hl	
                           B   213    ;				ld (iy+70h),hl	
011359 2A 2A 12 01         B   214    				ld hl,(fourthchan_length)
01135D DD2F64              B   215    				ld (ix+64h),hl		
                           B   216    ;				ld (iy+64h),hl	
011360 2A 30 12 01         B   217    				ld hl,(fourthchan_loop_len)
011364 DD2F74              B   218    				ld (ix+74h),hl		
                           B   219    ;				ld (iy+74h),hl	
                           B   220    
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  44


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_to_EZ80P_audio.asm
011367 3E00                B   221    no_rt_ch3		ld a,0h							011369 320000F0            B   222    				ld (hw_palette),a				                           B   223    
01136D C9                  B   224    				ret
                           B   225    	
                           B   226    ;----------------------------------------------
                           B   227    ; Table for equivalent EZ80P constants to Amiga
                           B   228    ;----------------------------------------------
                           B   229    ;
                           B   230    ; Formula: (1/48828) / ((1/3579545) * period) *
                           B   231    ;
                           B   232    ; Starts at Amiga period 100, one 16-bit consta
                           B   233    
01136E                     B   234    period_conv_table:
                           B   235    
01136E ABBBD0B9 FDB734B6   B   236                    db 0ABh,0BBh,0D0h,0B9h,0FDh,0B7
011376 74B4BCB2 0CB164AF 
01137E C5AD2DAC 9CAA12A9   B   237                    db 0C5h,0ADh,02Dh,0ACh,09Ch,0AA
011386 90A714A6 9FA431A3 
01138E C9A167A0 0B9FB59D   B   238                    db 0C9h,0A1h,067h,0A0h,00Bh,09F
011396 649C199B D4999498 
01139E 59972396 F294C593   B   239                    db 059h,097h,023h,096h,0F2h,094
0113A6 9E927B91 5C90428F 
0113AE 2C8E1B8D 0D8C048B   B   240                    db 02Ch,08Eh,01Bh,08Dh,00Dh,08C
0113B6 FE89FC88 FE870487 
0113BE 0D861985 29843D83   B   241                    db 00Dh,086h,019h,085h,029h,084
0113C6 53826D81 8A80AA7F 
0113CE CE7EF47D 1D7D497C   B   242                    db 0CEh,07Eh,0F4h,07Dh,01Dh,07D
0113D6 777BA97A DD791479 
0113DE 4D788977 C7760876   B   243                    db 04Dh,078h,089h,077h,0C7h,076
0113E6 4B759074 D8732273 
0113EE 6F72BD71 0E716070   B   244                    db 06Fh,072h,0BDh,071h,00Eh,071
0113F6 B56F0C6F 656EBF6D 
0113FE 1C6D7B6C DB6B3D6B   B   245                    db 01Ch,06Dh,07Bh,06Ch,0DBh,06B
011406 A16A076A 6E69D868 
01140E 4368AF67 1D678D66   B   246                    db 043h,068h,0AFh,067h,01Dh,067
011416 FE657165 E6645B64 
01141E D3634C63 C6624162   B   247                    db 0D3h,063h,04Ch,063h,0C6h,062
011426 BE613D61 BC603D60 
01142E C05F435F C85E4E5E   B   248                    db 0C0h,05Fh,043h,05Fh,0C8h,05E
011436 D55D5E5D E85C725C 
01143E FE5B8C5B 1A5BA95A   B   249                    db 0FEh,05Bh,08Ch,05Bh,01Ah,05B
011446 3A5ACB59 5E59F158 
01144E 86581B58 B2574A57   B   250                    db 086h,058h,01Bh,058h,0B2h,057
011456 E2567C56 1656B155 
01145E 4E55EB54 89542854   B   251                    db 04Eh,055h,0EBh,054h,089h,054
011466 C8536853 0A53AC52 
01146E 4F52F351 98513E51   B   252                    db 04Fh,052h,0F3h,051h,098h,051
011476 E4508B50 3350DC4F 
01147E 854F2F4F DA4E864E   B   253                    db 085h,04Fh,02Fh,04Fh,0DAh,04E
011486 324EDF4D 8C4D3B4D 
01148E EA4C994C 4A4CFA4B   B   254                    db 0EAh,04Ch,099h,04Ch,04Ah,04C
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  45


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_to_EZ80P_audio.asm
011496 AC4B5E4B 114BC54A 
01149E 794A2D4A E2499849   B   255                    db 079h,04Ah,02Dh,04Ah,0E2h,049
0114A6 4F490649 BD487548 
0114AE 2E48E747 A1475B47   B   256                    db 02Eh,048h,0E7h,047h,0A1h,047
0114B6 1647D146 8D464946 
0114BE 0646C445 82454045   B   257                    db 006h,046h,0C4h,045h,082h,045
0114C6 FF44BE44 7E443E44 
0114CE FF43C043 82434443   B   258                    db 0FFh,043h,0C0h,043h,082h,043
0114D6 0643C942 8C425042 
0114DE 1442D941 9E416441   B   259                    db 014h,042h,0D9h,041h,09Eh,041
0114E6 2941F040 B6407D40 
0114EE 45400D40 D53F9E3F   B   260                    db 045h,040h,00Dh,040h,0D5h,03F
0114F6 673F303F FA3EC43E 
0114FE 8E3E593E 243EF03D   B   261                    db 08Eh,03Eh,059h,03Eh,024h,03E
011506 BB3D883D 543D213D 
01150E EE3CBC3C 8A3C583C   B   262                    db 0EEh,03Ch,0BCh,03Ch,08Ah,03C
011516 263CF53B C43B943B 
01151E 633B333B 043BD43A   B   263                    db 063h,03Bh,033h,03Bh,004h,03B
011526 A53A763A 483A1A3A 
01152E EC39BE39 91396439   B   264                    db 0ECh,039h,0BEh,039h,091h,039
011536 37390B39 DE38B238 
01153E 87385B38 30380538   B   265                    db 087h,038h,05Bh,038h,030h,038
011546 DA37B037 86375C37 
01154E 32370937 DF36B636   B   266                    db 032h,037h,009h,037h,0DFh,036
011556 8E366536 3D361536 
01155E ED35C635 9E357735   B   267                    db 0EDh,035h,0C6h,035h,09Eh,035
011566 50352A35 0335DD34 
01156E B7349134 6C344634   B   268                    db 0B7h,034h,091h,034h,06Ch,034
011576 2134FC33 D733B333 
01157E 8E336A33 46332233   B   269                    db 08Eh,033h,06Ah,033h,046h,033
011586 FF32DC32 B8329532 
01158E 73325032 2D320B32   B   270                    db 073h,032h,050h,032h,02Dh,032
011596 E931C731 A6318431 
01159E 63314131 20310031   B   271                    db 063h,031h,041h,031h,020h,031
0115A6 DF30BE30 9E307E30 
0115AE 5E303E30 1E30FF2F   B   272                    db 05Eh,030h,03Eh,030h,01Eh,030
0115B6 E02FC02F A12F832F 
0115BE 642F452F 272F092F   B   273                    db 064h,02Fh,045h,02Fh,027h,02F
0115C6 EA2ECD2E AF2E912E 
0115CE 742E562E 392E1C2E   B   274                    db 074h,02Eh,056h,02Eh,039h,02E
0115D6 FF2DE22D C62DA92D 
0115DE 8D2D702D 542D382D   B   275                    db 08Dh,02Dh,070h,02Dh,054h,02D
0115E6 1D2D012D E52CCA2C 
0115EE AF2C932C 782C5D2C   B   276                    db 0AFh,02Ch,093h,02Ch,078h,02C
0115F6 432C282C 0D2CF32B 
0115FE D92BBF2B A52B8B2B   B   277                    db 0D9h,02Bh,0BFh,02Bh,0A5h,02B
011606 712B572B 3E2B242B 
01160E 0B2BF22A D82ABF2A   B   278                    db 00Bh,02Bh,0F2h,02Ah,0D8h,02A
011616 A72A8E2A 752A5D2A 
01161E 442A2C2A 142AFC29   B   279                    db 044h,02Ah,02Ch,02Ah,014h,02A
011626 E429CC29 B4299C29 
01162E 85296D29 56293F29   B   280                    db 085h,029h,06Dh,029h,056h,029
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  46


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_to_EZ80P_audio.asm
011636 27291029 F928E328 
01163E CC28B528 9F288828   B   281                    db 0CCh,028h,0B5h,028h,09Fh,028
011646 72285C28 45282F28 
01164E 19280328 EE27D827   B   282                    db 019h,028h,003h,028h,0EEh,027
011656 C227AD27 97278227 
01165E 6D275827 43272E27   B   283                    db 06Dh,027h,058h,027h,043h,027
011666 19270427 EF26DA26 
01166E C626B126 9D268926   B   284                    db 0C6h,026h,0B1h,026h,09Dh,026
011676 75266026 4C263826 
01167E 25261126 FD25E925   B   285                    db 025h,026h,011h,026h,0FDh,025
011686 D625C225 AF259C25 
01168E 88257525 62254F25   B   286                    db 088h,025h,075h,025h,062h,025
011696 3C252925 16250425 
01169E F124DE24 CC24B924   B   287                    db 0F1h,024h,0DEh,024h,0CCh,024
0116A6 A7249524 83247024 
0116AE 5E244C24 3A242924   B   288                    db 05Eh,024h,04Ch,024h,03Ah,024
0116B6 17240524 F323E223 
0116BE D023BF23 AD239C23   B   289                    db 0D0h,023h,0BFh,023h,0ADh,023
0116C6 8B237A23 68235723 
0116CE 46233523 24231423   B   290                    db 046h,023h,035h,023h,024h,023
0116D6 0323F222 E222D122 
0116DE C122B022 A0228F22   B   291                    db 0C1h,022h,0B0h,022h,0A0h,022
0116E6 7F226F22 5F224F22 
0116EE 3F222F22 1F220F22   B   292                    db 03Fh,022h,02Fh,022h,01Fh,022
0116F6 FF21EF21 E021D021 
0116FE C121B121 A2219221   B   293                    db 0C1h,021h,0B1h,021h,0A2h,021
011706 83217321 64215521 
01170E 46213721 28211921   B   294                    db 046h,021h,037h,021h,028h,021
011716 0A21FB20 EC20DE20 
01171E CF20C020 B220A320   B   295                    db 0CFh,020h,0C0h,020h,0B2h,020
011726 94208620 78206920 
01172E 5B204D20 3E203020   B   296                    db 05Bh,020h,04Dh,020h,03Eh,020
011736 22201420 0620F81F 
01173E EA1FDC1F CF1FC11F   B   297                    db 0EAh,01Fh,0DCh,01Fh,0CFh,01F
011746 B31FA51F 981F8A1F 
01174E 7D1F6F1F 621F541F   B   298                    db 07Dh,01Fh,06Fh,01Fh,062h,01F
011756 471F3A1F 2C1F1F1F 
01175E 121F051F F81EEA1E   B   299                    db 012h,01Fh,005h,01Fh,0F8h,01E
011766 DD1ED01E C41EB71E 
01176E AA1E9D1E 901E841E   B   300                    db 0AAh,01Eh,09Dh,01Eh,090h,01E
011776 771E6A1E 5E1E511E 
01177E 451E381E 2C1E1F1E   B   301                    db 045h,01Eh,038h,01Eh,02Ch,01E
011786 131E071E FA1DEE1D 
01178E E21DD61D CA1DBD1D   B   302                    db 0E2h,01Dh,0D6h,01Dh,0CAh,01D
011796 B11DA51D 991D8D1D 
01179E 821D761D 6A1D5E1D   B   303                    db 082h,01Dh,076h,01Dh,06Ah,01D
0117A6 521D471D 3B1D2F1D 
0117AE 241D181D 0D1D011D   B   304                    db 024h,01Dh,018h,01Dh,00Dh,01D
0117B6 F61CEA1C DF1CD41C 
0117BE C81CBD1C B21CA61C   B   305                    db 0C8h,01Ch,0BDh,01Ch,0B2h,01C
0117C6 9B1C901C 851C7A1C 
0117CE 6F1C641C 591C4E1C   B   306                    db 06Fh,01Ch,064h,01Ch,059h,01C
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  47


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_to_EZ80P_audio.asm
0117D6 431C381C 2D1C221C 
0117DE 181C0D1C 021CF81B   B   307                    db 018h,01Ch,00Dh,01Ch,002h,01C
0117E6 ED1BE21B D81BCD1B 
0117EE C31BB81B AE1BA31B   B   308                    db 0C3h,01Bh,0B8h,01Bh,0AEh,01B
0117F6 991B8E1B 841B7A1B 
0117FE 6F1B651B 5B1B511B   B   309                    db 06Fh,01Bh,065h,01Bh,05Bh,01B
011806 471B3C1B 321B281B 
01180E 1E1B141B 0A1B001B   B   310                    db 01Eh,01Bh,014h,01Bh,00Ah,01B
011816 F61AEC1A E31AD91A 
01181E CF1AC51A BB1AB21A   B   311                    db 0CFh,01Ah,0C5h,01Ah,0BBh,01A
011826 A81A9E1A 951A8B1A 
01182E 811A781A 6E1A651A   B   312                    db 081h,01Ah,078h,01Ah,06Eh,01A
011836 5B1A521A 481A3F1A 
01183E 361A2C1A 231A1A1A   B   313                    db 036h,01Ah,02Ch,01Ah,023h,01A
011846 101A071A FE19F519 
01184E EB19E219 D919D019   B   314                    db 0EBh,019h,0E2h,019h,0D9h,019
011856 C719BE19 B519AC19 
01185E A3199A19 91198819   B   315                    db 0A3h,019h,09Ah,019h,091h,019
011866 7F197619 6E196519 
01186E 5C195319 4A194219   B   316                    db 05Ch,019h,053h,019h,04Ah,019
011876 39193019 28191F19 
01187E 16190E19 0519FD18   B   317                    db 016h,019h,00Eh,019h,005h,019
011886 F418EC18 E318DB18 
01188E D318CA18 C218B918   B   318                    db 0D3h,018h,0CAh,018h,0C2h,018
011896 B118A918 A0189818 
01189E 90188818 80187718   B   319                    db 090h,018h,088h,018h,080h,018
0118A6 6F186718 5F185718 
0118AE 4F184718 3F183718   B   320                    db 04Fh,018h,047h,018h,03Fh,018
0118B6 2F182718 1F181718 
0118BE 0F180718 FF17F717   B   321                    db 00Fh,018h,007h,018h,0FFh,017
0118C6 F017E817 E017D817 
0118CE D017C917 C117B917   B   322                    db 0D0h,017h,0C9h,017h,0C1h,017
0118D6 B217AA17 A2179B17 
0118DE 93178C17 84177D17   B   323                    db 093h,017h,08Ch,017h,084h,017
0118E6 75176D17 66175F17 
0118EE 57175017 48174117   B   324                    db 057h,017h,050h,017h,048h,017
0118F6 3A173217 2B172417 
0118FE 1C171517 0E170617   B   325                    db 01Ch,017h,015h,017h,00Eh,017
011906 FF16F816 F116EA16 
01190E E316DB16 D416CD16   B   326                    db 0E3h,016h,0DBh,016h,0D4h,016
011916 C616BF16 B816B116 
01191E AA16A316 9C169516   B   327                    db 0AAh,016h,0A3h,016h,09Ch,016
011926 8E168716 80167916 
01192E 72166C16 65165E16   B   328                    db 072h,016h,06Ch,016h,065h,016
011936 57165016 49164316 
01193E 3C163516 2E162816   B   329                    db 03Ch,016h,035h,016h,02Eh,016
011946 21161A16 14160D16 
01194E 06160016 F915F315   B   330                    db 006h,016h,000h,016h,0F9h,015
011956 EC15E615 DF15D915 
01195E D215CC15 C515BF15   B   331                    db 0D2h,015h,0CCh,015h,0C5h,015
011966 B815B215 AB15A515 
01196E 9F159815 92158B15   B   332                    db 09Fh,015h,098h,015h,092h,015
Zilog eZ80 Macro Assembler Version 4.1 (10060805)25-Feb-11     17:04:39     page:  48


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\PLAY_T~2\src\ADL_mode_Protracker_to_EZ80P_audio.asm
011976 85157F15 79157215 
01197E 6C156615 5F155915   B   333                    db 06Ch,015h,066h,015h,05Fh,015
011986 53154D15 47154015 
01198E 3A153415 2E152815   B   334                    db 03Ah,015h,034h,015h,02Eh,015
011996 22151C15 16151015 
01199E 0A150415 FE14F814   B   335                    db 00Ah,015h,004h,015h,0FEh,014
0119A6 F214EC14 E614E014 
0119AE DA14D414 CE14C814   B   336                    db 0DAh,014h,0D4h,014h,0CEh,014
0119B6 C214BC14 B614B114 
0119BE AB14A514 9F149914   B   337                    db 0ABh,014h,0A5h,014h,09Fh,014
0119C6 93148E14 88148214 
0119CE 7C147714 71146B14   B   338                    db 07Ch,014h,077h,014h,071h,014
0119D6 66146014 5A145514 
0119DE 4F144914 44143E14   B   339                    db 04Fh,014h,049h,014h,044h,014
0119E6 39143314 2E142814 
0119EE 22141D14 17141214   B   340                    db 022h,014h,01Dh,014h,017h,014
0119F6 0C140714 0114FC13 
0119FE F713F113 EC13E613   B   341                    db 0F7h,013h,0F1h,013h,0ECh,013
011A06 E113DC13 D613D113 
011A0E CB13C613 C113       B   342                    db 0CBh,013h,0C6h,013h,0C1h,013
                           B   343    				
                           B   344    				
                           B   345    ;----------------------------------------------
                           B   346    ; EZ80P specific code ends
                           B   347    ;----------------------------------------------
                           B   348    
                           A   148    
                           A   149    ;----------------------------------------------
                           A   150    
                           A   151    ALIGN 2
                           A   152    
011A14 00                  A   153    music_module	db 0
                           A   154    
                           A   155    ;----------------------------------------------
                           A   156    
                           A   157    		


Errors: 0
Warnings: 0
Lines Assembled: 2181
