; test sprites

;----------------------------------------------------------------------------------------------

ADL_mode		equ 1				; 0 if user program is Z80 mode type, 1 if not
load_location	equ 10000h			; anywhere in system ram

				include	'PROSE_header.asm'

;---------------------------------------------------------------------------------------------
; ADL-mode user program follows..
;---------------------------------------------------------------------------------------------

			ld hl,message_txt				; ADL mode program
			ld a,kr_print_string			; desired kernal routine
			call.lil prose_kernal			; call PROSE routine		
			
			call test_code

			xor a
			jp.lil prose_return				; back to OS

;-------------------------------------------------------------------------------------------
; Test code
;-----------------------------------------------------------------------------------------------

sprite_registers	equ 0f40000h

test_code
			ld a,1
			out0 (port_video_mode),a		; disable sprites

			ld de,0c00000h
			ld hl,spr_image1
			ld bc,256*4
			ldir

			ld a,3
			out0 (port_video_mode),a		; enable sprites

waitvrt1	in0 a,(port_hw_flags)
			bit 5,a
			jr z,waitvrt1
waitvrt2	in0 a,(port_hw_flags)
			bit 5,a
			jr nz,waitvrt2
			
			ld ix,sprite_registers
			ld hl,(xcoord)
			inc hl
			ld (xcoord),hl
			ld (ix),l
			ld (ix+1),h
			ld hl,(ycoord)
			inc hl
			ld (ycoord),hl
			ld (ix+2),l
			ld (ix+3),h
			ld hl,(height_ctrl)
			ld (ix+4),l
			ld (ix+5),h
			ld hl,(definition)
			ld (ix+6),l
			ld (ix+7),h
			
			ld a,kr_get_key
			call.lil prose_kernal
			cp 76h
			jr nz,waitvrt1
			ret
			
		
xcoord		dw24 0
ycoord		dw24 0
definition	dw24 0
height_ctrl	dw24 64



;-----------------------------------------------------------------------------------------------
	
message_txt

		db 'Sprite Test..',11,0

spr_image1

		blkb 16,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		db 1,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1
		blkb 16,1

		blkb 16,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		db 2,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,2
		blkb 16,2
		
		blkb 16,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		db 3,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,3
		blkb 16,3
		
		blkb 16,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		db 4,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,4
		blkb 16,4
;-----------------------------------------------------------------------------------------------
		
		