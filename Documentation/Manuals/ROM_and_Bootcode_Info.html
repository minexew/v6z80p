<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>ROM and Bootcode Info</title></head><body><pre style="text-decoration: underline;">ROM:</pre><pre><br>OSCA contains a boot ROM as part of its FPGA config file (it is implemented<br>as a 512 byte blockRAM). This is normally mapped into $0000-$01FF of Z80 address<br>space (but can be paged out with bit 6 of the port sys_alt_write_page).<br>The ROM code's job is to load the main boot code from the onboard EEPROM:</pre><pre>The ROM looks for the bootcode at two locations:</pre><pre>EEPROM Block 0: $F000 [Primary bootcode location]<br>EEPROM Block 1: $F000 [Backup bootcode location]</pre><pre>To test for bootcode, a "databurst" command is sent to the PIC microcontroller<br>which responds by sending 3520 bytes from the EEPROM. The ROM reads this data<br>into system RAM $0200 onwards, checks the CRC checksum (held in the last two<br>bytes) and executes it (with a JP $200) if the checksum is good.</pre><pre>&nbsp;(If the CRC doesn't match, the screen flashes magenta and the databurst is requested<br>&nbsp;again from the backup. If this also fails, the screen goes grey indicating that a<br>&nbsp;bootcode file should be downloaded via the serial link at 115KBPS. This grey screen<br>&nbsp;condition can also be forced by holding up, right and fire on a joystick in port 2 <br>&nbsp;at power up. If at any point the screen flashes yellow, there was a time-out during<br>&nbsp;the EEPROM databurst.)</pre><pre><br></pre><pre style="text-decoration: underline;">BOOTCODE:</pre><pre>When the bootcode starts, the keyboard is reset, a welcome message appears (black<br>and white text) and the system looks for an operating system.</pre><pre>The operating system is taken to be the first .OSF file in the root directory<br>of the SD card. If no .OSF file is found, the bootcode looks at EEPROM address</pre><pre>Block 0: $0800</pre><pre>An operating system file is identified from its header which contains the following data:</pre><pre>$00 - $07 : ASCII Characters: Z80P*OS*<br>$08 - $0B : Length of file (excluding header)<br>$0C - $0D : CRC checksum of file<br>$0E - $0F : Not currently used (set to $0000)</pre><pre>Whenever an OS file is found, it is loaded to $1000, the checksum is tested and<br>if OK, executes from $1010 (IE: a jump past the header data).</pre><pre>On the bootcode screen:</pre><pre>&nbsp; ESC key: Normal OS load is aborted and a prompt for serial download of<br>&nbsp; the OS code is displayed. (Left CTRL will reset the system at this point.)</pre><pre>&nbsp; F1-F7: The FPGA will reconfigure from slot 1-7.</pre><pre>&nbsp; F11: Set BAUD rate to 57600</pre><pre>&nbsp; F12: Set BAUD rate to 115200 <br><br></pre><br></body></html>