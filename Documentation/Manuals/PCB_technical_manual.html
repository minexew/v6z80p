<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>V6Z80P PCB technical manual</title></head><body><h2>V6Z80P PCB Technical Manual</h2><pre>Last updated 22-08-2012</pre><pre><br><span style="text-decoration: underline; font-weight: bold;">Brief circuit description:</span></pre><pre>The V6Z80P is based around a Xilinx Spartan 2 XS2S150 FPGA, Zilog 20MHz Z80 and 3 SRAM memory ICs.<br>Also onboard are two PIC chips (one handles FPGA configuration, whilst the other&nbsp; is used as a<br>parallel-to-serial converter for the joystick inputs),&nbsp; an SPI EEPROM (which holds FPGA config<br>patterns and other data), an ST232 voltage convertor for serial comms and a 74HCT08 quad AND gate<br>(for CPU clock and reset, see descriptions below).</pre><pre><br><span style="text-decoration: underline; font-weight: bold;">Memory ICs:</span></pre><pre>1. 512KB SRAM 10ns, 3.3v - direct connection to FPGA&nbsp; /CS permanently active (pulled low).</pre><pre>2. 128KB SRAM 10ns, 3.3v&nbsp; direct connection to FPGA,&nbsp; /CS permanently active (pulled low).</pre><pre>3. 512KB SRAM 25ns, 5v. Some connections direct&nbsp; to CPU and FPGA, some are routed through<br> &nbsp; the FPGA&nbsp; (see description below). This chip is referred to as "System RAM".</pre><pre><br><span style="text-decoration: underline; font-weight: bold;">CPU:</span></pre><pre>All Z80 control pins (except CLOCK, /RFSH and /HALT) are connected to FPGA pins. /RD, /WR and D0:D7<br>and A0:A14 are also connected direct to System RAM. To allow 32KB memory paging, A15 is routed<br>through the FPGA, (On the V6Z80P+,&nbsp; A14 is also routed through the FPGA allowing 16KB paging)<br>System RAM lines A18:A16 are driven direct from the FPGA.<br><br>The Z80 / RESET signal is also connected to the output of an 74HCT08 AND gate: AND input A is<br>connected to the FPGA's DONE signal, and input B is connected to an FPGA output pin. This&nbsp;means<br>the Z80 is held in reset state until the FPGA has started, and can also be reset by the FPGA.<br>(FPGA configurations should pull this reset line low for a short period upon start up to<br>guarantee CPU reset time with the clock running) <br><br>The Z80's clock signal is driven by the output of a 74HCT08 gate, the inputs of this gate are<br>connected&nbsp; differently depending on the version of the board:</pre><pre><br><span style="font-weight: bold;">Original V6Z80P (v1.1)</span></pre><pre>&nbsp;&nbsp; &nbsp;AND gate input A is connected to the 16MHz oscillator, input B is pulled high.</pre><pre><br><span style="font-weight: bold;">V6Z80P+ V1.0</span></pre><pre>&nbsp;&nbsp; &nbsp;AND gate input A is connected to the 16MHz oscillator, input B is connected to an FPGA pin (p75).<br>&nbsp;&nbsp; &nbsp;Normally, the FPGA pin should be pulled high.</pre><pre><br><span style="font-weight: bold;">V6Z80P+ V1.1</span><br><br>&nbsp;&nbsp; &nbsp;AND gate input A can either be connected to the 16MHz oscillator or pulled high - an onboard switch<br>&nbsp;&nbsp; &nbsp;called "OSC SEL" selects the operating mode:</pre><pre>&nbsp;&nbsp; &nbsp;When the switch is down, input A is pulled high, and the CPU clock signal should be supplied<br>&nbsp;&nbsp; &nbsp;to Input B from the FPGA (pin 75). </pre><pre>&nbsp;&nbsp; &nbsp;When the switch is up, input A is connected to the 16MHz clock, so input B (p75)<br>&nbsp;&nbsp; &nbsp;should normally be pulled high.</pre><pre>&nbsp;&nbsp;&nbsp; &nbsp;(The OSC SEL only needs to be up position if using FPGA configs designed for the V6Z80P+ V1.0)</pre><pre style="font-weight: bold;"><br>V6Z80P+ v1.1b</pre><pre>&nbsp;&nbsp; &nbsp;There is no OSC SEL switch, the board is wired as if the switch were fixed in the down position,<br>    IE:&nbsp;the CPU clock always comes from the FPGA.</pre><br><pre style="text-decoration: underline; font-weight: bold;">Header Pins:</pre><pre>The 2x5 pin header has 6 pins connected directly to general purpose FPGA IOs (5 on the V6Z80P+)<br>they have no fixed purpose (in OSCA they are used for NMI, RESET and VGA select, with the others<br>configured as Z80 I/O ports). The layout of the pins depends on the model of V6Z80P:</pre><pre><br><span style="font-weight: bold;">Original V6Z80P (v1.1)</span><br><br>                <span style="font-weight: bold;">G 0</span>&nbsp; --&gt; FPGA pin 148<br>                <span style="font-weight: bold;">G 1</span>&nbsp; --&gt; FPGA pin 149<br>                <span style="font-weight: bold;">G 2</span>&nbsp; --&gt; FPGA pin 150<br>                <span style="font-weight: bold;">G 3</span>&nbsp; --&gt; FPGA pin 151<br>FPGA pin 160--&gt; <span style="font-weight: bold;">4 5</span> - -&gt; FPGA pin 152</pre><pre><br><span style="font-weight: bold;">V6Z80P+ V1.0 and V1.1</span></pre><pre>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="font-weight: bold;">N  G  G  G  G</span><br>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;<span style="font-weight: bold;">0&nbsp; 1&nbsp; 2&nbsp; 3&nbsp; 4</span> -----&gt;FPGA pin 148<br>        |&nbsp;&nbsp;|&nbsp; |&nbsp; '------&gt;FPGA pin 149<br>        |&nbsp;&nbsp;|&nbsp; '----------&gt;FPGA pin 150<br>        |&nbsp;&nbsp;'--------------&gt;FPGA pin 151<br>        '------------------&gt;FPGA pin 152</pre><pre><br>The V6Z80P+ boards also have a 3x1 pin header connected to the FPGA's unused GCLK inputs</pre><pre>&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; <span style="font-weight: bold;">&nbsp;G&nbsp; 5  6 </span>--&gt; FPGA pin 185<br>           '------&gt; FPGA pin 182</pre><pre>G = Ground, N = No connection</pre><pre><br><br><span style="text-decoration: underline; font-weight: bold;">Video Port:</span></pre><pre>12 FPGA outputs drive three&nbsp;4-resistor DACs for Red, Green and Blue analog outputs (which&nbsp;allows<br>a palette of 4096 colours). The RGB levels (once connected to standard 75Ohm loads) are &lt; 0.7v<br>suitable for TV for VGA monitors.&nbsp; 2 additional FPGA outputs drive Horizontal sync and Vertical<br>sync outputs. The connections vary, depending on the model of V6Z80P.</pre><pre><br><span style="font-weight: bold;">Original V6Z80P (v1.1)</span></pre><pre>&nbsp;&nbsp; &nbsp;An 8 pin mini-DIN socket is used for video out, so custom cables are required for both VGA and TV<br>&nbsp;&nbsp; &nbsp;displays. The outputs are:</pre><pre>&nbsp;&nbsp; &nbsp;"Select" (5volts, via 100Ohms),&nbsp; Ground,&nbsp; Red,&nbsp; Green,&nbsp; Blue, V-sync (TTL), H-Sync (TTL),</pre><pre>&nbsp; &nbsp; "Composite Sync" (V-Sync via 750 Ohms).</pre><pre><br><span style="font-weight: bold;">V6Z80P plus V1.0 and V1.1</span></pre><pre>&nbsp;&nbsp; &nbsp;A standard 15 pin VGA connector is used so a custom cable is only required for TV displays. The<br>&nbsp;&nbsp; &nbsp;outputs are:</pre><pre>&nbsp;&nbsp; &nbsp;Ground, Red, Green, Blue, TTL V-Sync (via 100 Ohms), TTL H-sync (via 100 Ohms).</pre><pre>&nbsp;&nbsp; &nbsp;The custom SCART TV cable connects TTL V-Sync to Composite sync via 660Ohms, this then presents the<br>    correct analogue voltage level. TTL H-sync is connected to the SCART "Select" line to&nbsp;active RGB<br>    mode - note that that the FPGA must be aware that TV mode is being used, so it can pull-up the<br>    H-Sync line continually.</pre><pre><br><span style="text-decoration: underline; font-weight: bold;">Audio:</span><br>&nbsp;<br>Two outputs from the FPGA (Sigma/Delta pulse trains) drive a simple resistor/capacitor filter.<br>The output of which has its amplitude halved by a potential divider (2 x 10K), passed via 1uf<br>capacitor to the left and right of the 3.5mm audio socket. </pre><pre><br></pre><pre style="font-weight: bold;"><span style="text-decoration: underline;">Serial Port:</span> </pre><pre>A 4-pin mini DIN (3-pin on the V6Z80P+ V1.0) is used for the V6Z80P com port (to avoid confusion<br>with the joystick ports) RX, TX and Ground are connected. The lines are routed via a ST232 level<br>converter chip to and from the FPGA.</pre><pre><br></pre><pre style="text-decoration: underline; font-weight: bold;">PS/2 ports:</pre><pre>Keyboard and mouse. CLOCK and DATA are directly connected to FPGA (and pulled up to 5v via 10K<br>resistors). These lines can be pulled down (for output) by transistors connected to the FPGA..</pre><pre><br></pre><pre style="font-weight: bold;"><span style="text-decoration: underline;">Joysticks:</span> </pre><pre>There are two Atari 2600 / Amiga style connectors: 6 inputs each. All lines are pulled up by<br>resistors and pulled down by the switches in the joystick. The 12 lines are connected to a PIC<br>16F62xA microcontroller acting as a parallel-to-serial converter. Two FPGA pins for Clock and<br>Data are used to read the joystick data from the PIC. On the V6Z80P+, pin 5 of the joystick<br>ports is pulled to 3.3v via 22 Ohm resistors - this should allow Megadrive/Genesis pads to work also.</pre><pre><br></pre><pre style="text-decoration: underline; font-weight: bold;">MMC / SD memory card: </pre><pre>Uses 5 FPGA pins to connect to Power, /Card Select, Data_in, Data_out and Clock. /Card select is<br>also connected to an LED via resistor for access indication. The FPGA /Power line switches a PNP<br>transistor to apply power to the card.</pre><pre><br></pre><pre style="text-decoration: underline; font-weight: bold;">Other pins connected to the FPGA:</pre><pre>The PIC-based configuration system uses several FPGA pins to upload config data and communicate<br>with the PIC after config (includes reprogramming the EEPROM etc)</pre><pre>JTAG port: Used for "live" configuration of the FPGA, standard Xilinx pin out sequence.</pre><pre>Config selection jumpers: (J1 and J2, where marked) These select between JTAG config mode and<br>normal EEPROM configuration (slave serial mode). For JTAG configuration both jumpers should<br>be installed.</pre><pre>Full pin outs and more details of the PCB can be found in the "Specifics" folders.</pre><br></body></html>