<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>User Manual</title></head>
<body><h2>V6Z80P Basic User Manual 06-03-2013<br></h2><pre>(Online documentation &amp; link to main project archive: <a href="http://wiki.retroleum.co.uk">http://wiki.retroleum.co.uk)</a></pre><pre><br>=========================================================================================<br><br></pre><pre>As supplied, the V6Z80P system&nbsp;comprises&nbsp;three basic elements:</pre><pre>1. The PCB itself, this is the actual "V6Z80P".</pre><pre>2. A default architectural design for the FPGA called OSCA (Old School<br>   Computer Architecture) which is stored on an EEPROM. (There are currrently<br>   three additional FPGA architectures supplied on the EEPROM providing Spectrum 48,<br>   Spectrum 128 and Pentagon 128 cycle-pefect emulation. These were made by<br>   Alessandro Dorigatti.)</pre><pre>3. A simple command line operating system for OSCA called FLOS (Freezer-Like<br>   Operating System) also stored on the EERPOM but will load from SD card in<br>   preference if inserted.</pre><pre><br>The&nbsp;cables supplied for SCART TV connection, RS232 (serial) comms and Spectrum<br>EAR interface (where requested) are custom designed for the V6Z80P - the wiring<br>diagrams can be found elsewhere in the documentation folders.</pre><pre><br></pre><pre><span style="text-decoration: underline;">The V6Z80P PCB - A Brief Description:</span></pre><pre>The board is a 2-layer PCB, comprising mainly of a 20MHz CMOS Z80 CPU, Spartan2<br>XC2S150 FPGA and 3 SRAM chips (two 512KB and one 128KB) . There are two oscillators<br>present, 16MHz used for OSCA and 14MHz used for the Spectrum emulators. The video<br>DAC&nbsp;offers 12bit colour output via&nbsp;a standard VGA socket (the custom SCART cable<br>allows TV connection using RGB mode.) Stereo sound is output via a standard 3.5mm<br>Line Out jack socket. There are connectors for PC standard PS/2 keyboard and mouse,<br>Atari 2600-standard joysticks, RS232 serial and SD card IO. </pre><pre>The V6Z80P should be powered from a regulated 7.5 to 9.0 Volt DC mains adapter<br>with a 2.1mm jack (centre positive) capable of supplying about 800 mA (or more).</pre><pre>For full details, see the <a href="PCB_technical_manual.html">V6Z80P PCB manual</a><br><br><br></pre><pre><span style="text-decoration: underline;">An Outline of the&nbsp;OSCA Architecture:</span></pre><pre>OSCA's video system offers bitplane, byte map and tilemap style displays with data<br>sourced from a dedicated 512KB SRAM. Each mode allows hardware scrolling and a<br>256 colour palette. Other features include linedraw hardware, blitter data copier<br>and a scanline-synced co-processor for split screen effects. Up to 55 hardware sprites<br>per scanline can be displayed (each is 16 pixels wide, up to 240 lines high with<br>256 colours). A 128KB RAM chip is dedicated to sprite definitions.</pre><pre>There are four&nbsp;audio&nbsp;channels each capable of playing 8-bit signed sample data<br>via DMA (in a similar fashion to the Amiga).</pre><pre>OSCA also contains interface hardware for a PS/2 keyboard and mouse, SD card and<br>joysticks as well as memory paging registers etc accessed through Z80 ports.</pre><pre>For full details of OSCA, see the <a href="OSCA_Hardware_Manual.html">OSCA Hardware Manual</a><br><br><br></pre><pre><span style="text-decoration: underline;">Brief description of the "FLOS" Operating System</span></pre><pre>FLOS is a simple command line operating system / memory monitor similar to those<br>used by freezer cartridges for the 1980s home computers. In some ways it behaves<br>like a more modern DOS in that disk-based programs can be executed simply by entering<br>their filenames. The usual commands are present (show memory as hex, disassemble,<br>load and save bytes to RAM etc).</pre><pre>FLOS uses the FAT16 file system and loads from a file on the root of the SD card<br>(or from the onboard EEPROM). Naturally, it can be replaced with any arbitrary code<br>that is required to load at boot up.<br><br>For detailed info see the <a href="FLOS_Manual.html">FLOS manual</a>.</pre><pre><br></pre><pre><br><span style="text-decoration: underline; font-weight: bold;">Powering Up:</span></pre><pre>Download the full project archive (to PC) then format an SD card to FAT16 (please<br>use a good brand to ensure compatibility). Copy the contents of the folder "V6_SD_Card"<br>from the project archive to the card and insert into the V6Z80P's card slot. </pre><pre>Connect&nbsp;the power jack to the DC socket, a PS/2 keyboard and video/audio cables. If using a<br>VGA monitor, make sure the VGA-mode jumper (on the right side of 10 pin header) is installed.</pre><pre><br><img style="width: 239px; height: 89px;" alt="VGA mode jumper" src="images/vga_mode_jp.png"></pre><pre><br>The JTAG mode jumpers (J1 and J2) should be uninstalled for normal&nbsp;start-up. You can<br>now flick the power switch near the DC jack across to the right and the V6Z80P should<br>power up. The status LED lights up, a black and white bootloader screen appears, after<br>which FLOS loads. Once loaded, you can type "?" &lt;return&gt; for a list of internal commands<br>(for details use the command "HELP (command_name)" or see the <a href="FLOS_Manual.html">FLOS manual</a>.</pre><pre>Z80 programs with .flx or .exe filename extensions can be run from the SD card (use the<br>command line to navigate in a similar manner to DOS).&nbsp; Most of the demos etc can<br>be quit by pressing the ESC key (note: some programs were coded specifically<br>for the PAL TV system so may not work properly on VGA or in 60Hz NTSC display modes).</pre><pre>The system can also run without an SD card as FLOS is installed by default on<br>the EEPROM. However, this limits its use since everything but the internal commands<br>must be loaded into memory via Serial Link.</pre><pre>To send and receive data to FLOS, use the "Serial_link"&nbsp;utility provided on the PC<br>(see the "PC_based_apps" folder in project archive) and use the custom DSUB9 to<br>4 pin mini-DIN serial cable provided. The FLOS commands RX (receive to memory),<br>TX (transmit from memory) and FRX (receive file and save to SD card), FTX (transmit<br>file from SD card) are used for FLOS command line file transfer. For details see<br>the <a href="Serial_Link_Info.html">Serial Comms Manual</a>.</pre><pre><br></pre><pre style="font-weight: bold;"><span style="text-decoration: underline;">FPGA Configs:</span></pre><pre>The onboard EEPROM can store multiple FPGA configurations in what (for simplicity)<br>are called "slots". On power-up, the FPGA starts from whichever is set to the<br>"Power-on Boot Slot". As supplied, OSCA for 50Hz PAL TVs in Slot 1 and OSCA for<br>60Hz NTSC TVs is in Slot 2 (the default boot slot will depend on the locale the<br>board was dispatched to.)</pre><pre>V6Z80P+ v1.1 boards come with Alessandro Dorigatti's Spectrum emulators<br>(Slot 3: Spectrum 48 Slot 4: Spectrum 128, Slot 5: Pentagon 128). These configs<br>must be launched with the FLOS command EMU (as they need to preload data such<br>as the Spectrum ROM). Each of the emulators can support a virtual divMMC interface<br>and esxDOS Operating System - this is enabled with a jumper in the V6Z80P header group:<br>When the jumper is on, the emulators use esxDOS mode. Note that OSCA's NMI jumper is<br>not used for the Spectrum emulators, the NMI feature (EG: go to file browser in esxDOS)<br>is mapped to the SCROLL_LOCK key. Please see the folder Alternative_Configs/Alessandro/<br>for full details on the Spectrum emulators.</pre><pre><br><img style="width: 239px; height: 89px;" alt="Spectrum mode" src="images/spectrum_mode.png"></pre><pre>All the configs supplied support VGA output&nbsp;using the rightmost jumper as<br>shown earlier.</pre><pre><br></pre><pre><span style="text-decoration: underline;">How to install new FPGA configs:</span></pre><pre>In FLOS, enter the command "EEPROM"&nbsp; (no quotes)</pre><pre>1. Choose Option 1 "Write config to slot".<br>2. When asked which slot, choose a slot showing "UNKNOWN" or a slot other than<br>&nbsp; &nbsp;the power-on boot slot.<br>3. Browse to the config's .bin or .v6c file (or choose "RS232" in the requester to use<br>&nbsp;&nbsp; the serial download option)<br>4. Wait for file to load, write to the EEPROM and complete verification.</pre><pre>If the config is a bootable, standalone atchitecture (EG: a new version of OSCA) you<br>should now test it by choosing Option 2 - "Reconfigure from a slot now (Non-permanent)"<br>and enter the slot number you used in step 2.</pre><pre>The FPGA will restart using the new config - this selection persists until&nbsp;cold reset.<br>If everything is OK, you can reload the EEPROM tool and choose option 3 to make the new<br>config the Power-On Boot Slot.</pre><pre>If the system does not start <span style="text-decoration: underline;">from power up</span> and the power LED flashes at a rate of about<br>1 pulse per second, the FPGA is not receiving a valid config file. To remedy this,<br>see the <a href="Tips_and_Troubleshooting_Guide.html">troubleshooting manual</a>.</pre><pre><br></pre><pre><br><span style="text-decoration: underline; font-weight: bold;">Other Jumper Pins:</span></pre><pre>Four other pins in the header group are used by OSCA / FLOS for Warm Reset and NMI (program<br>freezer). Button switches should be connected to these pin headers if these functions<br>are required. Note that the reset input here only resets the CPU and some of OSCA's<br>registers, it does not reconfigure the FPGA (see the info regarding jumper J2 for a<br>method to do that).</pre><pre><img style="width: 239px; height: 89px;" alt="other pins" src="images/other_jumpers.png"></pre><pre><br></pre><pre style="text-decoration: underline;">Jumpers J1 and J2:</pre><pre>These jumpers are mainly needed when configuring the FPGA from a JTAG cable<br>(EG: when testing new configurations). To enter JTAG config mode, with the power off, <br>install both jumpers and power on - the status LED flashes rapidly signifying that a<br>JTAG config should be sent to the board. </pre><pre>J2 also has additional functions: If a button is placed across J2 (and firmware 6.37<br>or above is installed in the config PIC) it can be used as a Cold Reset. IE: When the<br>button is pressed, the FPGA will reconfigure from whichever is the power-on boot slot<br>(this in turn causes a CPU reset). This is useful for escaping from the Spectrum emulators<br>without powering off/on.</pre><pre>J2 can also be used to manually set the power-on boot config slot (which is useful if an<br>incorrect slot has been set via software). See the <a href="Tips_and_Troubleshooting_Guide.html">troubleshooting guide</a> for details.<br><br></pre><pre><br><span style="text-decoration: underline; font-weight: bold;">The Boot Procedure:</span><br><br>When the power is switched on, a PIC microcontroller first checks for JTAG config mode<br>(J2 installed). If J2 is not shorted, the microcontroller&nbsp;clocks config data from the<br>selected power-on boot slot in the EEPROM into the FPGA. The FPGA configures and resets<br>the Z80, which then runs a small 512 byte ROM held within the FPGA. This ROM code loads<br>a bootloader from the EEPROM, which runs and&nbsp;loads the OS. (The OS can load from SD card,<br>EEPROM or via Serial Link - in that order of priority).</pre><pre>If the&nbsp;ROM cannot load a valid bootcode file from the EEPROM, the display will flash<br>magenta (bad CRC) or green (time out). If OSCA version 661 or above is installed it<br>is possible to send the bootcode file manually via the serial link when the display<br>turns grey. It is also possible to force serial transfer of the bootcode on power up<br>by holding UP+RIGHT+FIRE on a joystick in port A. (Note: The baud rate must be 115200).</pre><pre><br>On the bootloader screen, the following keys are active:</pre><pre>ESC - Cancel the boot process and wait for an OS to be downloaded via serial link<br> &nbsp; &nbsp; &nbsp;Whilst waiting, you can press F11 and F12 set the BAUD rate (default is 115200)<br> &nbsp; &nbsp;&nbsp;&nbsp;or press Left CTRL to reboot.<br><br>F1-F7 - Reconfigure the FPGA from an EEPROM slot (note: you cannot start<br>&nbsp;&nbsp; &nbsp; &nbsp; &nbsp;Alessandro's Spectrum emulators in this way - you must use the FLOS<br> &nbsp; &nbsp; &nbsp; &nbsp;command&nbsp;EMU for to start these).</pre><pre><br><br></pre><pre>==================================================================================================<br><span style="text-decoration: underline;"><br>Further&nbsp;Reading:</span><br><br><a href="FLOS_Manual.html">FLOS manual</a> - In depth FLOS user manual<br><br><a href="OSCA_Hardware_Manual.html">OSCA manual</a> - Full OSCA hardware description / register list<br><br><a href="PCB_technical_manual.html">PCB tech manual</a> - Detail about the physical PCB.<br><br><a href="Serial_Link_Info.html">Serial Comms manual</a> - More info concerning RS232 comms<br><br><a href="ROM_and_Bootcode_Info.html">ROM and Bootcode manual</a> - In depth info about the start up procedure.<br><br><a href="Tips_and_Troubleshooting_Guide.html">Troubleshooting Guide</a> - Tips and solutions to common problems<br><br>==================================================================================================<br><span style="text-decoration: underline;"><br></span><br><br><br><br></pre></body></html>