V6Z80P Speccy core 2.1.0 README
===============================
This is the binary distribution of V6Z80P Speccy core, a ZX Spectrum 48/128K FPGA core for the V6Z80P+ v1.1
or v1.1b board. Version 1.1 or 1.1b of the board are required because:

- The CPU clock must be generated by the FPGA

1. COPYRIGHT
============
V6Z80P Speccy core is released under the "Modified BSD license".
Please, read the COPYRIGHT.txt file provided with the distribution package for further details.

2. CORE DESCRIPTION
===================

- 48K/128K timing (PAL 50Hz and NTSC 60Hz ULA; 128K NTSC has the same timing of a 48K NTSC)
- CPU Clock running at 3.5 standard mode / 7MHz turbo mode
- TV and VGA output
- ULA+ 64 color mode
- Timex 8x1 attributes mode
- Timex alternative video RAM block
- Timex hires 512x192
- AY-3-8912 for both the 48K and 128K Spectrum, stereo ABC standard
- ZXMMC+ interface (by Alessandro Poppi) (512KB RAM + SD Card support)
- DivMMC virtual interface (DivIDE memory model with 8KB eprom + 256KB RAM and ZXMMC+ SD Card SPI interface)
- Kempston Joystick interface
- Virtual tape player
- Support for the EAR->Serial adapter cable which allows real tape (or .wav) input from devices with 3.5mm headphone sockets.

3. SETUP
========

Board jumpers
-------------

-- VIDEO MODE --
----------------
The core supports VGA output and TV output (PAL or NTSC).

To use VGA output, please close the VGA mode jumper (exactly as you do for FLOS in VGA mode).
The core starts in 50Hz vertical refresh mode; pressing F12 you can switch between 50Hz (PAL emulation)
and 60Hz (NTSC emulation).

To use TV output, please use the VGA to SCART RGB cable supplied with the board.
The core starts in PAL mode, but by pressing F12 you can switch between PAL and NTSC mode.

-- External interface --
------------------------
The core can emulate only one external interface at a time (ZXMMC+ or DivMMC).
You can choose the interface using the "ExpB" jumper (please, take a look at the
following figure as reference: http://wiki.retroleum.co.uk/liberty/view/file/81).

When ExpB is OPEN, the ZXMMC+ will be emulated and ResiDOS loaded at startup
When ExpB is CLOSED, the DivMMC will be emulated and ESXDOS loaded at startup

FPGA Configuration Files
------------------------
To install the core, you should copy the ".bin" files contained in the "FPGA config files" directory
to the root directory of the SD card. Start FLOS, then start the EEPROM TOOL typing "EEPROM + <Enter>"
at the prompt. Press "1" and identify 2 free slots. Enter the number of the first free slot.
When the file selector appears, select the 48K ".bin" config file you have previously copied on the SD card.
Repeat the EEPROM flash with the 128K ".bin" config file, placing it into the second slot. (Once installed
you can delete the .bin files from the root of the SD card if you wish).

EMU.EXE
-------
(Requires OSCA v.671 or above and FLOS v.602 or above)

From version 2.0.0, the core should be started using a FLOS program developed by Phil Ruston called EMU.EXE.
EMU.EXE enables the user to start both 48K and 128K versions of the Speccy core in a simple way. The program
is included in the UTILS directory of the standard V6_SD_CARD .svn project folder but is supplied in this
archive too (under "Support files") - just copy it to UTILS, if necessary, and it will be available from anywhere
in FLOS.

Please note: from version 2.1.0 EMU.EXE detects the ExpB jumper status. Note that when the jumper is CLOSED
(when the DivMMC interface/esxdos is selected) options 1) and 2) won't be available! If you want to use
the standard ROMs or the Tape Player, please leave the ExpB jumper OPEN.

ZX Spectrum ROMs
----------------
The ZXSPEC48.ROM and ZXSPE128.ROM files, available in the "support files" distribution directory, should be
copied in the /SPECTRUM directory of the SD Card; in most cases the files should be already there, as they're
also used by the older ZX Spectrum emulators made by Phil Ruston.

TAP files
---------
The .TAP files can be stored in any directory on the multimedia memory (TZX files are not supported at present).
Those files will be selected using the EMU.EXE program at the core startup.

Joystick
--------
You also can attach a joystick to the V6Z80P joystick port "A"; this joystick will be seen as
a Kempston joystick.

Keyboard
--------
A PS/2 keyboard must be, of course, connected to the board.

3.1 ResiDOS
-----------
A standard installation of ResiDOS (with pre-installed TapeIO and TaskMan packages) can be initialised
during the core startup using the EMU.EXE command. To take advantage of this feature, you should copy
the RESI48K.NVR and RESI128K.NVR files, contained in the "support files" distribution directory,
in the /SPECTRUM directory of the SD Card.

Remember to leave the ExpB jumper OPEN to use ResiDOS.

3.2 ESXDOS
----------
ESXDOS can be initialised during the core startup using the EMU.EXE command. To take advantage of this
feature, you should copy the ESXDOS.NVR file, contained in the "support files" distribution directory,
into the /SPECTRUM directory of the SD Card. Furthermore you need to copy the directories "BIN" and "SYS"
(also in "support files") in the / (ROOT) directory of the SD Card.

Remember CLOSE the ExpB jumper to use ESXDOS.

4. USAGE
========
Start FLOS.

4.1 EMU.EXE
-----------
Thanks to Phil Ruston, from version 2.0.0 the emulator can be started running the EMU.EXE from command line.
When entered without arguments, the following menu appears:


 Option 1 - Boot the machine to BASIC (available only if ExpB jumper is OPEN)
 ----------------------------------------------------------------------------
 Selecting this option, the emulator will be started in standard ZX Spectrum 48/128K mode; no tapes,
 no ResiDOS or ESXDOS installed. The version of the Speccy depends on the machine type selected using the Option 4.

 Option 2 - Load .tap /.bin file & boot (available only if ExpB jumper is OPEN)
 ------------------------------------------------------------------------------
 Selecting this option, a file selector will allow you to choose a TAP file that will be available to the tape player
 after the ZX Spectrum boot. Alternatively you can choose a ZX Spectrum binary file that will be executed just after the
 core start (this option can be useful to test small Speccy machine code programs...)

 Option 3 - Boot into Residos/ESXDOS
 -----------------------------------
 Selecting this option ResiDOS/ESXDOS will be run at core startup; the OS type depends on the ExpB jumper status:

 - ExpB jumper OPEN => ResiDOS
 - ExpB jumper CLOSED => ESXDOS

 Option 4 - Choose the Spectrum emulator version
 -----------------------------------------------
 Pressing the '4' key you can switch between the 2 version of the emulator (Spectrum 48 and Spectrum 128)

 Option 5 - Set Spectrum emulator config slots
 ---------------------------------------------
 When first run, you must tell EMU.EXE which EEPROM slots contain the emulator config files. This option
 allows these settings to be updated.

 Option 6 - Set machine selection as default
 -------------------------------------------
 Selecting this option, the machine type currently choosen with option 4 will be set as default at EMU startup.


The emulators can be booted more directly from the command line by entering the EMU command with paramters
as follows:

 "EMU M0" - boot Machine0, IE: 48 Spectrum
 "EMU M1" - boot Machine1, IE: 128 Spectrum

(If the program has not been run before, you'll be prompted to locate the FPGA config files.)



- Keyboard
----------
The keyboard now behaves like that of normal Spectrum. For reference, you will find (in the
binary core distribution root directory) a JPG image ("spectrum_keyboard.jpg") of a real ZX
Spectrum 48K "rubby" keyboard. All the original keys are mapped to the corresponding PS/2 key;
"CAPS SHIFT" is mapped on the PS/2 "LEFT SHIFT", "SYMBOL SHIFT" is mapped on "RIGHT SHIFT".

Some PS/2 keys are mapped to ZX Spectrum keys combo; the handled combo are:

- Backspace -> CAPS + 0
- Cursors -> CAPS + 5,6,7,8
- "," -> CAPS + n
- "." -> CAPS + m

- Scanline effect
-----------------
In VGA mode, there is an option to enable a "scanline" effect; this mimics the "stripes" you see
on a TV screen. You can enable/disable it with the key "F11".

- Virtual Tape player
---------------------
Assuming you copied a "TAP" file into memory, you can load it with the following steps:

- Type the command LOAD "" (to do this you must press the following keys: "J", "RIGHT SHIFT + P",
"RIGHT SHIFT + P", "ENTER". - Press the key "TAB" to "start the tape".

You will see the familiar loading stripes, and if you rise the volume of the speakers you will
also hear the loading sounds.

The tape player can be stopped/restarted when needed with the key "TAB".

In the case of the 128K Spectrum, the loading process is even simpler, as you can select the
first option in the ZX Spectrum 128K startup menu, and then "TAB".

-Real Tape (.wav) Input
-----------------------
Using the EAR->Serial cable (available from Phil Ruston, or see schematic: "tape_interface_circuit.png") 
you can load software exactly like an original Spectrum. If desired, existing .tap files can be converted
to .wav format and these can played from a PC etc into the V6Z80P via the headphone socket. To use the
real tape cable it is probably best to boot into a plain Spectrum (EXP_B jumper OPEN, option 1 in EMU),
then simply enter LOAD "" and start the tape / play the .wav file.

- Reset
-------
The RESET jumper on the board is handled by the core and, if closed, will reset the ZX Spectrum.
The "ESC" key too will behave as reset key.

- NMI
-----
The "Scroll" key will behave as NMI button; this button, normally resetting a ZX Spectrum 48K
using a standard ROM, is useful to enter the Task Manager in ResiDOS (and file browser in ESXDOS)

- CPU clock speed
-----------------
At the core startup, the CPU clock frequence will be set to 3.5MHz (standard ZX Spectrum 48/128K);
pressing F1 or F2 on the keyboard, you can change the CPU clock frequency:

F1 = 3.5MHz
F2 = 7.0MHz

The tape player will change its speed accordingly to the CPU clock frequence.

F1 = tape speed 1x
F2 = tape speed 2x

In this way, you can load tapes at 2 times the original speed, and 1/2 of the original time.

7MHz mode is "experimental"; if you use it, be prepared to some incompatibility issues
(i.e.: zx spectrum resets, program crashes), in particular when you run demos or similar programs.

5. ULA Plus 64 color mode
=========================
This core supports one of the graphics mode of ULAplus, an enhanced ULA for the ZX Spectrum designed
by Cheveron, Nikki, C.Smith and KLP2. It is designed to make it easy to re-colour existing software
with the minimum of effort.

For further information about ULA+, please visit the following link:
http://sites.google.com/site/ulaplus/

6. ESXDOS
=========
ESXDOS aims to be the ultimate firmware for the DivIDE interface. The version included in the V6Z80p
Speccy core distribution is specifically designed for a virtual interface (DivMMC) with the following
specs:

- Memory model and automapping feature compatible with the original DivIDE interface
- 256KB of RAM (instead of the standard 32KB)
- SD Card support using the same ports handled by the ZXMMC+ interface by Alessandro Poppi

For a fast overview of the ESXDOS features, the original esxDOS 0.8.0 README is included in the
distribution package.

7. ResiDOS
==========
Please: be sure to use an SD card max 2GB in size and formatted with a FAT16 filesystem!

- Quickstart
------------
For a complete overview of the system, please go to the URL:
http://www.worldofspectrum.org/residos/

Just as an example, I will list some useful commands.

%dir - will show the current directory
%cd"<directory>" - will change the current directory
%snapload"<snapshot file.SNA>" - will load&run a "SNA" file
%snapload"<z80snapshot file.Z80>" - will load&run a "Z80" snapshot file

IMPORTANT!: ResiDOS will recognise the snapshot type (SNA or Z80) by the file extension!
Please, use the correct file extension.

- Install new packages
----------------------
If you want to install a package, go into the directory containing the "pkg" file.
Type the following commands at the prompt:

CLEAR 32767
%install"<file.pkg>"

- TAPE I/O package
------------------
This package enables the loading of TAP and TZX (partially supported) files.
To load a TAP file, go into the directory containing the "tap" file.
Type the following commands at the prompt:

%tapein"<tapfile.tap>" - this command attaches the TAP file
%tapelist - optional, this command will list the TAP content
LOAD "" - exactly as you do to normally load a tape

- TASK MANAGER
--------------
Using this package you can store several tasks at the same time, and switch between them instantly
from the task manager screen. To recall the task manager, press the NMI button ("CAPS" key on the
keyboard).

ResiDOS it's a wonderful system and can do a lot more! For further details, please go to the URL:
http://www.worldofspectrum.org/residos/

8. USEFUL LINKS
===============
The best source for ZX Spectrum stuff is "World of Spectrum" (http://www.worldofspectrum.org/).
From there you can download tons of games in "TAP" format (http://www.worldofspectrum.org/archive.html).

If you are new to the ZX Spectrum, you could take a look to the following guides:

ZX Spectrum introduction - http://www.worldofspectrum.org/ZXSpectrumIntroduction/
Basic programming manual - http://www.worldofspectrum.org/ZXBasicManual/

If you are new to ResiDOS, you could take a look at the following website:
ResiDOS homepage - http://www.worldofspectrum.org/residos/

ESXDOS homepage - http://esxdos.org/

9.LIMITATIONS
=============
Some games will not run when using alternative Operating Systems such as ResiDOS and ESXDOS due
to differences in the ROMs. One workaround is to use the .tap preloader (option 2 in EMU.EXE),
optionally employing the turbo mode (F2) to speed up loading.

10. ACKNOWLEDGEMENTS
===================
The V6Z80P Speccy core is derived from the ZX-One 1.0 core.

I'd like to sincerely thank:

Peter Wendrich for his continuous support (and patience) during the whole development process
(http://www.syntiac.com/)

Chris Smith for his exceptional book "The ZX Spectrum ULA", source of inspiration for this work
(http://www.zxdesign.info/)

Tobias Gubener for the support and the information about the C-One startup sequence

Jens Schönfeld for the C-One and for hosting the ZX-One core on the C-One official web-site
(http://www.c64upgra.de/c-one/)

Phil Ruston for the support during the V6Z80P Speccy core development and for the V6Z80p board
(http://www.retroleum.co.uk/v6z80p/)

Garry Lancaster for ResiDOS and the support during the Z80p48K core development
(http://www.worldofspectrum.org/residos/)

Miguel Guerreiro for ESXDOS and the support during the V6Z80p Speccy core development
(http://esxdos.org/)

9. CONTACT ME
=============
You can contact me (Alessandro Dorigatti) at the following e-mail address: adorigatti@gmail.com
Every feedback is welcome.
