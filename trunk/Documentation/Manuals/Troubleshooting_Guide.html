<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head><meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>V6Z80P Troubleshooting Guide</title></head>
<body><h1><span style="text-decoration: underline; font-weight: bold;">V6Z80P Tips / Troubleshooting Guide:</span></h1><pre><span style="text-decoration: underline;"><br><span style="font-weight: bold;">General:</span></span><br><br>Avoid connecting or disconnecting anything to the V6Z80P whilst the power is switched on<br>(SD cards shouldn't be a problem, but FLOS cannot automatically recognize card swaps<br>so any card inserted whilst the power is on&nbsp;needs to be initialized with the "MOUNT"<br>command).</pre><pre><span style="text-decoration: underline;"><br><br><span style="font-weight: bold;">FLOS:</span></span><span style="font-weight: bold;"> </span></pre><pre>If you have any problems formatting an SD card to FAT16 on the PC, try doing it under<br>FLOS with the command: FORMAT SD_CARD</pre><pre>You can create a multi-volume SD card if you wish by using the FLOS utility DISKTOOL.<br>This can make up to 4 partitions using the 4 slots in the Master Boot Record. Note however,<br>that Windows (XP) will only see the first partition since it uses a different scheme for<br>partitioning. (Linux will gnerally see all the FLOS partitions).</pre><pre><br><br><span style="text-decoration: underline; font-weight: bold;">Serial Comms:</span></pre><pre>Whilst the Windows GUI "Serial Link" is useful for occasional file transfers, it may be<br>more convenient to use "SerialTX". This is a console / command line based utility<br>(found in the project's "PC-based Apps" folder) which can send files&nbsp;from other<br>programs etc, via "open with" etc. It can also be handy to copy FileTX to Windows'<br>"Send To" list so that files can be send via a right click -&gt;Send To.</pre><pre><br><span style="font-weight: bold; text-decoration: underline;">Sound:</span><br><br>The default sound set-up of OSCA is stereo separation. If you prefer mono output (which<br>sends all 4 channels to both side, also increasing the overall volume) add the line<br>MONO to the BOOTRUN.SCR file in the root of the SD Card.<br></pre><br><br><pre style="text-decoration: underline;"><span style="font-weight: bold;">Peripherals:</span></pre><pre><span style="font-weight: bold;"> Serial port:</span> If your PC does not have a 9 pin serial connector, a USB serial adapter<br> should work fine. &nbsp;The "Prolific" chipset cables (about £2-£10 on eBay) are known to<br> work well, but make sure you get the latest drivers.</pre><pre><span style="font-weight: bold;"> Keyboard:</span> A modern USB keyboard can be used if it came with a PS/2 adapter but<br> some of these keyboards have unusual / slow start up sequences. If you encounter<br> problems, create a text file in the root of your SD card called SYSTEM.CFG containing<br> the line RESETKB=0. (The default bootloader action is to reset the keyboard and wait<br> for acknowledgement). The total power the V6Z80P can delivery to the keyboard and<br> mouse in total is about 100mA, so check the power consumption of your devices (it'll<br> normally be stated on the label).<br><br>  The default keymap used by FLOS is that of the UK but this can be changed with the<br>  KEYMAP command. Keymaps for Germany, France, Italy, Portugal and USA are supplied<br>  and an editor is provided (KMAPEDIT) to make others.</pre><pre><span style="font-weight: bold;"> Joystick ports</span>: Essentially, these are wired as per the standard Atari 2600 style. The<br> second fire button is connected to pin 9 (same as on the Amiga). Pin 5 is connected<br> to 3.3volts (via a small resistor (22ohm) so can provide a little power - this should<br> allow Megadrive pads to be used too). Pin 7 is unconnected.</pre><pre><span style="font-weight: bold;"> SD cards:</span> It has been found that some ultra-cheap cards do not work in the V6Z80P (and<br> other hobbyist project boards). Good brand MMC, SD and SDHC cards should all work. </pre><pre><br></pre><pre><br><span style="text-decoration: underline; font-weight: bold;">FPGA Start up:</span></pre><pre>If the FPGA does not receive a valid configuration pattern from the EEPROM upon<br>power on, the status LED will flash slowly (around 1 flash per second). There are<br>various ways to fix this:</pre><pre style="text-decoration: underline;">Recovery procedure for V6Z80P+ Boards</pre><pre>OPTION 1: Assuming there is a working config in Slot 1 - 7 and the problem is just that<br>          the Power-On Boot Slot selection is pointing at a bad config:</pre><pre>* Power off.<br>* Install jumper J2 only (or hold down button if one is connected to J2)<br>* Power on (status led flashes rapidly).<br>* Remove jumper J2 again (or release button)<br>* If the LED continues to flash rapidly, install and remove jumper (press and release button)<br>* The status LED will now flash once, pause about 5 seconds, then flash twice, pause 5 seconds,<br>&nbsp; then flash three times and so on - the number of flashes represents the power-on slot selection.<br>&nbsp; During the pause following the slot selection you require, replace the jumper (or press the button)<br>&nbsp; the LED will then stay on permanently signifying that the slot has been set.<br>* Power off and remove Jumper J2 (or release the button)</pre><pre><br>OPTION 2: JTAG configuration - requires suitable Xilinx JTAG cable.<br><br>* Power off and connect JTAG cable to the V6Z80P.<br>* Install jumpers J1 and J2.<br>* Load the most recent OSCA project into Xilinx webpack ISE 10.1 and send the OSCA<br>&nbsp; config .bit file from the PC to the V6Z80P via the Impact option.<br>* If the bootcode is intact in the EEPROM, the system will start as normal allowing you to<br>&nbsp; load EEPROM.EXE via FLOS. If the bootcode checksum fails the screen will flash magenta,<br>&nbsp; then grey, you will need to send the bootcode (.epr file from the bootcode folder) via<br>  serial link and then run EEPROM to install it.<br>* Remove jumpers J1 and J2 next time you power off so that the system automatically<br>&nbsp; configures from the EEPROM.</pre><pre><br><span style="text-decoration: underline;">Recovery procedure for the older, original V6Z80P Board</span></pre><pre>OPTION 1: With Config PIC firmware v616+ the Active Slot can be changed manually.&nbsp;Assuming<br>          there is a working config in Slot 1, 2 or 3 and the problem is just that the power<br>          on boot slot selection is pointing at a bad config:</pre><pre>* Power off.<br>* Install jumper J2 only<br>* Power on (yellow led flashes rapidly - JTAG mode).<br>* Remove jumper J2 again<br>* The PIC will reset the active slot to 1 (indicated by 1 pulse of the red LED)<br>&nbsp; The yellow led lights up for 4 seconds then Slot 2 is set (2 flashes of red LED),<br>&nbsp; again there's a 4 second pause, finally slot 3 is set (3 flashes).<br>* Power off only when the yellow LED is lit following the desired slot setting.<br>* When you power on the active slot will correctly point to slot 1, 2 or 3.</pre><pre><br>OPTION 2:  Remove and reprogram the EEPROM or config PIC externally. <br><br>It is the PIC chip that actually holds the slot selection - you will only need to reprogram<br>the PIC if you have old firmware that doesn't support the manual slot selection. If you do<br>reprogram the PIC, use the latest firmware .hex file so that you wont have to do so again.<br>If you reprogram the EEPROM, use "default.bin" from the folder development_files/v6z80p/eeprom<br>this also contains the bootcode for SLOT 0.</pre><pre><br>OPTION 3: JTAG config. If none of the first 3 slots contain OSCA:</pre><pre>* Power off and connect a Xilinx JTAG cable to the V6Z80P.<br>* Install jumpers J1 and J2.<br>* Load the most recent OSCA project into Xilinx webpack ISE and send the OSCA config .bit<br>&nbsp; file from the PC to the V6Z80P via JTAG.<br>* If the bootcode is intact in the EEPROM, the system will start as normal allowing you to load<br>&nbsp; EEPROM.EXE via FLOS. If the bootcode checksum fails the screen will flash magenta, then grey.<br>&nbsp; You will need to send the bootcode (.epr file from the bootcode folder) via serial link and<br>  then run EEPROM to install it.<br>* Remove jumpers J1 and J2 next time you power off so that the system automatically configures<br>&nbsp; from the EEPROM.<br><br><br><br><span style="font-weight: bold; text-decoration: underline;">System Start Up</span><br><br>Once the FPGA has sucessfully configured, its internal ROM attempts to load the system<br>bootcode, which should be located on the onboard EEPROM. If there is a problem, the screen<br>flashes magenta and after trying again, it turns grey. At this point a&nbsp;bootcode file (EG:<br>bootcode.epr) can be downloaded via the serial link (must be 115KBPS). The grey screen<br>condition can also be forced by holding up, right and fire on a joystick in Port 1 <br>at power up. Once FLOS is loaded, the bootcode file can be replaced on the EEPROM using<br>the utility EEPROM.FLX<br><br><br><br><span style="font-weight: bold; text-decoration: underline;">Misc:</span><br><br>An OSCA/FLOS emulator for Windows (by Tony Friery) is available in the Contributions/Tony.<br>This has progressed far enough to allow simple FLOS programs to be tested on the PC. Bear<br>in mind that timing is currently not perfect and certain elements of OSCA (EG: line draw) are<br>not yet emulated.<br><br><br><br></pre></body></html>