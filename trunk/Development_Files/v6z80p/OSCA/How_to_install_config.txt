
Installing an FPGA config onto the EEPROM
-----------------------------------------

1. Optional: Copy the relevant FPGA config *.bin file to the SD card.

2. Boot into FLOS.

3. Load the EEPROM tool (eeprom.exe)

    ( If EEPROM.EXE is not on your SD card..                            )
    ( Enter command "RX !"                                              )
    ( Send EEPROM.EXE from the utils folder with the PC serial link app )

4. Update the bootcode to the latest version if necessary:
   (see Development_Files\v6z80p\EEPROM\Bootcode\bootcode.epr) This is
    currently required if updating from a version of OSCA prior to V661)
   
5. Choose Option 1 "Write config to slot".

6. Choose an inactive slot.

7. Locate the config .bin file on disk, or send it (from "Config File" folder)
   with the Serial Link app, choosing the "RS232" option in the dialog box for
   serial download.

8. Wait for file to load, write to EEPROM and complete verification.

9. Choose Option 2 - "Reconfigure from a slot now" (Non-permanent)

10. When prompted, choose to reconfigure from whichever slot you
   used in step 5

11. The FPGA restarts with the new FPGA firmware. This selection
    persists until power off (or changed again with this util)

12. If everything is OK, you can reload the EEPROM tool and choose option 3
    to make the new slot active.

   ( If you want, you can just rewrite the active slot in the first place, but       )
   ( the method above allows you to test the new config before making it the         )
   ( default startup config.  IE: If you accidentally overwrite the current Active   ) 
   ( Slot data with a bad config, the system will not start at power on and you'll   )
   ( be forced to use one of the manual config options to correct it - details below )

   ( It is recommended that a known-working OSCA config file is always left in slot 1 )



Emergency recovery options:
---------------------------
 
There are 3 different ways to overcome a bad configuration selection
(IE: when the system does not boot.)


 1. With the newer PIC firmware versions, it is possible to change the Active
    Slot manually - of course, for this to be useful you must actually have a
    working configurarion file in one of the slots.
      
    Manual Slot Selection:
    ----------------------

      * Power off.
      * Install jumper J2 only
      * Power on (yellow led flashes rapidly). 
      * Remove jumper J2 again
      * The PIC will reset the active slot to 1 (indicated by 1 pulse of the red LED)
        The yellow led lights up for 4 seconds
        Afterwards, Slot 2 is set (2 flashes of red LED)
        Again there's a 4 second pause, finally slot 3 is set (3 flashes).
      * Power off as soon as the yellow LED comes on following the desired slot setting.
      * When you next power on, the new active slot will be utilized.
 
   
 2. Remove and reprogram the EEPROM or config PIC externally. (Note: The
    PIC holds the slot selection so reprogramming it will reset the active
    slot to SLOT 1). If you reprogram the EEPROM, you'll need to
    preserve $0-$1FFFF as this holds the bootcode (and OS, but that can be
    reinstalled later). It is probably best to erase the entire EEPROM and
    reprogram it with the default binary supplied in the development folder.
  
 
 3. Use the JTAG cable, install J1 and J2 and send the OSCA config from the
    Xilinx webpack software. As long as the bootcode is intact in the EEPROM,
    the system will start and you can then download FLOS and use the EEPROM.EXE
    program.

-------------------------------------------------------------------------------

Note:

It is possible to update FLOS/bootcode/OSCA in slots 0 and 1 in one go using
the FLOS command:

FIRMWARE.EXE default.bin 0

Normally this is only used to set up a new board or update very old systems
(as the default.bin files are not regularly updated). The "default.bin" file
is in the folder Development_Files\v6z80p\EEPROM

(Slot 1 should be the ACTIVE SLOT if the FIRMWARE.EXE command is used, so that
the system starts from the newly written config. It does not set the slot itself.)

---------------------------------------------------------------------------------
