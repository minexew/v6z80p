Z80p48K 0.9.2 README
====================
This is the binary distribution of Z80p48K, a ZX Spectrum 48K FPGA core for the V6Z80P+ v1.1
or v1.1b board. Version 1.1 or 1.1b of the board are required because:

- The CPU clock must be generated by the FPGA
- A 14MHz oscillator is required to achieve the exact CPU clock frequency

1. COPYRIGHT
============
Z80p48K is released under the "Modified BSD license".
Please, read the COPYRIGHT.txt file provided with the distribution package for further details.

2. CORE DESCRIPTION
===================
The core simulates a ZX Spectrum 48K equipped with a ULA supporting the "ULA+ 64 color mode",
a tape player and a Kempston joystick interface. The CPU clock frequence can be changed on-the-fly
to 3.5MHz, 7MHz, 14MHz. From version 0.9.2 a ZXMMC interface (by Alessandro Poppi) is also emulated;
this enables the ResiDOS (by Garry Lancaster) installation and use.

The core does support VGA output and TV output (PAL or NTSC).

To use VGA output, please close the VGA mode jumper (exactly as you do for FLOS in VGA mode).
The core starts in 50Hz vertical refresh mode; pressing F12 you can switch between 50Hz (PAL emulation)
and 60Hz (NTSC emulation).

To use TV output, please use the VGA to SCART RGB cable supplied with the board.
The core starts in PAL mode, but by pressing F12 you can switch between PAL and NTSC mode.

3. SETUP
========
To install the core, you should copy the ".bin" file contained in the "configuration" directory
to the root directory of the SD card. Start FLOS, then start the EEPROM TOOL typing "EEPROM + <Enter>"
at the prompt. Identify a free slot, then type "1"; when asked, enter the number of the free slot.
When the file selector appears, select the ".bin" file you have previously copied on the SD card.

Currently, the core requires some manual initialization under FLOS before starting up each time.
You need to copy the Spectrum ROM to system memory and a .TAP file to multimedia memory (TZX files
are not supported at present). See details below.

You also can attach a joystick to the V6Z80P joystick port "A"; this joystick will be seen as
a Kempston joystick. A PS/2 keyboard must be, of course, connected to the board.

3.1 ResiDOS
-----------
To install and use ResiDOS, you should download (and copy in your SD card) the following file:
http://www.worldofspectrum.org/residos/files/zxmmc/residos.tap

I strongly suggest to download (and copy in your SD card) also two additional ResiDOS packages.

TapeI/O support package: http://www.worldofspectrum.org/residos/files/tapeio.pkg
Task manager package: http://www.worldofspectrum.org/residos/files/taskman.pkg

4. USAGE
========
Start FLOS.
First of all you must copy the ZX Spectrum 48K ROM into the system RAM.
Assuming you have the Spectrum ROM file inside the directory "SPECTRUM" of the SD card and that
it's named "ZXSPEC48.ROM", type the following commands at the prompt:

CD SPECTRUM <Enter>
LB ZXSPEC48.ROM 8000 1

If you want to use a TAP file as tape image for the core, you have to load it into the multimedia
RAM. To do this, type the following command at the prompt:

LOADVID <file_name.tap> 20000

(The Spectrum ROM file and a test .tap file (Manic Miner) are supplied in the "support files"
subdirectory of this project)

4.1 ResiDOS installation tape
-----------------------------
If you have copied the residos.tap installation file in your SD card, you can use it to install
ResiDOS typing at the prompt:

LOADVID residos.tap 20000

At this point you can boot the Spectrum core typing:

BOOT <n>, with <n> the slot number where you flashed the configuration file using the EEPROM tool.

After the core startup, you'll see the familiar Sinclair copyright screen.

- Keyboard
----------
The keyboard now behaves like that of normal Spectrum. For reference, you will find (in the
binary core distribution root directory) a JPG image ("spectrum_keyboard.jpg") of a real ZX
Spectrum 48K "rubby" keyboard. All the original keys are mapped to the corresponding PS/2 key;
"CAPS SHIFT" is mapped on the PS/2 "LEFT SHIFT", "SYMBOL SHIFT" is mapped on "RIGHT SHIFT".

- Scanline effect
-----------------
When the core starts in VGA mode, the "scanline" effect is enabled by default; this effect
mimics the "stripes" you see on a TV screen. If you don't like this effect, you can enable/disable
it with the key "F11".

- Tape player
-------------
Assuming you copied a "TAP" file into memory, you can load it with the following steps:

- Type the command LOAD "" (to do this you must press the following keys: "J", "RIGHT SHIFT + P",
"RIGHT SHIFT + P", "ENTER". - Press the key "TAB".

You will see the familiar loading stripes, and if you rise the volume of the speakers you will
also hear the loading sounds.

The tape player can be stopped/restarted when needed with the key "TAB".

- Reset
-------
The RESET jumper on the board is handled by the core and, if closed, will reset the ZX Spectrum.
From version 0.9.2 the "ESC" key too will behave as reset key.

- NMI
-----
From version 0.9.2 the "CAPS" key will behave as NMI button; this button, normally resetting
a ZX Spectrum 48K using a standard ROM, is useful to enter the Task Manager in ResiDOS.

- CPU clock speed
-----------------
At the core startup, the CPU clock frequence will be set to 3.5MHz (standard ZX Spectrum 48K);
pressing F2 or F3 on the keyboard, you can change the CPU clock frequence:

F1 = 3.5MHz
F2 = 7.0MHz
F3 = 14.0MHz

The tape player will change its speed accordingly to the CPU clock frequence.

F1 = tape speed 1x
F2 = tape speed 2x
F3 = tape speed 4x

In this way, you can load tapes at 4 times the original speed, and 1/4 of the original time.

7MHz and 14MHz modes are "experimental"; if you use them, be prepared to some incompatibility issues
(i.e.: zx spectrum resets, program crashes), in particular when you run demos or similar programs.

5. ULA Plus 64 color mode
=========================
This core supports one of the graphics mode of ULAplus, an enhanced ULA for the ZX Spectrum designed
by Cheveron, Nikki, CSmith and KLP2. It is designed to make it easy to re-colour existing software
with the minimum of effort.

For further information about ULA+, please visit the following link:
http://sites.google.com/site/ulaplus/

6. ResiDOS
==========
If, during the core startup, you have loaded the residos.tap file, please load it following the standard
procedure (LOAD "", TAB key, eventually speedup the loading process using the 7MHz or the 14MHz modes).

At the end of the tape loading, you'll se the ResiDOS installation screen; please press the "Enter" key.
The 512KB additional external RAM should be recognised. Press the "Enter" key again. The machine should
reboot in a second, showing the ResiDOS welcome screen.

The system will check for a SD card.

Please: be sure to use an SD card max 2GB in size and formatted with a FAT16 filesystem! If your SD
card work in FLOS, it should work in ResiDOS too.

- Quickstart
------------
For a complete overview of the system, please go to the URL:
http://www.worldofspectrum.org/residos/

Just as an example, I will list some useful commands.

%dir - will show the current directory
%cd"<directory>" - will change the current directory
%snapload"<snapshot file.SNA>" - will load&run a "SNA" file
%snapload"<z80snapshot file.Z80>" - will load&run a "Z80" snapshot file

IMPORTANT!: ResiDOS will recognise the snapshot type (SNA or Z80) by the file extension!
Please, use the correct file extension.

- Install new packages
----------------------
If you want to install a package, go into the directory containing the "pkg" file.
Type the following commands at the prompt:

CLEAR 32767
%install"<file.pkg>"

- TAPE I/O package
------------------
This package enables the loading of TAP and TZX (partially supported) files.
To load a TAP file, go into the directory containing the "tap" file.
Type the following commands at the prompt:

%tapein"<tapfile.tap>" - this command attaches the TAP file
%tapelist - optional, this command will list the TAP content
LOAD "" - exactly as you do to normally load a tape

- TASK MANAGER
--------------
Using this package you can store several tasks at the same time, and switch between them instantly
from the task manager screen. To recall the task manager, press the NMI button ("CAPS" key on the
keyboard).

ResiDOS it's a wonderful system and can do a lot more! For further details, please go to the URL:
http://www.worldofspectrum.org/residos/

7. USEFUL LINKS
===============
The best source for ZX Spectrum stuff is "World of Spectrum" (http://www.worldofspectrum.org/).
From there you can download tons of games in "TAP" format (http://www.worldofspectrum.org/archive.html).

If you are new to the ZX Spectrum, you could take a look to the following guides:

ZX Spectrum introduction - http://www.worldofspectrum.org/ZXSpectrumIntroduction/
Basic programming manual - http://www.worldofspectrum.org/ZXBasicManual/

If you are new to ResiDOS, you could take a look at the following website:

ResiDOS homepage - http://www.worldofspectrum.org/residos/

8. ACKNOWLEDGEMENTS
===================
The Z80p48K 0.9.1 core is derived from the ZX-One 1.0 core.

I'd like to sincerely thank:

Peter Wendrich for his continuous support (and patience) during the whole development process
(http://www.syntiac.com/)

Chris Smith for his exceptional book "The ZX Spectrum ULA", source of inspiration for this work
(http://www.zxdesign.info/)

Tobias Gubener for the support and the information about the C-One startup sequence

Jens Sch√∂nfeld for the C-One and for hosting the ZX-One core on the C-One official web-site
(http://www.c64upgra.de/c-one/)

Phil Ruston for the support during the Z80p48K core development and for the V6Z80p board
(http://www.retroleum.co.uk/v6z80p/)

Garry Lancaster for ResiDOS and the support during the Z80p48K core development
(http://www.worldofspectrum.org/residos/)

9. CONTACT ME
=============
You can contact me (Alessandro Dorigatti) at the following e-mail address: adorigatti@gmail.com
Every feedback is welcome.
