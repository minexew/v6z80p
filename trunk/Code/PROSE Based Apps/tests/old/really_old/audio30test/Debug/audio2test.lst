Zilog eZ80 Macro Assembler Version 4.1 (10060805)30-Jan-11     14:35:22     page:   1


PC     Object              I  Line    Source 
                           A     1    ; Test audio output (test hardware in config EZ
                           A     2    
                           A     3    ;----------------------------------------------
                           A     4    
       00000001            A     5    ADL_mode		equ 1				; 0 if user
       00010000            A     6    load_location	equ 10000h			; anywhere 
                           A     7    
                           B     0    				include	'PROSE_header.asm'
                           B     1    
                           B     2    ;-- EZ80P Hardware equates --------------------
                           B     3    
       00000000            B     4    port_pic_data  			equ 0000h
       00000001            B     5    port_pic_ctrl		equ 0001h
       00000001            B     6    port_hw_flags			equ 0001h
       00000002            B     7    port_sdc_ctrl			equ 0002h	; this is a
       00000002            B     8    port_keyboard_data		equ 0002h
       00000003            B     9    port_sdc_data		 	equ 0003h	
       00000004            B    10    port_memory_paging		equ 0004h
       00000005            B    11    port_irq_ctrl			equ 0005h
       00000006            B    12    port_nmi_ack			equ 0006h
       00000007            B    13    port_selector			equ 0007h
                           B    14    
                           B    15    
       00000040            B    16    port_video_mode			equ 040h
                           B    17    
                           B    18    
       00000000            B    19    sdc_power				equ 0		;(port_sd_c
       00000001            B    20    sdc_cs					equ 1		;(port_sd_c
       00000002            B    21    sdc_speed				equ 2 		;(port_sd_c
                           B    22    
       00000004            B    23    sdc_serializer_busy		equ 4 		;(port_hw_f
       00000005            B    24    vrt						equ 5		;(port_hw_f
                           B    25    
                           B    26    
                           B    27    ;-- Memory locations --------------------------
                           B    28    
       00800000            B    29    hw_vram_a		equ 0800000h
       00F00000            B    30    hw_palette	equ 0f00000h
                           B    31    
                           B    32    ;----------------------------------------------
                           B    33    
                           B    34    
       00000A00            B    35    os_start equ 0a00h
                           B    36    
       00000A14            B    37    prose_return equ os_start+14h
       00000A20            B    38    prose_kernal equ os_start+20h
                           B    39    
                           B    40    ;----------------------------------------------
                           B    41    ; Kernal Jump Table values for mode PROSE
                           B    42    ;----------------------------------------------
                           B    43    		
       00000000            B    44    kr_mount_volumes				equ 00h	
Zilog eZ80 Macro Assembler Version 4.1 (10060805)30-Jan-11     14:35:22     page:   2


PC     Object              I  Line    Source ..\..\includes\PROSE_header.asm
       00000001            B    45    kr_get_device_info				equ 01h	
       00000002            B    46    kr_check_volume_format			equ 02h	
       00000003            B    47    kr_change_volume				equ 03h	
       00000004            B    48    kr_get_volume_info				equ 04h	
       00000005            B    49    kr_format_device				equ 05h	
       00000006            B    50    kr_make_dir						equ 06h
                           B    51    
       00000007            B    52    kr_change_dir					equ 07h	
       00000008            B    53    kr_parent_dir					equ 08h	
       00000009            B    54    kr_root_dir						equ 09h
       0000000A            B    55    kr_delete_dir					equ 0ah
       0000000B            B    56    kr_find_file					equ 0bh
       0000000C            B    57    kr_set_file_pointer				equ 0ch
       0000000D            B    58    kr_set_load_length				equ 0dh
       0000000E            B    59    kr_read_file					equ 0eh
                           B    60    
       0000000F            B    61    kr_erase_file					equ 0fh
       00000010            B    62    kr_rename_file					equ 10h
       00000011            B    63    kr_create_file					equ 11h
       00000012            B    64    kr_write_file					equ 12h
       00000013            B    65    kr_get_total_sectors			equ 13h
       00000014            B    66    kr_dir_list_first_entry			equ 14h
       00000015            B    67    kr_dir_list_get_entry			equ 15h
       00000016            B    68    kr_dir_list_next_entry			equ 16h
                           B    69    
       00000017            B    70    kr_read_sector					equ 17h
       00000018            B    71    kr_write_sector					equ 18h
       00000019            B    72    kr_file_sector_list				equ 19h
       0000001A            B    73    kr_get_dir_cluster				equ 1ah
       0000001B            B    74    kr_set_dir_cluster				equ 1bh
       0000001C            B    75    kr_get_dir_name					equ 1ch
       0000001D            B    76    kr_wait_key						equ 1dh
       0000001E            B    77    kr_get_key						equ 1eh
                           B    78    
       0000001F            B    79    kr_get_key_mod_flags			equ 1fh
       00000020            B    80    kr_serial_receive_header		equ 20h
       00000021            B    81    kr_serial_receive_file			equ 21h
       00000022            B    82    kr_serial_send_file				equ 22h
       00000023            B    83    kr_serial_tx_byte				equ 23h
       00000024            B    84    kr_serial_rx_byte				equ 24h
                           B    85    
       00000025            B    86    kr_print_string					equ 25h
       00000026            B    87    kr_clear_screen					equ 26h
       00000027            B    88    kr_wait_vrt						equ 27h
       00000028            B    89    kr_set_cursor_position			equ 28h
       00000029            B    90    kr_plot_char					equ 29h
       0000002A            B    91    kr_set_pen						equ 2ah
       0000002B            B    92    kr_background_colours			equ 2bh
       0000002C            B    93    kr_draw_cursor					equ 2ch
       0000002D            B    94    kr_get_pen						equ 2dh
       0000002E            B    95    kr_scroll_up					equ 2eh
       0000002F            B    96    kr_os_display					equ 2fh
Zilog eZ80 Macro Assembler Version 4.1 (10060805)30-Jan-11     14:35:22     page:   3


PC     Object              I  Line    Source ..\..\includes\PROSE_header.asm
       00000030            B    97    kr_get_display_size				equ 30h
       00000031            B    98    kr_get_charmap_addr_xy			equ 31h
       00000032            B    99    kr_get_cursor_position			equ 32h
                           B   100    
       00000033            B   101    kr_set_envar					equ 33h
       00000034            B   102    kr_get_envar					equ 34h
       00000035            B   103    kr_delete_envar					equ 35h
                           B   104    
       00000036            B   105    kr_enable_mouse					equ 36h
       00000037            B   106    kr_get_mouse_position			equ 37h
       00000038            B   107    kr_get_mouse_disp				equ 38h
                           B   108    
       00000039            B   109    kr_time_delay					equ 39h
       0000003A            B   110    kr_compare_strings				equ 3ah
       0000003B            B   111    kr_hex_byte_to_ascii			equ 3bh
       0000003C            B   112    kr_ascii_to_hex_word			equ 3ch
       0000003D            B   113    kr_get_string					equ 3dh
                           B   114    
       0000003E            B   115    kr_get_version					equ 3eh
       0000003F            B   116    kr_dont_store_registers			equ 3fh
       00000040            B   117    kr_os_video_settings			equ 40h
       00000041            B   118    kr_read_rtc						equ 41h
       00000042            B   119    kr_write_rtc					equ 42h
                           B   120    
                           B   121    ;----------------------------------------------
                           B   122    ; Standard PROSE executable header
                           B   123    ;----------------------------------------------
                           B   124    
                           B   125    
                           B   126    	IF ADL_mode = 0
                           B   127    		org load_location&0ffffh	; if Z80 mo
                           B   128    	ELSE
010000                     B   129    		org load_location			; otherwise
                           B   130    	ENDIF
                           B   131    	
                           B   132    		.assume ADL = 1				; All PROSE
                           B   133    
010000 18 0E               B   134    		jr skip_header				; $0 - Jump
010002 50524F              B   135    		db 'PRO'					; $2 - ASCI
010005 000001              B   136    mb_loc	dw24 load_location			; $5 - Desi
010008 000000              B   137    		dw24 0						; $8 - If >
01000B 0000                B   138    		dw 0						; $B - If >
01000D 0000                B   139    		dw 0						; $D - If >
01000F 01                  B   140    		db ADL_mode					; $F - Z80 
                           B   141    
010010                     B   142    skip_header
                           B   143    	
                           B   144    	IF ADL_mode = 0 
                           B   145    		
                           B   146    mbase_offset equ load_location & 0ff0000h
                           B   147    
                           B   148    		ld a,load_location/65536	; Additiona
Zilog eZ80 Macro Assembler Version 4.1 (10060805)30-Jan-11     14:35:22     page:   4


PC     Object              I  Line    Source ..\..\includes\PROSE_header.asm
                           B   149    		ld MB,a						; Set MBASE
                           B   150    		jp.sis go_z80_mode			; switches 
                           B   151    
                           B   152    go_z80_mode
                           B   153    
                           B   154    		.assume ADL = 0
                           B   155    
                           B   156    	ENDIF
                           B   157    	
                           B   158    ;----------------------------------------------
                           B   159    	
                           A     9    
                           A    10    ;----------------------------------------------
                           A    11    ; ADL-mode user program follows..
                           A    12    ;----------------------------------------------
                           A    13    
       00F80000            A    14    audio_registers	equ 0f80000h
                           A    15    
       00000040            A    16    vol0 equ 40h
       00000000            A    17    vol1 equ 0h
       00000000            A    18    vol2 equ 0h
       00000000            A    19    vol3 equ 0h
       00000000            A    20    vol4 equ 0h
       00000000            A    21    vol5 equ 0h
       00000000            A    22    vol6 equ 0h
       00000000            A    23    vol7 equ 0h
                           A    24    
                           A    25    
010010 01000000            A    26    			ld bc,0
010014 ED430000 F8         A    27    			ld (audio_registers+00h),bc			010019 01008000            A    28    			ld bc,8000h
01001D ED432000 F8         A    29    			ld (audio_registers+20h),bc			010022 01000002            A    30    			ld bc,020000h
010026 ED434000 F8         A    31    			ld (audio_registers+40h),bc			01002B 01004000            A    32    			ld bc,4000h
01002F ED436000 F8         A    33    			ld (audio_registers+60h),bc			010034 01FF1F00            A    34    			ld bc,001fffh
010038 ED438000 F8         A    35    			ld (audio_registers+80h),bc			01003D 01400000            A    36    			ld bc,vol0
010041 ED43C000 F8         A    37    			ld (audio_registers+c0h),bc			                           A    38    
                           A    39    
010046 01000000            A    40    			ld bc,0
01004A ED430400 F8         A    41    			ld (audio_registers+04h),bc			01004F ED432400 F8         A    42    			ld (audio_registers+24h),bc			010054 01000002            A    43    			ld bc,020000h
010058 ED434400 F8         A    44    			ld (audio_registers+44h),bc			01005D ED436400 F8         A    45    			ld (audio_registers+64h),bc			010062 01FF2F00            A    46    			ld bc,002fffh
010066 ED438400 F8         A    47    			ld (audio_registers+84h),bc			01006B 01000000            A    48    			ld bc,vol1
01006F ED43C400 F8         A    49    			ld (audio_registers+c4h),bc			Zilog eZ80 Macro Assembler Version 4.1 (10060805)30-Jan-11     14:35:22     page:   5


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\AUDIO3~1\src\audio2test.asm
                           A    50    
                           A    51    
010074 01000000            A    52    			ld bc,0
010078 ED430800 F8         A    53    			ld (audio_registers+08h),bc			01007D ED432800 F8         A    54    			ld (audio_registers+28h),bc			010082 01000002            A    55    			ld bc,020000h
010086 ED434800 F8         A    56    			ld (audio_registers+48h),bc			01008B ED436800 F8         A    57    			ld (audio_registers+68h),bc			010090 01FF3F00            A    58    			ld bc,003fffh
010094 ED438800 F8         A    59    			ld (audio_registers+88h),bc			010099 01000000            A    60    			ld bc,vol2
01009D ED43C800 F8         A    61    			ld (audio_registers+c8h),bc			                           A    62    
                           A    63    
                           A    64    
0100A2 01000000            A    65    			ld bc,0
0100A6 ED430C00 F8         A    66    			ld (audio_registers+0ch),bc			0100AB ED432C00 F8         A    67    			ld (audio_registers+2ch),bc			0100B0 01000002            A    68    			ld bc,020000h
0100B4 ED434C00 F8         A    69    			ld (audio_registers+4ch),bc			0100B9 ED436C00 F8         A    70    			ld (audio_registers+6ch),bc			0100BE 01FF4F00            A    71    			ld bc,004fffh
0100C2 ED438C00 F8         A    72    			ld (audio_registers+8ch),bc			0100C7 01000000            A    73    			ld bc,vol3
0100CB ED43CC00 F8         A    74    			ld (audio_registers+cch),bc			                           A    75    
                           A    76    
0100D0 01000000            A    77    			ld bc,0
0100D4 ED431000 F8         A    78    			ld (audio_registers+10h),bc			0100D9 ED433000 F8         A    79    			ld (audio_registers+30h),bc			0100DE 01000002            A    80    			ld bc,020000h
0100E2 ED435000 F8         A    81    			ld (audio_registers+50h),bc			0100E7 ED437000 F8         A    82    			ld (audio_registers+70h),bc			0100EC 01FF5F00            A    83    			ld bc,005fffh
0100F0 ED439000 F8         A    84    			ld (audio_registers+90h),bc			0100F5 01000000            A    85    			ld bc,vol4
0100F9 ED43D000 F8         A    86    			ld (audio_registers+d0h),bc			                           A    87    
                           A    88    
0100FE 01000000            A    89    			ld bc,0
010102 ED431400 F8         A    90    			ld (audio_registers+14h),bc			010107 ED433400 F8         A    91    			ld (audio_registers+34h),bc			01010C 01000002            A    92    			ld bc,020000h
010110 ED435400 F8         A    93    			ld (audio_registers+54h),bc			010115 ED437400 F8         A    94    			ld (audio_registers+74h),bc			01011A 01FF6F00            A    95    			ld bc,006fffh
01011E ED439400 F8         A    96    			ld (audio_registers+94h),bc			010123 01000000            A    97    			ld bc,vol5
010127 ED43D400 F8         A    98    			ld (audio_registers+d4h),bc			                           A    99    
                           A   100    
01012C 01000000            A   101    			ld bc,0
Zilog eZ80 Macro Assembler Version 4.1 (10060805)30-Jan-11     14:35:22     page:   6


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\AUDIO3~1\src\audio2test.asm
010130 ED431800 F8         A   102    			ld (audio_registers+18h),bc			010135 ED433800 F8         A   103    			ld (audio_registers+38h),bc			01013A 01000002            A   104    			ld bc,020000h
01013E ED435800 F8         A   105    			ld (audio_registers+58h),bc			010143 ED437800 F8         A   106    			ld (audio_registers+78h),bc			010148 01FF7F00            A   107    			ld bc,007fffh
01014C ED439800 F8         A   108    			ld (audio_registers+98h),bc			010151 01000000            A   109    			ld bc,vol6
010155 ED43D800 F8         A   110    			ld (audio_registers+d8h),bc			                           A   111    
                           A   112    
01015A 01000000            A   113    			ld bc,0
01015E ED431C00 F8         A   114    			ld (audio_registers+1ch),bc			010163 ED433C00 F8         A   115    			ld (audio_registers+3ch),bc			010168 01000002            A   116    			ld bc,020000h
01016C ED435C00 F8         A   117    			ld (audio_registers+5ch),bc			010171 ED437C00 F8         A   118    			ld (audio_registers+7ch),bc			010176 01FF8F00            A   119    			ld bc,008fffh
01017A ED439C00 F8         A   120    			ld (audio_registers+9ch),bc			01017F 01000000            A   121    			ld bc,vol7
010183 ED43DC00 F8         A   122    			ld (audio_registers+dch),bc			                           A   123    			
                           A   124    			
                           A   125    					
010188 3E80                A   126    			ld a,10000000b
01018A 320300F8            A   127    			ld (audio_registers+3),a			01018E CD E5 01 01         A   128    			call pause
010192 21 28 02 01         A   129    			ld hl,building_a_txt
010196 CD D5 01 01         A   130    			call print_string
                           A   131    			
01019A 3E01                A   132    			ld a,00000001b
01019C 320300F8            A   133    			ld (audio_registers+3),a			0101A0 21 F7 01 01         A   134    			ld hl,enabled_txt				
0101A4 CD D5 01 01         A   135    			call print_string
                           A   136    
0101A8 CD EB 01 01         A   137    buf_loop	call wait_buf_req					                           A   138    			
0101AC 3E83                A   139    			ld a,10000011b
0101AE 320300F8            A   140    			ld (audio_registers+3),a			0101B2 CD E5 01 01         A   141    			call pause
                           A   142    			
0101B6 CD EB 01 01         A   143    			call wait_buf_req					                           A   144    
0101BA 3E81                A   145    			ld a,10000001b
0101BC 320300F8            A   146    			ld (audio_registers+3),a			0101C0 CD E5 01 01         A   147    			call pause
                           A   148    			
0101C4 3E1E                A   149    			ld a,kr_get_key
0101C6 5BCD200A 00         A   150    			call.lil prose_kernal
0101CB FE76                A   151    			cp 076h
0101CD 20 D9               A   152    			jr nz,buf_loop
                           A   153    
Zilog eZ80 Macro Assembler Version 4.1 (10060805)30-Jan-11     14:35:22     page:   7


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\AUDIO3~1\src\audio2test.asm
0101CF AF                  A   154    			xor a
0101D0 5BC3140A 00         A   155    			jp.lil prose_return					                           A   156    
                           A   157    			
0101D5                     A   158    print_string
                           A   159    
0101D5 3E25                A   160    			ld a,kr_print_string			 
0101D7 5BCD200A 00         A   161    			call.lil prose_kernal			 
0101DC C9                  A   162    			ret
                           A   163    		
0101DD                     A   164    waitkey
                           A   165    
0101DD 3E1D                A   166    			ld a,kr_wait_key
0101DF 5BCD200A 00         A   167    			call.lil prose_kernal
0101E4 C9                  A   168    			ret
                           A   169    
                           A   170    
0101E5 0600                A   171    pause		ld b,0
0101E7 00                  A   172    lp3			nop
0101E8 10 FD               A   173    			djnz lp3
0101EA C9                  A   174    			ret
                           A   175    
                           A   176    
0101EB                     A   177    wait_buf_req
                           A   178    
0101EB 3EF0                A   179    			ld a,0f0h
                           A   180    ;			ld (hw_palette),a
                           A   181    	
0101ED ED3801              A   182    waitbreq	in0 a,(port_hw_flags)
0101F0 CB77                A   183    			bit 6,a
0101F2 28 F9               A   184    			jr z,waitbreq
                           A   185    			
0101F4 3E00                A   186    			ld a,000h
                           A   187    ;			ld (hw_palette),a
                           A   188    			
                           A   189    			
                           A   190    ;			ld b,0
                           A   191    ;lp2			djnz lp2		
                           A   192    			
0101F6 C9                  A   193    			ret
                           A   194    			
                           A   195    ;----------------------------------------------
                           A   196    
0101F7                     A   197    enabled_txt
                           A   198    
0101F7 456E6162 6C656420   A   199    		db 'Enabled playback',11,0
0101FF 706C6179 6261636B 
010207 0B00 
                           A   200    
010209                     A   201    waiting_txt
                           A   202    
010209 57616974 696E6720   A   203    		db 'Waiting for buffer fill req..',11,0
Zilog eZ80 Macro Assembler Version 4.1 (10060805)30-Jan-11     14:35:22     page:   8


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\AUDIO3~1\src\audio2test.asm
010211 666F7220 62756666 
010219 65722066 696C6C20 
010221 7265712E 2E0B00 
                           A   204    		
010228                     A   205    building_a_txt
                           A   206    
010228 4275696C 64696E67   A   207    		db 'Building buffer A..',11,0
010230 20627566 66657220 
010238 412E2E0B 00 
                           A   208    
01023D                     A   209    building_b_txt
                           A   210    
01023D 4275696C 64696E67   A   211    		db 'Building buffer B..',11,0
010245 20627566 66657220 
01024D 422E2E0B 00 
                           A   212    
                           A   213    ;----------------------------------------------
                           A   214    		
                           A   215    		


Errors: 0
Warnings: 0
Lines Assembled: 375
