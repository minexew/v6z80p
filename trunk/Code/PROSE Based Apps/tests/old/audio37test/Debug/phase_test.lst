Zilog eZ80 Macro Assembler Version 4.1 (10060805)03-Feb-11     10:40:02     page:   1


PC     Object              I  Line    Source 
                           A     1    ; Test audio output (test hardware in ez80p con
                           A     2    
                           A     3    ;----------------------------------------------
                           A     4    
       00000001            A     5    ADL_mode		equ 1				; 0 if user
       00010000            A     6    load_location	equ 10000h			; anywhere 
                           A     7    
                           B     0    				include	'PROSE_header.asm'
                           B     1    
                           B     2    ;-- EZ80P Hardware equates --------------------
                           B     3    
       00000000            B     4    port_pic_data  			equ 0000h
       00000001            B     5    port_pic_ctrl			equ 0001h
       00000001            B     6    port_hw_flags			equ 0001h
       00000002            B     7    port_sdc_ctrl			equ 0002h	; this is a
       00000002            B     8    port_keyboard_data		equ 0002h
       00000003            B     9    port_sdc_data		 	equ 0003h	
       00000004            B    10    port_memory_paging		equ 0004h
       00000005            B    11    port_irq_ctrl			equ 0005h
       00000006            B    12    port_nmi_ack			equ 0006h
       00000007            B    13    port_selector			equ 0007h
                           B    14    
                           B    15    
       00000040            B    16    port_video_mode			equ 040h
                           B    17    
                           B    18    
       00000000            B    19    sdc_power				equ 0		;(port_sd_c
       00000001            B    20    sdc_cs					equ 1		;(port_sd_c
       00000002            B    21    sdc_speed				equ 2 		;(port_sd_c
                           B    22    
       00000004            B    23    sdc_serializer_busy		equ 4 		;(port_hw_f
       00000005            B    24    vrt						equ 5		;(port_hw_f
                           B    25    
                           B    26    
                           B    27    ;-- Memory locations --------------------------
                           B    28    
       00800000            B    29    hw_vram_a			equ 0800000h
       00F00000            B    30    hw_palette			equ 0f00000h
       00F80000            B    31    hw_audio_registers 	equ 0f80000h
                           B    32    
                           B    33    ;----------------------------------------------
                           B    34    
                           B    35    
       00000A00            B    36    os_start 	equ 0a00h
                           B    37    
       00000A14            B    38    prose_return equ os_start+14h
       00000A20            B    39    prose_kernal equ os_start+20h
                           B    40    
                           B    41    ;----------------------------------------------
                           B    42    ; Kernal Jump Table values for mode PROSE
                           B    43    ;----------------------------------------------
                           B    44    		
Zilog eZ80 Macro Assembler Version 4.1 (10060805)03-Feb-11     10:40:02     page:   2


PC     Object              I  Line    Source ..\..\includes\PROSE_header.asm
       00000000            B    45    kr_mount_volumes				equ 00h	
       00000001            B    46    kr_get_device_info				equ 01h	
       00000002            B    47    kr_check_volume_format			equ 02h	
       00000003            B    48    kr_change_volume				equ 03h	
       00000004            B    49    kr_get_volume_info				equ 04h	
       00000005            B    50    kr_format_device				equ 05h	
       00000006            B    51    kr_make_dir						equ 06h
                           B    52    
       00000007            B    53    kr_change_dir					equ 07h	
       00000008            B    54    kr_parent_dir					equ 08h	
       00000009            B    55    kr_root_dir						equ 09h
       0000000A            B    56    kr_delete_dir					equ 0ah
       0000000B            B    57    kr_find_file					equ 0bh
       0000000C            B    58    kr_set_file_pointer				equ 0ch
       0000000D            B    59    kr_set_load_length				equ 0dh
       0000000E            B    60    kr_read_file					equ 0eh
                           B    61    
       0000000F            B    62    kr_erase_file					equ 0fh
       00000010            B    63    kr_rename_file					equ 10h
       00000011            B    64    kr_create_file					equ 11h
       00000012            B    65    kr_write_file					equ 12h
       00000013            B    66    kr_get_total_sectors			equ 13h
       00000014            B    67    kr_dir_list_first_entry			equ 14h
       00000015            B    68    kr_dir_list_get_entry			equ 15h
       00000016            B    69    kr_dir_list_next_entry			equ 16h
                           B    70    
       00000017            B    71    kr_read_sector					equ 17h
       00000018            B    72    kr_write_sector					equ 18h
       00000019            B    73    kr_file_sector_list				equ 19h
       0000001A            B    74    kr_get_dir_cluster				equ 1ah
       0000001B            B    75    kr_set_dir_cluster				equ 1bh
       0000001C            B    76    kr_get_dir_name					equ 1ch
       0000001D            B    77    kr_wait_key						equ 1dh
       0000001E            B    78    kr_get_key						equ 1eh
                           B    79    
       0000001F            B    80    kr_get_key_mod_flags			equ 1fh
       00000020            B    81    kr_serial_receive_header		equ 20h
       00000021            B    82    kr_serial_receive_file			equ 21h
       00000022            B    83    kr_serial_send_file				equ 22h
       00000023            B    84    kr_serial_tx_byte				equ 23h
       00000024            B    85    kr_serial_rx_byte				equ 24h
                           B    86    
       00000025            B    87    kr_print_string					equ 25h
       00000026            B    88    kr_clear_screen					equ 26h
       00000027            B    89    kr_wait_vrt						equ 27h
       00000028            B    90    kr_set_cursor_position			equ 28h
       00000029            B    91    kr_plot_char					equ 29h
       0000002A            B    92    kr_set_pen						equ 2ah
       0000002B            B    93    kr_background_colours			equ 2bh
       0000002C            B    94    kr_draw_cursor					equ 2ch
       0000002D            B    95    kr_get_pen						equ 2dh
       0000002E            B    96    kr_scroll_up					equ 2eh
Zilog eZ80 Macro Assembler Version 4.1 (10060805)03-Feb-11     10:40:02     page:   3


PC     Object              I  Line    Source ..\..\includes\PROSE_header.asm
       0000002F            B    97    kr_os_display					equ 2fh
       00000030            B    98    kr_get_display_size				equ 30h
       00000031            B    99    kr_get_charmap_addr_xy			equ 31h
       00000032            B   100    kr_get_cursor_position			equ 32h
                           B   101    
       00000033            B   102    kr_set_envar					equ 33h
       00000034            B   103    kr_get_envar					equ 34h
       00000035            B   104    kr_delete_envar					equ 35h
                           B   105    
       00000036            B   106    kr_enable_mouse					equ 36h
       00000037            B   107    kr_get_mouse_position			equ 37h
       00000038            B   108    kr_get_mouse_disp				equ 38h
                           B   109    
       00000039            B   110    kr_time_delay					equ 39h
       0000003A            B   111    kr_compare_strings				equ 3ah
       0000003B            B   112    kr_hex_byte_to_ascii			equ 3bh
       0000003C            B   113    kr_ascii_to_hex_word			equ 3ch
       0000003D            B   114    kr_get_string					equ 3dh
                           B   115    
       0000003E            B   116    kr_get_version					equ 3eh
       0000003F            B   117    kr_dont_store_registers			equ 3fh
       00000040            B   118    kr_os_video_settings			equ 40h
       00000041            B   119    kr_read_rtc						equ 41h
       00000042            B   120    kr_write_rtc					equ 42h
                           B   121    
                           B   122    ;----------------------------------------------
                           B   123    ; Standard PROSE executable header
                           B   124    ;----------------------------------------------
                           B   125    
                           B   126    
                           B   127    	IF ADL_mode = 0
                           B   128    		org load_location&0ffffh	; if Z80 mo
                           B   129    	ELSE
010000                     B   130    		org load_location			; otherwise
                           B   131    	ENDIF
                           B   132    	
                           B   133    		.assume ADL = 1				; All PROSE
                           B   134    
010000 18 0E               B   135    		jr skip_header				; $0 - Jump
010002 50524F              B   136    		db 'PRO'					; $2 - ASCI
010005 000001              B   137    mb_loc	dw24 load_location			; $5 - Desi
010008 000000              B   138    		dw24 0						; $8 - If >
01000B 0000                B   139    		dw 0						; $B - If >
01000D 0000                B   140    		dw 0						; $D - If >
01000F 01                  B   141    		db ADL_mode					; $F - Z80 
                           B   142    
010010                     B   143    skip_header
                           B   144    	
                           B   145    	IF ADL_mode = 0 
                           B   146    		
                           B   147    mbase_offset equ load_location & 0ff0000h
                           B   148    
Zilog eZ80 Macro Assembler Version 4.1 (10060805)03-Feb-11     10:40:02     page:   4


PC     Object              I  Line    Source ..\..\includes\PROSE_header.asm
                           B   149    		ld a,load_location/65536	; Additiona
                           B   150    		ld MB,a						; Set MBASE
                           B   151    		jp.sis go_z80_mode			; switches 
                           B   152    
                           B   153    go_z80_mode
                           B   154    
                           B   155    		.assume ADL = 0
                           B   156    
                           B   157    	ENDIF
                           B   158    	
                           B   159    ;----------------------------------------------
                           B   160    	
                           A     9    
                           A    10    ;----------------------------------------------
                           A    11    ; ADL-mode user program follows..
                           A    12    ;----------------------------------------------
                           A    13    
       00F80000            A    14    audio_registers	equ 0f80000h
                           A    15    
010010 3E00                A    16    			ld a,0
010012 320300F8            A    17    			ld (audio_registers+3),a		; s
                           A    18    
                           A    19    			
010016 210000C0            A    20    			ld hl,0c00000h					; m
01001A 3E7F                A    21    mainlp2		ld a,07fh
01001C 0602                A    22    			ld b,2
01001E 77                  A    23    lp1b		ld (hl),a
01001F 23                  A    24    			inc hl
010020 10 FC               A    25    			djnz lp1b
010022 0603                A    26    			ld b,3
010024 3E80                A    27    			ld a,80h
010026 77                  A    28    lp2b		ld (hl),a
010027 23                  A    29    			inc hl
010028 10 FC               A    30    			djnz lp2b
01002A 7C                  A    31    			ld a,h
01002B FEF8                A    32    			cp 0f8h
01002D 38 EB               A    33    			jr c,mainlp2
                           A    34    			
                           A    35    			
                           A    36    
01002F 21 BE 00 01         A    37    			ld hl,msg_txt				
010033 CD 9C 00 01         A    38    			call print_string
                           A    39    
010037 DD210000 F8         A    40    			ld ix,audio_registers
                           A    41    			
01003C CD A4 00 01         A    42    			call audio_reg_wait					                           A    43    			
                           A    44    			
010040 11000000            A    45    			ld de,0
010044 DD1F00              A    46    			ld (ix+00h),de						010047 DD1F04              A    47    			ld (ix+04h),de						01004A DD1F08              A    48    			ld (ix+08h),de						Zilog eZ80 Macro Assembler Version 4.1 (10060805)03-Feb-11     10:40:02     page:   5


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\AUDIO3~3\src\phase_test.asm
01004D DD1F0C              A    49    			ld (ix+0ch),de						010050 DD1F10              A    50    			ld (ix+10h),de						010053 DD1F14              A    51    			ld (ix+14h),de						                           A    52    	
                           A    53    			
                           A    54    			
                           A    55    			
                           A    56    			
                           A    57    			
                           A    58    			
                           A    59    			
010056 11000000            A    60    			ld de,0
01005A DD1F00              A    61    			ld (ix+00h),de						01005D DD1F20              A    62    			ld (ix+20h),de
                           A    63    			
010060 11008000            A    64    			ld de,08000h
010064 DD1F04              A    65    			ld (ix+04h),de						010067 DD1F24              A    66    			ld (ix+24h),de
                           A    67    			
01006A 11FF1F00            A    68    			ld de,01fffh
01006E DD1F08              A    69    			ld (ix+08h),de						010071 DD1F28              A    70    			ld (ix+28h),de		
                           A    71    			
010074 11100000            A    72    			ld de,10h
010078 DD1F0C              A    73    			ld (ix+0ch),de						01007B 11100000            A    74    			ld de,10h
01007F DD1F2C              A    75    			ld (ix+2ch),de		
                           A    76    			
010082 11000000            A    77    			ld de,0
010086 DD1F10              A    78    			ld (ix+10h),de						010089 DD1F30              A    79    			ld (ix+30h),de						                           A    80    
01008C 11008000            A    81    			ld de,8000h
010090 DD1F14              A    82    			ld (ix+14h),de						010093 DD1F34              A    83    			ld (ix+34h),de	
                           A    84    				
010096 AF                  A    85    			xor a
010097 5BC3140A 00         A    86    			jp.lil prose_return					                           A    87    
                           A    88    			
01009C                     A    89    print_string
                           A    90    
01009C 3E25                A    91    			ld a,kr_print_string			 
01009E 5BCD200A 00         A    92    			call.lil prose_kernal			 
0100A3 C9                  A    93    			ret
                           A    94    		
                           A    95    ;----------------------------------------------
                           A    96    
0100A4                     A    97    audio_reg_wait
0100A4 3E80                A    98    				ld a,80h
0100A6 320000F0            A    99    				ld (hw_palette),a
                           A   100    
Zilog eZ80 Macro Assembler Version 4.1 (10060805)03-Feb-11     10:40:02     page:   6


PC     Object              I  Line    Source E:\MY_OWN~1\Coding\EZ80PR~1\Code\PROSEA~1\AUDIO3~3\src\phase_test.asm
0100AA 3E01                A   101    				ld a,1
0100AC 320300F8            A   102    				ld (audio_registers+3),a		0100B0 0E01                A   103    				ld c,port_hw_flags
0100B2 ED7440              A   104    wait_audreg		tstio 40h						0100B5 28 FB               A   105    				jr z,wait_audreg
                           A   106    				
0100B7 3E00                A   107    				ld a,00h
0100B9 320000F0            A   108    				ld (hw_palette),a
                           A   109    				
0100BD C9                  A   110    				ret
                           A   111    				
                           A   112    				
                           A   113    ;----------------------------------------------
                           A   114    
0100BE                     A   115    msg_txt
                           A   116    
0100BE 536F756E 64207465   A   117    		db 'Sound test..',11
0100C6 73742E2E 0B 
0100CB 506C6561 73652070   A   118    		db 'Please preload ding.snd to $C00000 
0100D3 72656C6F 61642064 
0100DB 696E672E 736E6420 
0100E3 746F2024 43303030 
0100EB 30302061 6E642070 
0100F3 72657373 2061206B 
0100FB 65792070 6C617920 
010103 6F6E2065 61636820 
01010B 6368616E 6E656C0B 
010113 00 
                           A   119    
                           A   120    ;----------------------------------------------
                           A   121    		
                           A   122    		


Errors: 0
Warnings: 0
Lines Assembled: 283
