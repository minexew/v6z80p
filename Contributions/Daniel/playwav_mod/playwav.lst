		INCLUDE kernal_jump_table.asm
os_start	EQU 1000
kjt_print_string EQU 1013
kjt_clear_screen EQU 1016
kjt_page_in_video EQU 1019
kjt_page_out_video EQU 101C
kjt_wait_vrt	EQU 101F
kjt_keyboard_irq_code EQU 1022
kjt_hex_byte_to_ascii EQU 1025
kjt_ascii_to_hex_word EQU 1028
kjt_dont_store_registers EQU 102B
kjt_get_input_string EQU 102E
kjt_check_disk_pqfs EQU 1031
kjt_change_drive EQU 1034
kjt_check_disk_available EQU 1037
kjt_get_drive	EQU 103A
kjt_format	EQU 103D
kjt_make_dir	EQU 1040
kjt_change_dir	EQU 1043
kjt_parent_dir	EQU 1046
kjt_root_dir	EQU 1049
kjt_delete_dir	EQU 104C
kjt_find_file	EQU 104F
kjt_load_file	EQU 1052
kjt_save_file	EQU 1055
kjt_erase_file	EQU 1058
kjt_get_total_sectors EQU 105B
kjt_wait_key_press EQU 105E
kjt_get_key	EQU 1061
kjt_forcebank	EQU 1064
kjt_force_bank	EQU 1064
kjt_getbank	EQU 1067
kjt_get_bank	EQU 1067
kjt_create_file	EQU 106A
kjt_incbank	EQU 106D
kjt_inc_bank	EQU 106D
kjt_compare_strings EQU 1070
kjt_write_bytes_to_file EQU 1073
kjt_bchl_memfill EQU 1076
kjt_force_load	EQU 1079
kjt_set_file_pointer EQU 107C
kjt_set_load_length EQU 107F
kjt_serial_receive_header EQU 1082
kjt_serial_receive_file EQU 1085
kjt_serial_send_file EQU 1088
kjt_init_mouse	EQU 108B
kjt_get_mouse_position EQU 108E
kjt_get_version	EQU 1091
kjt_set_cursor_position EQU 1094
kjt_serial_tx_byte EQU 1097
kjt_serial_rx_byte EQU 109A
kjt_dir_list_first_entry EQU 109D
kjt_dir_list_get_entry EQU 10A0
kjt_dir_list_next_entry EQU 10A3
kjt_get_cursor_position EQU 10A6
kjt_read_sector	EQU 10A9
kjt_write_sector EQU 10AC
kjt_set_sector_lba EQU 10AF
kjt_plot_char	EQU 10B2
kjt_set_pen	EQU 10B5
kjt_background_colours EQU 10B8
kjt_draw_cursor	EQU 10BB
kjt_get_pen	EQU 10BE
kjt_scroll_up	EQU 10C1
kjt_flos_display EQU 10C4
		End of INCLUDE
		INCLUDE OSCA_hardware_equates.asm
sys_mem_select	EQU 0000
sys_irq_ps2_flags EQU 0001
sys_irq_enable	EQU 0001
sys_keyboard_data EQU 0002
sys_clear_irq_flags EQU 0002
sys_mouse_data	EQU 0003
sys_ps2_joy_control EQU 0003
sys_serial_port	EQU 0004
sys_joy_com_flags EQU 0005
sys_sdcard_ctrl1 EQU 0005
sys_sdcard_ctrl2 EQU 0006
sys_timer	EQU 0007
sys_vreg_read	EQU 0007
sys_audio_enable EQU 0008
sys_audio_flags	EQU 0008
sys_hw_flags	EQU 0009
sys_hw_settings	EQU 0009
sys_spi_port	EQU 000A
sys_alt_write_page EQU 000B
sys_baud_rate	EQU 000C
sys_pic_comms	EQU 000D
sys_eeprom_byte	EQU 000D
sys_io_pins	EQU 000E
sys_io_dir	EQU 000F
audchan0_loc	EQU 0010
audchan0_len	EQU 0011
audchan0_per	EQU 0012
audchan0_vol	EQU 0013
audchan1_loc	EQU 0014
audchan1_len	EQU 0015
audchan1_per	EQU 0016
audchan1_vol	EQU 0017
audchan2_loc	EQU 0018
audchan2_len	EQU 0019
audchan2_per	EQU 001A
audchan2_vol	EQU 001B
audchan3_loc	EQU 001C
audchan3_len	EQU 001D
audchan3_per	EQU 001E
audchan3_vol	EQU 001F
ide_register0	EQU 0020
ide_register1	EQU 0021
ide_register2	EQU 0022
ide_register3	EQU 0023
ide_register4	EQU 0024
ide_register5	EQU 0025
ide_register6	EQU 0026
ide_register7	EQU 0027
ide_high_byte	EQU 0028
palette		EQU 0000
video_registers	EQU 0200
vreg_xhws	EQU 0200
vreg_vidctrl	EQU 0201
vreg_window	EQU 0202
vreg_yhws_bplcount EQU 0203
vreg_rasthi	EQU 0204
vreg_rastlo	EQU 0205
vreg_vidpage	EQU 0206
vreg_sprctrl	EQU 0207
mult_write	EQU 0208
mult_index	EQU 020A
linedraw_colour	EQU 020B
vreg_ext_vidctrl EQU 020C
vreg_linecop_lo	EQU 020D
vreg_linecop_hi	EQU 020E
vreg_palette_ctrl EQU 020F
blit_src_loc	EQU 0210
blit_dst_loc	EQU 0212
blit_src_mod	EQU 0214
blit_dst_mod	EQU 0215
blit_height	EQU 0216
blit_width	EQU 0217
blit_misc	EQU 0218
blit_src_msb	EQU 0219
blit_dst_msb	EQU 021A
linedraw_reg0	EQU 0220
linedraw_reg1	EQU 0222
linedraw_reg2	EQU 0224
linedraw_reg3	EQU 0226
linedraw_reg4	EQU 0228
linedraw_reg5	EQU 022A
linedraw_reg6	EQU 022C
linedraw_reg7	EQU 022E
linedraw_lut0	EQU 0230
linedraw_lut1	EQU 0232
linedraw_lut2	EQU 0234
linedraw_lut3	EQU 0236
linedraw_lut4	EQU 0238
linedraw_lut5	EQU 023A
linedraw_lut6	EQU 023C
linedraw_lut7	EQU 023E
bitplane0a_loc	EQU 0240
bitplane1a_loc	EQU 0244
bitplane2a_loc	EQU 0248
bitplane3a_loc	EQU 024C
bitplane4a_loc	EQU 0250
bitplane5a_loc	EQU 0254
bitplane6a_loc	EQU 0258
bitplane7a_loc	EQU 025C
bitplane0b_loc	EQU 0260
bitplane1b_loc	EQU 0264
bitplane2b_loc	EQU 0268
bitplane3b_loc	EQU 026C
bitplane4b_loc	EQU 0270
bitplane5b_loc	EQU 0274
bitplane6b_loc	EQU 0278
bitplane7b_loc	EQU 027C
bitplane_reset	EQU 0243
bitplane_modulo	EQU 0247
sprite_registers EQU 0400
spr_registers	EQU 0400
mult_table	EQU 0600
vreg_read	EQU 0700
mult_read	EQU 0704
sprite_base	EQU 1000
video_base	EQU 2000
		End of INCLUDE
		INCLUDE system_equates.asm
new_bootcode_location EQU 0200
new_bootcode_length EQU 0DC0
new_rom_stack	EQU 0FFF
bootcode_location EQU 0800
bootcode_length	EQU 0800
sector_buffer	EQU 0800
irq_jp_inst	EQU 0A00
irq_vector	EQU 0A01
nmi_jp_inst	EQU 0A03
nmi_vector	EQU 0A04
ide_status	EQU 0A06
stack		EQU 0AFF
OS_variables	EQU 0B00
OS_charmap	EQU 0C00
OS_location	EQU 1000
		End of INCLUDE
		ORG 5000
5000:E5		PUSH HL
5001:CD9110	CALL 1091
5004:114805	LD DE, 0548
5007:AF		XOR A
5008:ED52	SBC HL, DE
500A:3027	JR NC, 5033
500C:211550	LD HL, 5015
500F:CD1310	CALL 1013
5012:E1		POP HL
5013:AF		XOR A
5014:C9		RET
5015:		label old_flos_txt
5015:50726F67	DEFB of 30 bytes
5019:72616D20
501D:72657175
5021:69726573
5025:20464C4F
5029:53207635
502D:34382B0B
5031:0B00
5033:		label flos_ok
5033:E1		POP HL
5034:110050	LD DE, 5000
5037:AF		XOR A
5038:ED52	SBC HL, DE
503A:2006	JR NZ, 5042
503C:21D253	LD HL, 53D2
503F:110000	LD DE, 0000
5042:		label argok
5042:19		ADD HL, DE
5043:		label fnd_para
5043:7E		LD A, (HL)
5044:B7		OR A
5045:CACF52	JP Z, 52CF
5048:FE20	CP 20
504A:2003	JR NZ, 504F
504C:		label skp_spc
504C:23		INC HL
504D:18F4	JR 5043
504F:		label fn_ok
504F:E5		PUSH HL
5050:11DE53	LD DE, 53DE
5053:0610	LD B, 10
5055:		label fnclp
5055:7E		LD A, (HL)
5056:B7		OR A
5057:2809	JR Z, 5062
5059:FE20	CP 20
505B:2805	JR Z, 5062
505D:12		LD (DE), A
505E:23		INC HL
505F:13		INC DE
5060:10F3	DJNZ 5055
5062:		label fncdone
5062:AF		XOR A
5063:12		LD (DE), A
5064:21A853	LD HL, 53A8
5067:CD1310	CALL 1013
506A:E1		POP HL
506B:21DE53	LD HL, 53DE
506E:CD4F10	CALL 104F
5071:C2C752	JP NZ, 52C7
5074:DD210000	LD IX, 0000
5078:FD212C00	LD IY, 002C
507C:CD7F10	CALL 107F
507F:210754	LD HL, 5407
5082:0600	LD B, 00
5084:CD7910	CALL 1079
5087:C2C752	JP NZ, 52C7
508A:3A0F54	LD A, (540F)
508D:FE57	CP 57
508F:C2D752	JP NZ, 52D7
5092:3A1054	LD A, (5410)
5095:FE41	CP 41
5097:C2D752	JP NZ, 52D7
509A:3A1D54	LD A, (541D)
509D:FE01	CP 01
509F:C2DF52	JP NZ, 52DF
50A2:ED4B1F54	LD BC, (541F)
50A6:210024	LD HL, 2400
50A9:1EF4	LD E, F4
50AB:DD210000	LD IX, 0000
50AF:		label divloop
50AF:AF		XOR A
50B0:ED42	SBC HL, BC
50B2:3006	JR NC, 50BA
50B4:1D		DEC E
50B5:7B		LD A, E
50B6:FEFF	CP FF
50B8:2804	JR Z, 50BE
50BA:		label nobo
50BA:DD23	INC IX
50BC:18F1	JR 50AF
50BE:		label divdone
50BE:DD220554	LD (5405), IX
50C2:DDE5	PUSH IX
50C4:E1		POP HL
50C5:AF		XOR A
50C6:111002	LD DE, 0210
50C9:ED52	SBC HL, DE
50CB:DAE752	JP C, 52E7
50CE:3A2754	LD A, (5427)
50D1:FE01	CP 01
50D3:C2DF52	JP NZ, 52DF
50D6:FD2A2F54	LD IY, (542F)
50DA:DD2A3154	LD IX, (5431)
50DE:FD220154	LD (5401), IY
50E2:DD220354	LD (5403), IX
50E6:3A0354	LD A, (5403)
50E9:FE02	CP 02
50EB:3808	JR C, 50F5
50ED:2A0154	LD HL, (5401)
50F0:7C		LD A, H
50F1:B5		OR L
50F2:C28851	JP NZ, 5188
50F5:		label short_samp
50F5:21DE53	LD HL, 53DE
50F8:CD4F10	CALL 104F
50FB:C2C752	JP NZ, 52C7
50FE:DD210000	LD IX, 0000
5102:FD212C00	LD IY, 002C
5106:CD7C10	CALL 107C
5109:210080	LD HL, 8000
510C:0603	LD B, 03
510E:CD7910	CALL 1079
5111:3E03	LD A, 03
5113:CD6410	CALL 1064
5116:CDB952	CALL 52B9
5119:3E04	LD A, 04
511B:CD6410	CALL 1064
511E:CDB952	CALL 52B9
5121:3E05	LD A, 05
5123:CD6410	CALL 1064
5126:CDB952	CALL 52B9
5129:3E06	LD A, 06
512B:CD6410	CALL 1064
512E:CDB952	CALL 52B9
5131:210000	LD HL, 0000
5134:22FEFF	LD (FFFE), HL
5137:3E00	LD A, 00
5139:CD6410	CALL 1064
513C:CDAA52	CALL 52AA
513F:3E00	LD A, 00
5141:D308	OUT (08), A
5143:ED4B0354	LD BC, (5403)
5147:ED5B0154	LD DE, (5401)
514B:CB39	SRL C
514D:CB1A	RR D
514F:CB1B	RR E
5151:010000	LD BC, 0000
5154:2A0554	LD HL, (5405)
5157:3E40	LD A, 40
5159:CD8A52	CALL 528A
515C:CDAA52	CALL 52AA
515F:3E01	LD A, 01
5161:D308	OUT (08), A
5163:CDAA52	CALL 52AA
5166:01FFFF	LD BC, FFFF
5169:110100	LD DE, 0001
516C:2A0554	LD HL, (5405)
516F:3E40	LD A, 40
5171:CD8A52	CALL 528A
5174:3E10	LD A, 10
5176:D302	OUT (02), A
5178:		label ss_loop
5178:DB08	IN A, (08)
517A:CB67	BIT 4, A
517C:C28652	JP NZ, 5286
517F:DB02	IN A, (02)
5181:FE76	CP 76
5183:20F3	JR NZ, 5178
5185:C38652	JP 5286
5188:		label long_samp
5188:DD210200	LD IX, 0002
518C:FD210000	LD IY, 0000
5190:CD7F10	CALL 107F
5193:210080	LD HL, 8000
5196:0603	LD B, 03
5198:CD7910	CALL 1079
519B:3E03	LD A, 03
519D:CD6410	CALL 1064
51A0:CDB952	CALL 52B9
51A3:3E04	LD A, 04
51A5:CD6410	CALL 1064
51A8:CDB952	CALL 52B9
51AB:3E05	LD A, 05
51AD:CD6410	CALL 1064
51B0:CDB952	CALL 52B9
51B3:3E06	LD A, 06
51B5:CD6410	CALL 1064
51B8:CDB952	CALL 52B9
51BB:3A0354	LD A, (5403)
51BE:D602	SUB 02
51C0:320354	LD (5403), A
51C3:CDAA52	CALL 52AA
51C6:3E00	LD A, 00
51C8:D308	OUT (08), A
51CA:010000	LD BC, 0000
51CD:110080	LD DE, 8000
51D0:2A0554	LD HL, (5405)
51D3:3E40	LD A, 40
51D5:CD8A52	CALL 528A
51D8:CDAA52	CALL 52AA
51DB:3E03	LD A, 03
51DD:D308	OUT (08), A
51DF:CDAA52	CALL 52AA
51E2:010080	LD BC, 8000
51E5:110080	LD DE, 8000
51E8:2A0554	LD HL, (5405)
51EB:3E40	LD A, 40
51ED:CD8A52	CALL 528A
51F0:3EF7	LD A, F7
51F2:D302	OUT (02), A
51F4:		label ls_loop
51F4:DB02	IN A, (02)
51F6:FE76	CP 76
51F8:CA8652	JP Z, 5286
51FB:DB08	IN A, (08)
51FD:CB67	BIT 4, A
51FF:28F3	JR Z, 51F4
5201:3E10	LD A, 10
5203:D302	OUT (02), A
5205:DD210100	LD IX, 0001
5209:FD210000	LD IY, 0000
520D:CD7F10	CALL 107F
5210:210080	LD HL, 8000
5213:3A0054	LD A, (5400)
5216:07		RLCA
5217:C603	ADD A, 03
5219:47		LD B, A
521A:CD7910	CALL 1079
521D:2040	JR NZ, 525F
521F:3A0354	LD A, (5403)
5222:3D		DEC A
5223:320354	LD (5403), A
5226:3A0054	LD A, (5400)
5229:07		RLCA
522A:C603	ADD A, 03
522C:F5		PUSH AF
522D:CD6410	CALL 1064
5230:CDB952	CALL 52B9
5233:F1		POP AF
5234:3C		INC A
5235:CD6410	CALL 1064
5238:CDB952	CALL 52B9
523B:3E00	LD A, 00
523D:CD6410	CALL 1064
5240:CDAA52	CALL 52AA
5243:3A0054	LD A, (5400)
5246:0F		RRCA
5247:47		LD B, A
5248:0E00	LD C, 00
524A:110080	LD DE, 8000
524D:2A0554	LD HL, (5405)
5250:3E40	LD A, 40
5252:CD8A52	CALL 528A
5255:3A0054	LD A, (5400)
5258:EE01	XOR 01
525A:320054	LD (5400), A
525D:1895	JR 51F4
525F:		label last_load
525F:CDAA52	CALL 52AA
5262:3A0054	LD A, (5400)
5265:0F		RRCA
5266:47		LD B, A
5267:0E00	LD C, 00
5269:ED5B0154	LD DE, (5401)
526D:CB3A	SRL D
526F:CB1B	RR E
5271:2A0554	LD HL, (5405)
5274:3E40	LD A, 40
5276:CD8A52	CALL 528A
5279:		label es_loop
5279:DB02	IN A, (02)
527B:FE76	CP 76
527D:CA8652	JP Z, 5286
5280:DB08	IN A, (08)
5282:CB67	BIT 4, A
5284:28F3	JR Z, 5279
5286:		label quit
5286:AF		XOR A
5287:D308	OUT (08), A
5289:C9		RET
528A:		label set_up_channel0
528A:D313	OUT (13), A
528C:D317	OUT (17), A
528E:79		LD A, C
528F:0E10	LD C, 10
5291:ED79	OUT (C), A
5293:0E14	LD C, 14
5295:ED79	OUT (C), A
5297:42		LD B, D
5298:0E11	LD C, 11
529A:ED59	OUT (C), E
529C:0E15	LD C, 15
529E:ED59	OUT (C), E
52A0:44		LD B, H
52A1:0E12	LD C, 12
52A3:ED69	OUT (C), L
52A5:0E16	LD C, 16
52A7:ED69	OUT (C), L
52A9:C9		RET
52AA:		label wait_dma
52AA:3A0007	LD A, (0700)
52AD:E640	AND 40
52AF:47		LD B, A
52B0:		label loop2
52B0:3A0007	LD A, (0700)
52B3:E640	AND 40
52B5:B8		CP B
52B6:28F8	JR Z, 52B0
52B8:C9		RET
52B9:		label convertsamples
52B9:210080	LD HL, 8000
52BC:		label cslp
52BC:7E		LD A, (HL)
52BD:D680	SUB 80
52BF:77		LD (HL), A
52C0:2C		INC L
52C1:20F9	JR NZ, 52BC
52C3:24		INC H
52C4:20F6	JR NZ, 52BC
52C6:C9		RET
52C7:		label load_error
52C7:21B453	LD HL, 53B4
52CA:CD1310	CALL 1013
52CD:AF		XOR A
52CE:C9		RET
52CF:		label show_use
52CF:214C53	LD HL, 534C
52D2:CD1310	CALL 1013
52D5:AF		XOR A
52D6:C9		RET
52D7:		label notwav
52D7:21EF52	LD HL, 52EF
52DA:CD1310	CALL 1013
52DD:AF		XOR A
52DE:C9		RET
52DF:		label badwavtype
52DF:210353	LD HL, 5303
52E2:CD1310	CALL 1013
52E5:AF		XOR A
52E6:C9		RET
52E7:		label sampratebad
52E7:212453	LD HL, 5324
52EA:CD1310	CALL 1013
52ED:AF		XOR A
52EE:C9		RET
52EF:		label notwav_txt
52EF:46696C65	DEFB of 20 bytes
52F3:20697320
52F7:6E6F7420
52FB:61202E77
52FF:61760B00
5303:		label badwav_txt
5303:57617620	DEFB of 33 bytes
5307:66696C65
530B:20697320
530F:6E6F7420
5313:6F662063
5317:6F727265
531B:63742074
531F:7970650B
5323:00
5324:		label samprate_txt
5324:57617620	DEFB of 34 bytes
5328:66696C65
532C:2073616D
5330:706C6520
5334:72617465
5338:20697320
533C:746F6F20
5340:68696768
5344:0B00
5346:		label loop_txt
5346:4C6F6F70	DEFB of 6 bytes
534A:0B00
534C:		label use_txt
534C:0B555345	DEFB of 28 bytes
5350:3A20506C
5354:61797761
5358:762E6578
535C:65206669
5360:6C656E61
5364:6D650B0B
5368:57617620	DEFB of 34 bytes
536C:66696C65
5370:206D7573
5374:74206265
5378:20382062
537C:69742C20
5380:6D6F6E6F
5384:2C205043
5388:4D0B
538A:77697468	DEFB of 30 bytes
538E:2073616D
5392:706C6520
5396:72617465
539A:2062656C
539E:6F772033
53A2:304B487A
53A6:0B00
53A8:		label loading_txt
53A8:4C6F6164	DEFB of 12 bytes
53AC:696E672E
53B0:2E2E0B00
53B4:		label fnf_txt
53B4:4C6F6164	DEFB of 30 bytes
53B8:20657272
53BC:6F72202D
53C0:2066696C
53C4:65206E6F
53C8:7420666F
53CC:756E643F
53D0:0B00
53D2:		label test_fn
53D2:73616D70	DEFB of 12 bytes
53D6:6C65312E
53DA:77617600
53DE:		label filename
53DE:00000000	DEFS of 32 bytes with value 00
53E2:00000000
53E6:00000000
53EA:00000000
53EE:00000000
53F2:00000000
53F6:00000000
53FA:00000000
53FE:		label original_irq
53FE:0000	DEFW of 1 words
5400:		label buffer
5400:00		DEFB of 1 bytes
5401:		label samp_len_lo
5401:0000	DEFW of 1 words
5403:		label samp_len_hi
5403:0000	DEFW of 1 words
5405:		label period
5405:0000	DEFW of 1 words
5407:		label header
5407:00000000	DEFS of 44 bytes with value 00
540B:00000000
540F:00000000
5413:00000000
5417:00000000
541B:00000000
541F:00000000
5423:00000000
5427:00000000
542B:00000000
542F:00000000
Emiting raw binary from 5000 to 5432
